diff -urN -x *CVS* -x *patches* clean-1.4.pre2/.conf.linux wxclean/.conf.linux
--- clean-1.4.pre2/.conf.linux	Sun Oct  7 17:23:00 2001
+++ wxclean/.conf.linux	Sun Mar 17 04:12:46 2002
@@ -6,7 +6,7 @@
 
 CC="gcc"
 CXX="c++"
-CFLAGS="-Wall -O2 -fomit-frame-pointer -pipe"
+CFLAGS="-Wall -g -fomit-frame-pointer -pipe"
 CXXFLAGS="$CFLAGS"
 
 export CC
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/Makefile.in wxclean/Makefile.in
--- clean-1.4.pre2/Makefile.in	Mon Mar 11 12:02:26 2002
+++ wxclean/Makefile.in	Sun Mar 17 04:12:46 2002
@@ -74,11 +74,11 @@
 
 CC = @CC@
 CXX = @CXX@
-CFLAGS = @CFLAGS@ $(MCH_CFLAGS) $(FLA_FLAGS)
-CXXFLAGS = @CXXFLAGS@ $(MCH_CFLAGS) $(FLA_FLAGS)
+CFLAGS = @CFLAGS@ $(MCH_CFLAGS) $(FLA_FLAGS) `wx-config --cflags`
+CXXFLAGS = @CXXFLAGS@ $(MCH_CFLAGS) $(FLA_FLAGS) `wx-config --cxxflags`
 
 LDFLAGS = @LDFLAGS@
-LIBS = @LIBS@
+LIBS = `wx-config --libs` @LIBS@
 # To compile with readline:
 #   linux needs just -lreadline
 #   solaris needs -lreadline -lcurses
@@ -96,7 +96,7 @@
 GUI_LINK_OPTS_CARBON = -framework Carbon
 GUI_LINK_OPTS_NOGUI =
 GUI_LINK_OPTS_TERM = @GUI_LINK_OPTS_TERM@
-GUI_LINK_OPTS = @GUI_LINK_OPTS@
+GUI_LINK_OPTS = @GUI_LINK_OPTS@  `wx-config --libs`
 RANLIB = @RANLIB@
 
 BX_INCDIRS = -I. -I$(srcdir)/. -I@INSTRUMENT_DIR@ -I$(srcdir)/@INSTRUMENT_DIR@
@@ -127,7 +127,8 @@
 	load32bitOShack.o \
 	state_file.o \
 	pc_system.o \
-	osdep.o
+	osdep.o \
+	wxmain.o
 
 EXTERN_ENVIRONMENT_OBJS = \
 	main.o \
@@ -187,7 +188,7 @@
 bxversion.h:
 	$(RM) -f bxversion.h
 	echo '/////////////////////////////////////////////////////////////////////////' > bxversion.h
-	echo '// $$Id: Makefile.in,v 1.66 2002/03/11 16:59:58 bdenney Exp $$' >> bxversion.h
+	echo '// $$Id: Makefile.in,v 1.28.2.5 2002/03/17 09:06:21 bdenney Exp $$' >> bxversion.h
 	echo '/////////////////////////////////////////////////////////////////////////' >> bxversion.h
 	echo '// This file is generated by "make bxversion.h"' >> bxversion.h
 	echo "#define VER_STRING \"$(VER_STRING)\"" >> bxversion.h
@@ -348,7 +349,7 @@
 V6WORKSPACE_FILES=bochs.dsw bochs.dsp bochs.opt cpu/cpu.dsp \
 	memory/memory.dsp iodev/iodev.dsp instrument/stubs/stubs.dsp \
 	gui/gui.dsp fpu/fpu.dsp disasm/disasm.dsp debug/debug.dsp \
-	misc/niclist.dsp bximage.dsp
+	misc/niclist.dsp bximage.dsp wxthreadtest.dsp
 
 v6workspace:
 	zip $(V6WORKSPACE_ZIP) $(V6WORKSPACE_FILES)
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/README wxclean/README
--- clean-1.4.pre2/README	Mon Mar 11 12:56:04 2002
+++ wxclean/README	Sun Mar 17 04:12:46 2002
@@ -1,3 +1,201 @@
+Readme for BRANCH-cpanel branch
+updated Sun Mar 17 01:08:40  2002
+Bryce Denney
+
+-------------
+Mar 17: This code now has all the changes from the main branch up to
+the latest release 1.4.pre2.
+-------------
+
+wxWindows Configuration Interface
+
+This branch began in June 2001 when the most recent bochs version was
+1.2.1.  Dave Poirier and Bryce Denney started adding a wxWindows 
+configuration interface.  So far, it uses the platform's native
+interface to show the vga screen and the traditional bitmap buttons.
+The wxWindows window is a separate window, and eventually it will let
+you choose between different configurations, manage all the bochsrc options,
+create new disk images (?), and then start a simulation.
+
+Right now, the wxWindows window appears first.  This will be where
+you can choose a preset configuration or create one from scratch, then
+edit the bochsrc options using the GUI.  Then, by clicking on some button or a
+menu option, you can start up the Bochs simulation.  For now, the simulation
+creates its own window for vga display and the traditional buttons, which
+still use the platform-dependent gui code (not wxwindows).
+
+WARNING: Don't expect stable or complete code yet!
+
+I have tested in linux, where a "configure;make" should work fine.
+More recently, I have been developing in MSVC++ using projects and 
+workspaces.  To build in VC++:
+
+- in cygwin, do "sh .conf.win32-vcpp".  If you want different configure
+  options from the default, edit .conf.win32-vcpp first.
+- in cygwin, do "unzip build/win32/workspace.zip", or use winzip.  Now
+  you should have bochs.dsw and bochs.dsp in the main directory.
+- open up bochs.dsw, the workspace file.
+- edit project settings so that VC++ can find the wxWindows include
+  files and libraries on your system.  I installed them in
+  d:/wx/wx232/include and d:/wx/wx232/lib.  Specifically, edit
+  - Project>Settings>C/C++>Preprocessor: include directories.
+  - Project>Settings>Link>Input: additional library path.
+- build
+
+Note that the project is set up for wxWindows 2.3.2, and the only 
+configuration that I've used is called Win32 Debug.  To use on 
+other wxwindows versions, you will have to change some of the names
+of the libraries to include.  Use the samples that came with that
+version of wxwindows for reference.
+
+What works right now:
+- cd to a directory with a bochsrc and disk images in it (I use dlxlinux)
+- start up bochs.  You get a small wxwindows window with a File menu.
+- choose "start bochs" on the file menu.
+- a new window pops up with is the normal bochs window
+- click on the floppy icon for A or B.  You get a modal dialog box from
+  the control panel that lets you choose a new image file name.  Click
+  the new image file, and ok.  Now you can read the new image file in
+  Bochs.  If the file you select or type is readable, the floppy icon shows a
+  good floppy disk.  If you type "none" or choose an unreadable file,
+  the floopy icon will show a disk with an X through it.
+- That's all.  Nothing else works except for quit.
+------------------------------------------------------
+
+Added some sketches in README.gui-sketch.  I'm thinking that the control
+panel will be able to basically show one of these screens at a time.  When
+you first start you would see ChooseConfigScreen which chooses between the
+configurations that you have loaded recently (which it would remember
+by the pathname of their bochsrc).  Whether you choose an existing 
+configuration to be loaded or a new one, when you click Ok you go to
+the first configuration screen, ConfigDiskScreen.
+
+Each of the configuration screens takes up the whole control panel window.
+We could use tabs on the top and/or "<-Prev" and "Next->" buttons to make
+it quick to navigate the configuration screens.  Each screen should
+probably have a Prev, Next, Revert to Saved, and Accept button.
+The menu choices like Disk..., VGA..., etc. just switch directly to
+that tab.
+
+
+------------------------------------------------------
+Notes:
+
+events from gui to sim:
+- [async] key pressed or released
+- [async] mouse motion with button state
+- [sync] query parameter
+- [sync] change parameter
+- [async] start, pause, stop, reset simulation.  Can be implemented
+  as changing a parameter.
+- [async] request notification when some param changes
+
+events from sim to gui:
+- [async] log message to be displayed (or not)
+- [async] ask user how to proceed (like panic: action=ask)
+- [async] param value changed
+- make my thread sleep for X microseconds  (call wxThread::sleep then return)
+
+
+implement the floppyA and floppyB change buttons using new event
+structure.  How should it work?
+
+vga gui detects a click on floppyA bitmap
+construct a BxEvent type BX_EVT_ASK_PARAM
+post the event to the wxwindows gui thread (somehow) and block for response
+when it arrives in the gui thread, show a modal dialog box
+get the answer back to the simulator thread
+
+
+right now, this is working ok within the simulator thread using
+wxMutexGuiEnter/Leave.  Still I'm going to change it so that the
+siminterface.cc code builds an event structure and the gui code
+fills in the blank in the structure, instead of the stupid 
+notify_get_int_arg stuff.
+
+
+Starting and Killing Threads
+
+When a detachable (default) thread finishes (returns from its Entry()
+function), wxwindows frees the memory associated with that thread.  
+Unless the thread is never going to end, it is potentially dangerous to have a
+pointer to it at all.  Even if you try to "check if it's alive" first, you may
+be dereferencing the pointer after it has already been deleted, leading to it
+claiming to be alive when it's not, or a segfault.  To solve this, the approach
+used in the wxwindows threads example is to have code in the thread's OnExit()
+method remove the thread's pointer from the list of usable threads.  In
+addition, any references or changes to the list of threads is controlled by a
+critical section to ensure that it stays correct.  This post finally 
+explained what I was seeing.
+
++-----------------------
+| From: Pieter van der Meulen (pgmvdm@yahoo.com)
+|  Subject: Re: Thread Sample program - bug 
+|  Newsgroups: comp.soft-sys.wxwindows
+|  Date: 2001-06-28 17:51:35 PST 
+| 
+| 
+| At 06:24 PM 6/28/2001, you wrote:
+| >Hi,
+| >I have wxWindows 2.2.7 (wxMSW) installed.
+| >
+| >I just found in the thread.cpp sample code this section:
+| >
+| ><code>
+| >void MyFrame::OnQuit(wxCommandEvent& WXUNUSED(event) )
+| >{
+| >     size_t count = wxGetApp().m_threads.Count();
+| >     for ( size_t i = 0; i < count; i++ )
+| >     {
+| >===>        wxGetApp().m_threads[0]->Delete();    <=====
+| >     }
+| >
+| >     Close(TRUE);
+| >}
+| ></code>
+| >The indecated line should probably rather have a
+| >m_threads[i]     rather than     m_threads[0] .
+| 
+| No, it should not, although it is not immediately obvious. When Delete() is 
+| called, the thread will eventually delete itself, but not before it calls 
+| MyThread::Exit(), which will remove itself from m_threads[] using 
+| wxArray::Remove(this). wxArray::Remove (RemoveAt) will compact the array to 
+| remove the element, it is now size-1. After this wxThread::Delete() returns.
+| 
+| 
+| >I have have a further question to this:
+| >Does this mean that a detached thread created with new
+| >HAS to be deleted  manually ?  Or is this only in case it might still
+| >be running?
+| 
+| Firstly, you must create every detached thread using new since it will 
+| delete itself, literally calling delete this.
+| Calling wxThread::Delete() is a correct way to terminate a thread, but 
+| manually deleting (using delete) a detached wxThread object is not. 
+| wxThread::Delete() will ask the thread to exit, the thread should check for 
+| this in wxThread::Entry() regularly using wxThread::TestDestroy() and exit 
+| when asked to do so.
+| 
+| >(In general I have a unsatisfied felling about when delete is
+| >neccessary and when not -- "I only know, it's not , if the class is
+| >derived from wxWindows")
+| 
+| For wxThreads: joinable threads must be deleted (when allocated on the 
+| heap), detached threads may never be deleted. For other classes, consult 
+| the documentation ;)
+| 
+| 
+| >Thanks for some feedback,
+| >Sebastian
+| 
+| Regards,
+| 
+| Pieter.
++-----------------------
+
+
+
+-------------------------------------------------------------
 Bochs x86 Pentium Emulator
 Upated: Mon Mar 11 12:30:24  2002
 Version: 1.4.pre2
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/README.gui-sketch wxclean/README.gui-sketch
--- clean-1.4.pre2/README.gui-sketch	Wed Dec 31 19:00:00 1969
+++ wxclean/README.gui-sketch	Sun Mar 17 02:41:34 2002
@@ -0,0 +1,201 @@
+Here are some quick ASCII sketches of what different parts of the interface
+look like.  Nothing is implemented yet, and everything is open for debate.
+Whoever writes the wxwindows code for any of these screens gets several
+thousand votes.
+
+
+Menus:
+- Configuration
+  +----------------------+
+  | New Configuration    |
+  | Read Configuration   |
+  | Save Configuration   |
+  +----------------------+
+  | Quit                 |
+  +----------------------+
+- Edit
+  +----------------------+
+  | Disks...             |
+  | Boot              -----------> Floppy, Hard disk, or Cdrom
+  | VGA...               |
+  | Memory...            |
+  | Sound...             |
+  | Networking...        |
+  | Keyboard...          |
+  | Other...             |
+  +----------------------+
+- Simulate
+  +----------------------+
+  | Start                |
+  | Pause/Resume         |
+  | Stop                 |
+  +----------------------+
+  | Speed...             |
+  +----------------------|
+- Debug
+  +----------------------|
+  | Show CPU             |
+  | Show Memory          |
+  | ? what else ?        |
+  +----------------------|
+- Event Log
+  +----------------------+
+  | View                 |
+  | Preferences...       |
+  | By Device...         |
+  +----------------------+
+- Help
+  +----------------------+
+  | About Bochs...       |
+  +----------------------+
+
+What should show up on the control panel when it first comes up?
+I think the standard thing should be to choose a configuration and
+start simulating.
+
+
+ChooseConfigScreen:
++--------------------------------------------------------+
+|                                                        |
+|   Choose a configuration for the Bochs simulator:      |
+|                                                        |
+|   +---+                                                |
+|   | O |    DLX Linux Demo                              |
+|   | | |    Boot 10MB Hard Disk                         |
+|   +---+                                                |
+|                                                        |
+|   +---+                                                |
+|   | O |    Redhat Linux Image                          |
+|   | | |    Boot 10MB Hard Disk                         |
+|   +---+                                                |
+|                                                        |
+|   +---+                                                |
+|   | O |    FreeDOS                                     |
+|   | | |    Boot 40MB Hard Disk                         |
+|   +---+                                                |
+|                                                        |
+|                                                        |
+|    ??      Create new configuration                    |
+|                                                        |
+|                                                        |
+|                        [                               |
++--------------------------------------------------------+
+
+ConfigDisksScreen:
++---------------------------------------------------------------+
+|                                                               |
+|          /----+                                               |
+|          |=  =|   A Drive                             +----+  |
+| [    ]   | __ |   Raw Floppy Drive                    |Edit|  |
+|          ||  ||   A:                                  +----+  |
+|          ++--++                                               |
+|                                                               |
+|          /----+                                               |
+|          |=  =|   B Drive                             +----+  |
+| [    ]   | __ |   Floppy Disk Image                   |Edit|  |
+|          ||  ||   C:\Bochs\Images\A.img               +----+  |
+|          ++--++                                               |
+|                                                               |
+|          +-----+  C Drive                                     |
+|          |=====|  Hard Disk Image                     +----+  | 
+| [BOOT]   |    o|  C:\Bochs\Images\HD30meg.img         |Edit|  |
+|          +-----+                                      +----+  |
+|                                                               |
+|            ___                                                |
+|           /   \   D Drive                             +----+  |
+| [    ]   |  O  |  ISO CD Image                        |Edit|  |
+|           \___/   C:\Bochs\Images\BootCD.img          +----+  |
+|                                                               |
+|                                                               |
++---------------------------------------------------------------+
+
+EditFloppyScreen:
++---------------------------------------------------------------+
+|                                                               |
+| Bochs can use a real floppy drive as Disk A, or use an        |
+| image file.                                                   |
+|                                                               |
+|  [X]  Physical A: drive                                       |
+|  [ ]  Physical B: drive                                       |
+|  [ ]  Disk image: [_____________________________] [Browse]    |
+|         Capacity: [1.44 MB]                                   |
+|                                                               |
+| Hint: To create a disk image, choose the name and capacity    |
+| above, then click Ok.                                         |
+|                                                               |
+|                                            [ Cancel ]  [ Ok ] |
++---------------------------------------------------------------+
+
+
+ConfigVgaScreen:
+FIXME
+
+ConfigMemoryScreen:
+romimage: file=bios/BIOS-bochs-latest, address=0xf0000
+megs: 32
+vgaromimage: bios/VGABIOS-elpin-2.40
+FIXME
+
+ConfigSoundScreen:
+sb16: midimode=1, midi=/dev/midi00, wavemode=1, wave=/dev/dsp, loglevel=2, log=sb16.log, dmatimer=600000
+FIXME
+
+ConfigNetworkingScreen:
++---------------------------------------------------------------+
+|                                                               |
+|  Bochs can emulate an NE2000-compatible network card.  Would  |
+|  you like to enable it?                                       |
+|                                                               |
+|      Enable networking?  [X]                                  |
+|                                                               |
+|      NE2000 I/O address: [ 0x280 ]                            |
+|                     IRQ: [   9   ]                            |
+|             MAC address: [ b0:c4:00:00:00:00 ]                |
+|    Connection to the OS: [ Linux Packet Filter ]              |
+|     Physical NIC to use: [ eth0 ]                             |
+|   NE2000 Debug messages: [ ]                                  |
+|                                                               |
++---------------------------------------------------------------+
+
+ConfigKeyboardScreen:
+keyboard_mapping: enabled=1, map=US,France,Germany,Spain
+keyboard_type: xt,at,mf
+keyboard_serial_delay: 250
+
+FIXME
+
+ConfigOtherScreen:
+FIXME
+
+ConfigSpeedScreen:
+explain what the heck ips is
+adjust ips with a slider?
+FIXME
+
+EventLogPreferences:
+FIXME
+panic: action=ignore,report,fatal,ask
+error: action=ignore,report,fatal,ask
+info: action=ignore,report,fatal,ask
+debug: action=ignore,report,fatal,ask
+
+EventLogPrefByDevice:
+FIXME
+keyboard    panic=ask  error=report  info=report  debug=ignore
+vga         panic=ask  error=report  info=report  debug=ignore
+network     panic=ask  error=report  info=report  debug=ignore
+cpu         panic=ask  error=report  info=report  debug=ignore
+sound       panic=ask  error=report  info=report  debug=ignore
+etc. for about 20 devices.
+
+DebugShowCpuRegisters:
+show standard cpu registers and state
+values will update in real time
+this is sort of the start of the debugger interface
+when debugging, maybe highlight values that change between sim steps
+
+DebugShowMemory:
+let use choose memory ranges to display
+when debugging, maybe highlight values that change between sim steps
+
+
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/bios/rombios.c wxclean/bios/rombios.c
--- clean-1.4.pre2/bios/rombios.c	Sun Mar 17 04:16:28 2002
+++ wxclean/bios/rombios.c	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: rombios.c,v 1.37 2002/03/11 00:17:30 cbothamy Exp $
+// $Id: rombios.c,v 1.14.2.1 2002/03/17 08:51:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -995,10 +995,10 @@
 
 #endif // BX_ELTORITO_BOOT
 
-static char bios_cvs_version_string[] = "$Revision: 1.37 $";
-static char bios_date_string[] = "$Date: 2002/03/11 00:17:30 $";
+static char bios_cvs_version_string[] = "$Revision: 1.14.2.1 $";
+static char bios_date_string[] = "$Date: 2002/03/17 08:51:19 $";
 
-static char CVSID[] = "$Id: rombios.c,v 1.37 2002/03/11 00:17:30 cbothamy Exp $";
+static char CVSID[] = "$Id: rombios.c,v 1.14.2.1 2002/03/17 08:51:19 bdenney Exp $";
 
 /* Offset to skip the CVS $Id: prefix */ 
 #define bios_version_string  (CVSID + 4)
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/bios/usage.cc wxclean/bios/usage.cc
--- clean-1.4.pre2/bios/usage.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/bios/usage.cc	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: usage.cc,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: usage.cc,v 1.2.8.2 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -45,7 +45,7 @@
 
   if (argc !=3 ) {
     fprintf(stderr, "Usage: usage bios-file org-file\n");
-    exit(1);
+    BX_EXIT(1);
     }
 
   bios_file = open(argv[1], O_RDONLY);
@@ -53,7 +53,7 @@
 
   if ( (bios_file<0) | (org_file==NULL) ) {
     fprintf(stderr, "problems opening files.\n");
-    exit(1);
+    BX_EXIT(1);
     }
 
   printf("files opened OK\n");
@@ -64,7 +64,7 @@
     retval = read(bios_file, &bios[index], to_read);
     if (retval <= 0) {
       fprintf(stderr, "problem reading bios file\n");
-      exit(1);
+      BX_EXIT(1);
       }
     to_read -= retval;
     index   += retval;
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/bochs.h wxclean/bochs.h
--- clean-1.4.pre2/bochs.h	Tue Mar  5 10:52:24 2002
+++ wxclean/bochs.h	Sun Mar 17 04:12:46 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: bochs.h,v 1.59 2002/03/03 06:03:29 bdenney Exp $
+// $Id: bochs.h,v 1.39.2.3 2002/03/17 08:51:16 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -463,7 +463,7 @@
 
 #define BX_ASSERT(x) do {if (!(x)) BX_PANIC(("failed assertion \"%s\" at %s:%d\n", #x, __FILE__, __LINE__));} while (0)
 void bx_signal_handler (int signum);
-void bx_atexit(void);
+int bx_atexit(void);
 extern bx_debug_t bx_dbg;
 
 
@@ -516,7 +516,7 @@
 #define BX_RESET_SOFTWARE 10
 #define BX_RESET_HARDWARE 11
 
-
+void bx_init_before_control_panel ();
 char *bx_find_bochsrc (void);
 int bx_parse_cmdline (int arg, int argc, char *argv[]);
 int bx_read_configuration (char *rcfile);
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/build/redhat/make-rpm wxclean/build/redhat/make-rpm
--- clean-1.4.pre2/build/redhat/make-rpm	Sat Dec  8 10:59:50 2001
+++ wxclean/build/redhat/make-rpm	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 #!/bin/bash -x
 #########################################################################
-# $Id: make-rpm,v 1.1 2001/12/08 15:59:50 bdenney Exp $
+# $Id: make-rpm,v 1.1.4.1 2002/03/17 08:51:19 bdenney Exp $
 #########################################################################
 # build/redhat/make-rpm
 #
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/build/win32/cc2cpp wxclean/build/win32/cc2cpp
--- clean-1.4.pre2/build/win32/cc2cpp	Wed Dec 31 19:00:00 1969
+++ wxclean/build/win32/cc2cpp	Sun Mar 17 03:54:18 2002
@@ -0,0 +1,6 @@
+#!/bin/sh
+
+list=`find . -name '*.cc' | sed 's/\.cc$//'`
+for i in $list; do 
+  mv ${i}.cc ${i}.cpp
+done
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/build/win32/cpp2cc wxclean/build/win32/cpp2cc
--- clean-1.4.pre2/build/win32/cpp2cc	Wed Dec 31 19:00:00 1969
+++ wxclean/build/win32/cpp2cc	Sun Mar 17 03:54:18 2002
@@ -0,0 +1,6 @@
+#!/bin/sh
+
+list=`find . -name '*.cpp' | sed 's/\.cpp$//'`
+for i in $list; do 
+  mv ${i}.cpp ${i}.cc
+done
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/build/win32/diffcc2cpp wxclean/build/win32/diffcc2cpp
--- clean-1.4.pre2/build/win32/diffcc2cpp	Wed Dec 31 19:00:00 1969
+++ wxclean/build/win32/diffcc2cpp	Sun Mar 17 03:54:18 2002
@@ -0,0 +1,6 @@
+#!/bin/sh
+
+list=`find . -name '*.cpp' | sed 's/\.cpp$//'`
+for i in $list; do 
+  diff -u ${i}.cc ${i}.cpp
+done
Binary files clean-1.4.pre2/build/win32/workspace.zip and wxclean/build/win32/workspace.zip differ
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/config.h.in wxclean/config.h.in
--- clean-1.4.pre2/config.h.in	Fri Mar  8 23:08:54 2002
+++ wxclean/config.h.in	Sun Mar 17 04:12:46 2002
@@ -40,6 +40,17 @@
 // USER CONFIGURABLE OPTIONS : EDIT ONLY OPTIONS IN THIS SECTION //
 ///////////////////////////////////////////////////////////////////
 
+
+#define USE_WX 1
+
+#if 1
+// quit_sim is defined in gui/siminterface.h
+#define BX_EXIT(x)  SIM->quit_sim (x)
+#else
+// provide the real main and the usual exit.
+#define BX_EXIT(x)  ::exit(x)
+#endif
+
 #define BX_USE_CONTROL_PANEL 1
 
 // I have tested the following combinations:
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/access.cc wxclean/cpu/access.cc
--- clean-1.4.pre2/cpu/access.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/access.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: access.cc,v 1.12 2001/10/03 13:10:37 bdenney Exp $
+// $Id: access.cc,v 1.7.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/apic.cc wxclean/cpu/apic.cc
--- clean-1.4.pre2/cpu/apic.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/apic.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: apic.cc,v 1.8 2001/10/03 13:10:37 bdenney Exp $
+// $Id: apic.cc,v 1.6.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #define NEED_CPU_REG_SHORTCUTS 1
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/arith16.cc wxclean/cpu/arith16.cc
--- clean-1.4.pre2/cpu/arith16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/arith16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: arith16.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: arith16.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/arith32.cc wxclean/cpu/arith32.cc
--- clean-1.4.pre2/cpu/arith32.cc	Sat Nov 17 17:22:04 2001
+++ wxclean/cpu/arith32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: arith32.cc,v 1.7 2001/11/17 22:22:03 bdenney Exp $
+// $Id: arith32.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/arith8.cc wxclean/cpu/arith8.cc
--- clean-1.4.pre2/cpu/arith8.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/arith8.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: arith8.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: arith8.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/bcd.cc wxclean/cpu/bcd.cc
--- clean-1.4.pre2/cpu/bcd.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/bcd.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: bcd.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: bcd.cc,v 1.4.4.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/bit.cc wxclean/cpu/bit.cc
--- clean-1.4.pre2/cpu/bit.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/bit.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: bit.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: bit.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/cpu.cc wxclean/cpu/cpu.cc
--- clean-1.4.pre2/cpu/cpu.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/cpu/cpu.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: cpu.cc,v 1.23 2002/02/15 22:58:06 yakovlev Exp $
+// $Id: cpu.cc,v 1.12.2.2 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -476,6 +476,9 @@
       return;
     }
 #endif
+  } else if (BX_CPU_THIS_PTR kill_bochs_request) {
+    // setting kill_bochs_request causes the cpu loop to return ASAP.
+    return;
   }
 
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/cpu.h wxclean/cpu/cpu.h
--- clean-1.4.pre2/cpu/cpu.h	Wed Oct  3 15:53:48 2001
+++ wxclean/cpu/cpu.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: cpu.h,v 1.15 2001/10/03 19:53:48 instinc Exp $
+// $Id: cpu.h,v 1.8.2.2 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -764,6 +764,7 @@
   Bit32u   debug_trap; // holds DR6 value to be set as well
   volatile Boolean async_event;
   volatile Boolean INTR;
+  volatile Boolean kill_bochs_request;
 
   // for accessing registers by index number
   Bit16u *_16bit_base_reg[8];
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/ctrl_xfer16.cc wxclean/cpu/ctrl_xfer16.cc
--- clean-1.4.pre2/cpu/ctrl_xfer16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/ctrl_xfer16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: ctrl_xfer16.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: ctrl_xfer16.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/ctrl_xfer32.cc wxclean/cpu/ctrl_xfer32.cc
--- clean-1.4.pre2/cpu/ctrl_xfer32.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/cpu/ctrl_xfer32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: ctrl_xfer32.cc,v 1.8 2002/02/22 05:33:36 yakovlev Exp $
+// $Id: ctrl_xfer32.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/ctrl_xfer8.cc wxclean/cpu/ctrl_xfer8.cc
--- clean-1.4.pre2/cpu/ctrl_xfer8.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/ctrl_xfer8.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: ctrl_xfer8.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: ctrl_xfer8.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/ctrl_xfer_pro.cc wxclean/cpu/ctrl_xfer_pro.cc
--- clean-1.4.pre2/cpu/ctrl_xfer_pro.cc	Sat Nov 10 18:00:56 2001
+++ wxclean/cpu/ctrl_xfer_pro.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: ctrl_xfer_pro.cc,v 1.10 2001/11/10 23:00:55 bdenney Exp $
+// $Id: ctrl_xfer_pro.cc,v 1.7.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/data_xfer16.cc wxclean/cpu/data_xfer16.cc
--- clean-1.4.pre2/cpu/data_xfer16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/data_xfer16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: data_xfer16.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: data_xfer16.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/data_xfer32.cc wxclean/cpu/data_xfer32.cc
--- clean-1.4.pre2/cpu/data_xfer32.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/data_xfer32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: data_xfer32.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: data_xfer32.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/data_xfer8.cc wxclean/cpu/data_xfer8.cc
--- clean-1.4.pre2/cpu/data_xfer8.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/data_xfer8.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: data_xfer8.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: data_xfer8.cc,v 1.4.4.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/debugstuff.cc wxclean/cpu/debugstuff.cc
--- clean-1.4.pre2/cpu/debugstuff.cc	Tue Oct  9 17:15:14 2001
+++ wxclean/cpu/debugstuff.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: debugstuff.cc,v 1.11 2001/10/09 21:15:14 bdenney Exp $
+// $Id: debugstuff.cc,v 1.7.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/decode16.cc wxclean/cpu/decode16.cc
--- clean-1.4.pre2/cpu/decode16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/decode16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: decode16.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: decode16.cc,v 1.4.4.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/decode32.cc wxclean/cpu/decode32.cc
--- clean-1.4.pre2/cpu/decode32.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/decode32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: decode32.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: decode32.cc,v 1.4.4.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/exception.cc wxclean/cpu/exception.cc
--- clean-1.4.pre2/cpu/exception.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/cpu/exception.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: exception.cc,v 1.9 2001/10/03 13:10:37 bdenney Exp $
+// $Id: exception.cc,v 1.8.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/fetchdecode.cc wxclean/cpu/fetchdecode.cc
--- clean-1.4.pre2/cpu/fetchdecode.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/fetchdecode.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: fetchdecode.cc,v 1.7 2001/10/03 13:10:37 bdenney Exp $
+// $Id: fetchdecode.cc,v 1.6.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/flag_ctrl.cc wxclean/cpu/flag_ctrl.cc
--- clean-1.4.pre2/cpu/flag_ctrl.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/flag_ctrl.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: flag_ctrl.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: flag_ctrl.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/flag_ctrl_pro.cc wxclean/cpu/flag_ctrl_pro.cc
--- clean-1.4.pre2/cpu/flag_ctrl_pro.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/flag_ctrl_pro.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: flag_ctrl_pro.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: flag_ctrl_pro.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/init.cc wxclean/cpu/init.cc
--- clean-1.4.pre2/cpu/init.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/init.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: init.cc,v 1.14 2001/10/03 13:10:37 bdenney Exp $
+// $Id: init.cc,v 1.10.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -50,7 +50,7 @@
 
 void BX_CPU_C::init(BX_MEM_C *addrspace)
 {
-  BX_DEBUG(( "Init $Id: init.cc,v 1.14 2001/10/03 13:10:37 bdenney Exp $"));
+  BX_DEBUG(( "Init $Id: init.cc,v 1.10.2.1 2002/03/17 08:57:01 bdenney Exp $"));
   // BX_CPU_C constructor
   BX_CPU_THIS_PTR set_INTR (0);
 #if BX_SUPPORT_APIC
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/io.cc wxclean/cpu/io.cc
--- clean-1.4.pre2/cpu/io.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/io.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: io.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: io.cc,v 1.4.4.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/io_pro.cc wxclean/cpu/io_pro.cc
--- clean-1.4.pre2/cpu/io_pro.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/io_pro.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: io_pro.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: io_pro.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/lazy_flags.cc wxclean/cpu/lazy_flags.cc
--- clean-1.4.pre2/cpu/lazy_flags.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/lazy_flags.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: lazy_flags.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: lazy_flags.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/lazy_flags.h wxclean/cpu/lazy_flags.h
--- clean-1.4.pre2/cpu/lazy_flags.h	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/lazy_flags.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: lazy_flags.h,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: lazy_flags.h,v 1.2.8.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/logical16.cc wxclean/cpu/logical16.cc
--- clean-1.4.pre2/cpu/logical16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/logical16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: logical16.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: logical16.cc,v 1.4.4.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/logical32.cc wxclean/cpu/logical32.cc
--- clean-1.4.pre2/cpu/logical32.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/logical32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: logical32.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: logical32.cc,v 1.4.4.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/logical8.cc wxclean/cpu/logical8.cc
--- clean-1.4.pre2/cpu/logical8.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/logical8.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: logical8.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: logical8.cc,v 1.4.4.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/mult16.cc wxclean/cpu/mult16.cc
--- clean-1.4.pre2/cpu/mult16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/mult16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: mult16.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: mult16.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/mult32.cc wxclean/cpu/mult32.cc
--- clean-1.4.pre2/cpu/mult32.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/mult32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: mult32.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: mult32.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/mult8.cc wxclean/cpu/mult8.cc
--- clean-1.4.pre2/cpu/mult8.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/mult8.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: mult8.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: mult8.cc,v 1.5.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/paging.cc wxclean/cpu/paging.cc
--- clean-1.4.pre2/cpu/paging.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/paging.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: paging.cc,v 1.8 2001/10/03 13:10:37 bdenney Exp $
+// $Id: paging.cc,v 1.6.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/proc_ctrl.cc wxclean/cpu/proc_ctrl.cc
--- clean-1.4.pre2/cpu/proc_ctrl.cc	Sun Nov 18 11:32:40 2001
+++ wxclean/cpu/proc_ctrl.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: proc_ctrl.cc,v 1.17 2001/11/18 16:32:40 bdenney Exp $
+// $Id: proc_ctrl.cc,v 1.11.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/protect_ctrl.cc wxclean/cpu/protect_ctrl.cc
--- clean-1.4.pre2/cpu/protect_ctrl.cc	Tue Oct  9 17:15:14 2001
+++ wxclean/cpu/protect_ctrl.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: protect_ctrl.cc,v 1.10 2001/10/09 21:15:14 bdenney Exp $
+// $Id: protect_ctrl.cc,v 1.7.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/protect_ctrl_pro.cc wxclean/cpu/protect_ctrl_pro.cc
--- clean-1.4.pre2/cpu/protect_ctrl_pro.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/protect_ctrl_pro.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: protect_ctrl_pro.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: protect_ctrl_pro.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/resolve16.cc wxclean/cpu/resolve16.cc
--- clean-1.4.pre2/cpu/resolve16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/resolve16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: resolve16.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: resolve16.cc,v 1.4.4.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/resolve32.cc wxclean/cpu/resolve32.cc
--- clean-1.4.pre2/cpu/resolve32.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/resolve32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: resolve32.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: resolve32.cc,v 1.4.4.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/segment_ctrl.cc wxclean/cpu/segment_ctrl.cc
--- clean-1.4.pre2/cpu/segment_ctrl.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/segment_ctrl.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: segment_ctrl.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: segment_ctrl.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/segment_ctrl_pro.cc wxclean/cpu/segment_ctrl_pro.cc
--- clean-1.4.pre2/cpu/segment_ctrl_pro.cc	Tue Nov 13 00:11:42 2001
+++ wxclean/cpu/segment_ctrl_pro.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: segment_ctrl_pro.cc,v 1.11 2001/11/13 05:11:41 bdenney Exp $
+// $Id: segment_ctrl_pro.cc,v 1.6.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/shift16.cc wxclean/cpu/shift16.cc
--- clean-1.4.pre2/cpu/shift16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/shift16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: shift16.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: shift16.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/shift32.cc wxclean/cpu/shift32.cc
--- clean-1.4.pre2/cpu/shift32.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/shift32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: shift32.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: shift32.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/shift8.cc wxclean/cpu/shift8.cc
--- clean-1.4.pre2/cpu/shift8.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/shift8.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: shift8.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: shift8.cc,v 1.4.4.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/soft_int.cc wxclean/cpu/soft_int.cc
--- clean-1.4.pre2/cpu/soft_int.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/soft_int.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: soft_int.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: soft_int.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/stack16.cc wxclean/cpu/stack16.cc
--- clean-1.4.pre2/cpu/stack16.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/stack16.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: stack16.cc,v 1.7 2001/10/03 13:10:37 bdenney Exp $
+// $Id: stack16.cc,v 1.6.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/stack32.cc wxclean/cpu/stack32.cc
--- clean-1.4.pre2/cpu/stack32.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/cpu/stack32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: stack32.cc,v 1.8 2002/03/05 15:50:17 bdenney Exp $
+// $Id: stack32.cc,v 1.6.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/stack_pro.cc wxclean/cpu/stack_pro.cc
--- clean-1.4.pre2/cpu/stack_pro.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/stack_pro.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: stack_pro.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: stack_pro.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/string.cc wxclean/cpu/string.cc
--- clean-1.4.pre2/cpu/string.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/cpu/string.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: string.cc,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: string.cc,v 1.4.4.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/tasking.cc wxclean/cpu/tasking.cc
--- clean-1.4.pre2/cpu/tasking.cc	Sat Nov 10 23:57:06 2001
+++ wxclean/cpu/tasking.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: tasking.cc,v 1.9 2001/11/11 04:57:05 bdenney Exp $
+// $Id: tasking.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/cpu/vm8086.cc wxclean/cpu/vm8086.cc
--- clean-1.4.pre2/cpu/vm8086.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/cpu/vm8086.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: vm8086.cc,v 1.9 2002/03/01 17:27:25 bdenney Exp $
+// $Id: vm8086.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/crc.cc wxclean/debug/crc.cc
--- clean-1.4.pre2/debug/crc.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/debug/crc.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: crc.cc,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: crc.cc,v 1.1.10.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  I grabbed these CRC routines from the following source:
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/dbg_main.cc wxclean/debug/dbg_main.cc
--- clean-1.4.pre2/debug/dbg_main.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/debug/dbg_main.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: dbg_main.cc,v 1.37 2002/02/15 22:58:06 yakovlev Exp $
+// $Id: dbg_main.cc,v 1.18.2.2 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -285,7 +285,7 @@
       BX_ERROR(( "%s: -rc option used, but no path specified.",
         argv[0] ));
       bx_dbg_usage();
-      exit(1);
+      BX_EXIT(1);
       }
     strncpy(bx_debug_rc_fname, argv[2], BX_MAX_PATH-1);
     i += 2; // skip past "-rc" and filename
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/debug.h wxclean/debug/debug.h
--- clean-1.4.pre2/debug/debug.h	Sun Mar 17 04:16:28 2002
+++ wxclean/debug/debug.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: debug.h,v 1.10 2001/11/28 18:37:12 instinc Exp $
+// $Id: debug.h,v 1.4.4.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/lexer.c wxclean/debug/lexer.c
--- clean-1.4.pre2/debug/lexer.c	Wed Nov 28 13:40:02 2001
+++ wxclean/debug/lexer.c	Sun Mar 17 04:12:50 2002
@@ -19,7 +19,7 @@
 /* A lexical scanner generated by flex */
 
 /* Scanner skeleton version:
- * $Header: /cvsroot/bochs/bochs/debug/lexer.c,v 1.9 2001/11/28 18:40:02 instinc Exp $
+ * $Header: /cvsroot/bochs/bochs/debug/lexer.c,v 1.5.4.1 2002/03/17 08:51:20 bdenney Exp $
  */
 
 #define FLEX_SCANNER
@@ -601,7 +601,7 @@
 #define INITIAL 0
 #line 2 "lexer.l"
 /////////////////////////////////////////////////////////////////////////
-// $Id: lexer.c,v 1.9 2001/11/28 18:40:02 instinc Exp $
+// $Id: lexer.c,v 1.5.4.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 
 #include <stdlib.h>
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/lexer.l wxclean/debug/lexer.l
--- clean-1.4.pre2/debug/lexer.l	Wed Nov 28 13:39:20 2001
+++ wxclean/debug/lexer.l	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 %{
 /////////////////////////////////////////////////////////////////////////
-// $Id: lexer.l,v 1.8 2001/11/28 18:39:19 instinc Exp $
+// $Id: lexer.l,v 1.4.4.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 
 #include <stdlib.h>
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/linux.cc wxclean/debug/linux.cc
--- clean-1.4.pre2/debug/linux.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/debug/linux.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: linux.cc,v 1.4 2001/10/03 13:10:37 bdenney Exp $
+// $Id: linux.cc,v 1.3.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #include <stdio.h>
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/linux.h wxclean/debug/linux.h
--- clean-1.4.pre2/debug/linux.h	Wed Oct  3 09:10:38 2001
+++ wxclean/debug/linux.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: linux.h,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: linux.h,v 1.2.4.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/loader_misc.h wxclean/debug/loader_misc.h
--- clean-1.4.pre2/debug/loader_misc.h	Wed Oct  3 09:10:38 2001
+++ wxclean/debug/loader_misc.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: loader_misc.h,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: loader_misc.h,v 1.2.8.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/parser.y wxclean/debug/parser.y
--- clean-1.4.pre2/debug/parser.y	Wed Nov 28 13:35:22 2001
+++ wxclean/debug/parser.y	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: parser.y,v 1.6 2001/11/28 18:35:21 instinc Exp $
+// $Id: parser.y,v 1.2.4.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 
 %{
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/sim2.cc wxclean/debug/sim2.cc
--- clean-1.4.pre2/debug/sim2.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/debug/sim2.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: sim2.cc,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: sim2.cc,v 1.2.8.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/debug/syscalls-linux.h wxclean/debug/syscalls-linux.h
--- clean-1.4.pre2/debug/syscalls-linux.h	Wed Oct  3 09:10:38 2001
+++ wxclean/debug/syscalls-linux.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: syscalls-linux.h,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: syscalls-linux.h,v 1.2.4.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //////////////////////////////////////////////////////////////////////////////
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/disasm/dis_decode.cc wxclean/disasm/dis_decode.cc
--- clean-1.4.pre2/disasm/dis_decode.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/disasm/dis_decode.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: dis_decode.cc,v 1.8 2001/10/03 13:10:37 bdenney Exp $
+// $Id: dis_decode.cc,v 1.6.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/disasm/dis_groups.cc wxclean/disasm/dis_groups.cc
--- clean-1.4.pre2/disasm/dis_groups.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/disasm/dis_groups.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: dis_groups.cc,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: dis_groups.cc,v 1.2.8.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/disasm/disasm.h wxclean/disasm/disasm.h
--- clean-1.4.pre2/disasm/disasm.h	Wed Oct  3 09:10:38 2001
+++ wxclean/disasm/disasm.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: disasm.h,v 1.5 2001/10/03 13:10:37 bdenney Exp $
+// $Id: disasm.h,v 1.4.4.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/doc/docbook/Makefile wxclean/doc/docbook/Makefile
--- clean-1.4.pre2/doc/docbook/Makefile	Wed Mar  6 12:05:58 2002
+++ wxclean/doc/docbook/Makefile	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 ###################################################################
 # doc/docbook/Makefile
-# $Id: Makefile,v 1.7 2002/03/06 15:46:16 bdenney Exp $
+# $Id: Makefile,v 1.5.2.1 2002/03/17 08:51:20 bdenney Exp $
 #
 # Builds documentation in various formats from SGML source, and
 # allows easy update to the Bochs web site.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/doc/docbook/Makefile.jade wxclean/doc/docbook/Makefile.jade
--- clean-1.4.pre2/doc/docbook/Makefile.jade	Tue Sep 25 15:29:28 2001
+++ wxclean/doc/docbook/Makefile.jade	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 ###################################################################
 # doc/docbook/Makefile
-# $Id: Makefile.jade,v 1.1 2001/09/25 19:29:28 bdenney Exp $
+# $Id: Makefile.jade,v 1.1.4.1 2002/03/17 08:51:20 bdenney Exp $
 #
 # Builds documentation in various formats from SGML source, and
 # allows easy update to the Bochs web site.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/doc/docbook/development/development.dbk wxclean/doc/docbook/development/development.dbk
--- clean-1.4.pre2/doc/docbook/development/development.dbk	Sat Nov 17 12:15:38 2001
+++ wxclean/doc/docbook/development/development.dbk	Sun Mar 17 04:12:50 2002
@@ -1,7 +1,7 @@
 <!--
 ================================================================
 doc/docbook/development/development.dbk
-$Id: development.dbk,v 1.3 2001/11/17 17:15:38 bdenney Exp $
+$Id: development.dbk,v 1.1.2.1 2002/03/17 08:51:20 bdenney Exp $
 
 This is the top level file for the Bochs Developers Manual.
 ================================================================
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/doc/docbook/documentation/documentation.dbk wxclean/doc/docbook/documentation/documentation.dbk
--- clean-1.4.pre2/doc/docbook/documentation/documentation.dbk	Sat Nov 17 12:14:42 2001
+++ wxclean/doc/docbook/documentation/documentation.dbk	Sun Mar 17 04:12:50 2002
@@ -1,7 +1,7 @@
 <!--
 ================================================================
 doc/docbook/documentation/documentation.dbk
-$Id: documentation.dbk,v 1.9 2001/11/17 17:14:42 bdenney Exp $
+$Id: documentation.dbk,v 1.1.2.1 2002/03/17 08:51:20 bdenney Exp $
 
 This is the top level file for the Bochs Documentation Manual.
 ================================================================
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/doc/docbook/fixtitles.pl wxclean/doc/docbook/fixtitles.pl
--- clean-1.4.pre2/doc/docbook/fixtitles.pl	Sun Sep 16 02:46:12 2001
+++ wxclean/doc/docbook/fixtitles.pl	Sun Mar 17 04:12:50 2002
@@ -6,7 +6,7 @@
 #!perl
 #
 # fix-titles.pl
-# $Id: fixtitles.pl,v 1.1 2001/09/16 06:46:11 bdenney Exp $
+# $Id: fixtitles.pl,v 1.1.4.1 2002/03/17 08:51:20 bdenney Exp $
 #
 # The HTML stylesheet likes to print html has the ends of tags on a different
 # line, like this:
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/doc/docbook/include/defs.sgm wxclean/doc/docbook/include/defs.sgm
--- clean-1.4.pre2/doc/docbook/include/defs.sgm	Sat Nov 17 12:16:12 2001
+++ wxclean/doc/docbook/include/defs.sgm	Sun Mar 17 04:12:50 2002
@@ -1,7 +1,7 @@
 <!--
 ================================================================
 doc/docbook/include/defs.sgm
-$Id: defs.sgm,v 1.6 2001/11/17 17:16:12 bdenney Exp $
+$Id: defs.sgm,v 1.6.4.1 2002/03/17 08:51:20 bdenney Exp $
 
 This file is included by all Bochs docbook files, so that the
 definitions can be used anywhere in the documentation.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/doc/docbook/misc.txt wxclean/doc/docbook/misc.txt
--- clean-1.4.pre2/doc/docbook/misc.txt	Sat Nov 17 12:16:36 2001
+++ wxclean/doc/docbook/misc.txt	Sun Mar 17 04:12:50 2002
@@ -1,4 +1,4 @@
-$Id: misc.txt,v 1.9 2001/11/17 17:16:35 bdenney Exp $
+$Id: misc.txt,v 1.9.4.1 2002/03/17 08:51:20 bdenney Exp $
 
 This is a temporary place to paste in stuff that should go into the docs one
 day.  When it is transferred into docbook, let's remove it from misc.txt.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/doc/docbook/user/user.dbk wxclean/doc/docbook/user/user.dbk
--- clean-1.4.pre2/doc/docbook/user/user.dbk	Fri Mar  8 23:08:56 2002
+++ wxclean/doc/docbook/user/user.dbk	Sun Mar 17 04:12:50 2002
@@ -1,7 +1,7 @@
 <!--
 ================================================================
 doc/docbook/user/user.dbk
-$Id: user.dbk,v 1.33 2002/03/08 17:04:03 bdenney Exp $
+$Id: user.dbk,v 1.1.2.1 2002/03/17 08:51:20 bdenney Exp $
 
 This is the top level file for the Bochs Users Manual.
 ================================================================
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/font/vga.bitmap.h wxclean/font/vga.bitmap.h
--- clean-1.4.pre2/font/vga.bitmap.h	Wed Oct  3 09:10:38 2001
+++ wxclean/font/vga.bitmap.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: vga.bitmap.h,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: vga.bitmap.h,v 1.2.8.1 2002/03/17 08:51:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/control_w.h wxclean/fpu/control_w.h
--- clean-1.4.pre2/fpu/control_w.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/control_w.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  control_w.h                                                              |
- |  $Id: control_w.h,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: control_w.h,v 1.2.8.1 2002/03/17 08:51:20 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992,1993                                                   |
  |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/div_Xsig.c wxclean/fpu/div_Xsig.c
--- clean-1.4.pre2/fpu/div_Xsig.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/div_Xsig.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  div_Xsig.S                                                               |
- |  $Id: div_Xsig.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: div_Xsig.c,v 1.1.10.1 2002/03/17 08:51:20 bdenney Exp $
  |                                                                           |
  | Division subroutine for 96 bit quantities                                 |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/div_small.c wxclean/fpu/div_small.c
--- clean-1.4.pre2/fpu/div_small.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/div_small.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  div_small.S                                                              |
- |  $Id: div_small.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: div_small.c,v 1.1.10.1 2002/03/17 08:51:20 bdenney Exp $
  |                                                                           |
  | Divide a 64 bit integer by a 32 bit integer & return remainder.           |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/errors.c wxclean/fpu/errors.c
--- clean-1.4.pre2/fpu/errors.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/errors.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  errors.c                                                                 |
- |  $Id: errors.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: errors.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  |  The error handling functions for wm-FPU-emu                              |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/exception.h wxclean/fpu/exception.h
--- clean-1.4.pre2/fpu/exception.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/exception.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  exception.h                                                              |
- |  $Id: exception.h,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: exception.h,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992    W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
  |                       Australia.  E-mail   billm@vaxc.cc.monash.edu.au    |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_arith.c wxclean/fpu/fpu_arith.c
--- clean-1.4.pre2/fpu/fpu_arith.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_arith.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_arith.c                                                              |
- |  $Id: fpu_arith.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_arith.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Code to implement the FPU register/register arithmetic instructions       |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_asm.h wxclean/fpu/fpu_asm.h
--- clean-1.4.pre2/fpu/fpu_asm.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_asm.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_asm.h                                                                |
- |  $Id: fpu_asm.h,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_asm.h,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992,1995,1997                                              |
  |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_aux.c wxclean/fpu/fpu_aux.c
--- clean-1.4.pre2/fpu/fpu_aux.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_aux.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_aux.c                                                                |
- |  $Id: fpu_aux.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_aux.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Code to implement some of the FPU auxiliary instructions.                 |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_emu.h wxclean/fpu/fpu_emu.h
--- clean-1.4.pre2/fpu/fpu_emu.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_emu.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_emu.h                                                                |
- |  $Id: fpu_emu.h,v 1.5 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_emu.h,v 1.4.4.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992,1993,1994,1997                                         |
  |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_entry.c wxclean/fpu/fpu_entry.c
--- clean-1.4.pre2/fpu/fpu_entry.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_entry.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_entry.c                                                              |
- |  $Id: fpu_entry.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_entry.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | The entry functions for wm-FPU-emu                                        |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_etc.c wxclean/fpu/fpu_etc.c
--- clean-1.4.pre2/fpu/fpu_etc.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_etc.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_etc.c                                                                |
- |  $Id: fpu_etc.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_etc.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Implement a few FPU instructions.                                         |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_proto.h wxclean/fpu/fpu_proto.h
--- clean-1.4.pre2/fpu/fpu_proto.h	Sat Oct  6 00:35:14 2001
+++ wxclean/fpu/fpu_proto.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: fpu_proto.h,v 1.4 2001/10/06 04:35:13 bdenney Exp $
+// $Id: fpu_proto.h,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_system.h wxclean/fpu/fpu_system.h
--- clean-1.4.pre2/fpu/fpu_system.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_system.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_system.h                                                             |
- |  $Id: fpu_system.h,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_system.h,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992,1994,1997                                              |
  |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_tags.c wxclean/fpu/fpu_tags.c
--- clean-1.4.pre2/fpu/fpu_tags.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_tags.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_tags.c                                                               |
- |  $Id: fpu_tags.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_tags.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  |  Set FPU register tags.                                                   |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/fpu_trig.c wxclean/fpu/fpu_trig.c
--- clean-1.4.pre2/fpu/fpu_trig.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/fpu_trig.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  fpu_trig.c                                                               |
- |  $Id: fpu_trig.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: fpu_trig.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Implementation of the FPU "transcendental" functions.                     |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/get_address.c wxclean/fpu/get_address.c
--- clean-1.4.pre2/fpu/get_address.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/get_address.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  get_address.c                                                            |
- |  $Id: get_address.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: get_address.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Get the effective address from an FPU instruction.                        |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/load_store.c wxclean/fpu/load_store.c
--- clean-1.4.pre2/fpu/load_store.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/load_store.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  load_store.c                                                             |
- |  $Id: load_store.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: load_store.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | This file contains most of the code to interpret the FPU instructions     |
  | which load and store from user memory.                                    |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/mul_Xsig.c wxclean/fpu/mul_Xsig.c
--- clean-1.4.pre2/fpu/mul_Xsig.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/mul_Xsig.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  mul_Xsig.S                                                               |
- |  $Id: mul_Xsig.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: mul_Xsig.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Multiply a 12 byte fixed point number by another fixed point number.      |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/poly.h wxclean/fpu/poly.h
--- clean-1.4.pre2/fpu/poly.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/poly.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  poly.h                                                                   |
- |  $Id: poly.h,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: poly.h,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  |  Header file for the FPU-emu poly*.c source files.                        |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/poly_2xm1.c wxclean/fpu/poly_2xm1.c
--- clean-1.4.pre2/fpu/poly_2xm1.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/poly_2xm1.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  poly_2xm1.c                                                              |
- |  $Id: poly_2xm1.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: poly_2xm1.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Function to compute 2^x-1 by a polynomial approximation.                  |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/poly_atan.c wxclean/fpu/poly_atan.c
--- clean-1.4.pre2/fpu/poly_atan.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/poly_atan.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  poly_atan.c                                                              |
- |  $Id: poly_atan.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: poly_atan.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Compute the arctan of a FPU_REG, using a polynomial approximation.        |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/poly_l2.c wxclean/fpu/poly_l2.c
--- clean-1.4.pre2/fpu/poly_l2.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/poly_l2.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  poly_l2.c                                                                |
- |  $Id: poly_l2.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: poly_l2.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Compute the base 2 log of a FPU_REG, using a polynomial approximation.    |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/poly_sin.c wxclean/fpu/poly_sin.c
--- clean-1.4.pre2/fpu/poly_sin.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/poly_sin.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  poly_sin.c                                                               |
- |  $Id: poly_sin.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: poly_sin.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  |  Computation of an approximation of the sin function and the cosine       |
  |  function by a polynomial.                                                |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/poly_tan.c wxclean/fpu/poly_tan.c
--- clean-1.4.pre2/fpu/poly_tan.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/poly_tan.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  poly_tan.c                                                               |
- |  $Id: poly_tan.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: poly_tan.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Compute the tan of a FPU_REG, using a polynomial approximation.           |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/polynom_Xsig.c wxclean/fpu/polynom_Xsig.c
--- clean-1.4.pre2/fpu/polynom_Xsig.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/polynom_Xsig.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  polynomial_Xsig.c                                                        |
- |  $Id: polynom_Xsig.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: polynom_Xsig.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Fixed point arithmetic polynomial evaluation.                             |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_add_sub.c wxclean/fpu/reg_add_sub.c
--- clean-1.4.pre2/fpu/reg_add_sub.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_add_sub.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_add_sub.c                                                            |
- |  $Id: reg_add_sub.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_add_sub.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Functions to add or subtract two registers and put the result in a third. |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_compare.c wxclean/fpu/reg_compare.c
--- clean-1.4.pre2/fpu/reg_compare.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_compare.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_compare.c                                                            |
- |  $Id: reg_compare.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_compare.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Compare two floating point registers                                      |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_constant.c wxclean/fpu/reg_constant.c
--- clean-1.4.pre2/fpu/reg_constant.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_constant.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_constant.c                                                           |
- |  $Id: reg_constant.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_constant.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | All of the constant FPU_REGs                                              |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_constant.h wxclean/fpu/reg_constant.h
--- clean-1.4.pre2/fpu/reg_constant.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_constant.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_constant.h                                                           |
- |  $Id: reg_constant.h,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_constant.h,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992    W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
  |                       Australia.  E-mail   billm@vaxc.cc.monash.edu.au    |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_convert.c wxclean/fpu/reg_convert.c
--- clean-1.4.pre2/fpu/reg_convert.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_convert.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_convert.c                                                            |
- |  $Id: reg_convert.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_convert.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  |  Convert register representation.                                         |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_divide.c wxclean/fpu/reg_divide.c
--- clean-1.4.pre2/fpu/reg_divide.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_divide.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_divide.c                                                             |
- |  $Id: reg_divide.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_divide.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Divide one FPU_REG by another and put the result in a destination FPU_REG.|
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_ld_str.c wxclean/fpu/reg_ld_str.c
--- clean-1.4.pre2/fpu/reg_ld_str.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_ld_str.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_ld_str.c                                                             |
- |  $Id: reg_ld_str.c,v 1.4 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_ld_str.c,v 1.3.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | All of the functions which transfer data between user memory and FPU_REGs.|
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_mul.c wxclean/fpu/reg_mul.c
--- clean-1.4.pre2/fpu/reg_mul.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_mul.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_mul.c                                                                |
- |  $Id: reg_mul.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_mul.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Multiply one FPU_REG by another, put the result in a destination FPU_REG. |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_norm.c wxclean/fpu/reg_norm.c
--- clean-1.4.pre2/fpu/reg_norm.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_norm.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_norm.c                                                               |
- |  $Id: reg_norm.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_norm.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992,1993,1994,1995,1997,1999                               |
  |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_round.c wxclean/fpu/reg_round.c
--- clean-1.4.pre2/fpu/reg_round.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_round.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_round.c                                                              |
- |  $Id: reg_round.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_round.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Rounding/truncation/etc for FPU basic arithmetic functions.               |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_u_add.c wxclean/fpu/reg_u_add.c
--- clean-1.4.pre2/fpu/reg_u_add.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_u_add.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_u_add.c                                                              |
- |  $Id: reg_u_add.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_u_add.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Add two valid (TAG_Valid) FPU_REG numbers, of the same sign, and put the  |
  |   result in a destination FPU_REG.                                        |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_u_div.c wxclean/fpu/reg_u_div.c
--- clean-1.4.pre2/fpu/reg_u_div.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_u_div.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_u_div.c                                                              |
- |  $Id: reg_u_div.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_u_div.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Divide one FPU_REG by another and put the result in a destination FPU_REG.|
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_u_mul.c wxclean/fpu/reg_u_mul.c
--- clean-1.4.pre2/fpu/reg_u_mul.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_u_mul.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_u_mul.c                                                              |
- |  $Id: reg_u_mul.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_u_mul.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Core multiplication routine                                               |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/reg_u_sub.c wxclean/fpu/reg_u_sub.c
--- clean-1.4.pre2/fpu/reg_u_sub.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/reg_u_sub.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  reg_u_sub.c                                                              |
- |  $Id: reg_u_sub.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: reg_u_sub.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Core floating point subtraction routine.                                  |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/round_Xsig.c wxclean/fpu/round_Xsig.c
--- clean-1.4.pre2/fpu/round_Xsig.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/round_Xsig.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  round_Xsig.c                                                             |
- |  $Id: round_Xsig.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: round_Xsig.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992,1993,1994,1995,1999                                    |
  |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/shr_Xsig.c wxclean/fpu/shr_Xsig.c
--- clean-1.4.pre2/fpu/shr_Xsig.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/shr_Xsig.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  shr_Xsig.S                                                               |
- |  $Id: shr_Xsig.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: shr_Xsig.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | 12 byte right shift function                                              |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/status_w.h wxclean/fpu/status_w.h
--- clean-1.4.pre2/fpu/status_w.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/status_w.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  status_w.h                                                               |
- |  $Id: status_w.h,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: status_w.h,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Copyright (C) 1992,1993                                                   |
  |                       W. Metzenthen, 22 Parker St, Ormond, Vic 3163,      |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/version.h wxclean/fpu/version.h
--- clean-1.4.pre2/fpu/version.h	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/version.h	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  version.h                                                                |
- |  $Id: version.h,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: version.h,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  |                                                                           |
  | Copyright (C) 1992,1993,1994,1996,1997,1999                               |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/wm_shrx.c wxclean/fpu/wm_shrx.c
--- clean-1.4.pre2/fpu/wm_shrx.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/wm_shrx.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  wm_shrx.c                                                                |
- |  $Id: wm_shrx.c,v 1.2 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: wm_shrx.c,v 1.1.10.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | 64 bit right shift functions                                              |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/fpu/wm_sqrt.c wxclean/fpu/wm_sqrt.c
--- clean-1.4.pre2/fpu/wm_sqrt.c	Fri Oct  5 23:53:46 2001
+++ wxclean/fpu/wm_sqrt.c	Sun Mar 17 04:12:50 2002
@@ -1,6 +1,6 @@
 /*---------------------------------------------------------------------------+
  |  wm_sqrt.c                                                                |
- |  $Id: wm_sqrt.c,v 1.3 2001/10/06 03:53:46 bdenney Exp $
+ |  $Id: wm_sqrt.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
  |                                                                           |
  | Fixed point arithmetic square root evaluation.                            |
  |                                                                           |
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/Makefile.in wxclean/gui/Makefile.in
--- clean-1.4.pre2/gui/Makefile.in	Mon Mar 11 10:32:42 2002
+++ wxclean/gui/Makefile.in	Sun Mar 17 04:12:50 2002
@@ -33,7 +33,7 @@
 @SET_MAKE@
 
 CXX = @CXX@
-CXXFLAGS = @CXXFLAGS@
+CXXFLAGS = @CXXFLAGS@  `wx-config --cxxflags`
 
 LDFLAGS = @LDFLAGS@
 LIBS = @LIBS@
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/amigagui.h wxclean/gui/amigagui.h
--- clean-1.4.pre2/gui/amigagui.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/amigagui.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: amigagui.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: amigagui.h,v 1.2.4.1 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #include <exec/types.h>
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/amigaos.cc wxclean/gui/amigaos.cc
--- clean-1.4.pre2/gui/amigaos.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/amigaos.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: amigaos.cc,v 1.5 2001/12/13 18:36:29 vruppert Exp $
+// $Id: amigaos.cc,v 1.7.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2000  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/beos.cc wxclean/gui/beos.cc
--- clean-1.4.pre2/gui/beos.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/beos.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: beos.cc,v 1.13 2001/12/13 18:36:29 vruppert Exp $
+// $Id: beos.cc,v 1.8.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/cdromd.h wxclean/gui/bitmaps/cdromd.h
--- clean-1.4.pre2/gui/bitmaps/cdromd.h	Thu Jan 31 16:16:52 2002
+++ wxclean/gui/bitmaps/cdromd.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: cdromd.h,v 1.1 2002/01/31 21:16:52 vruppert Exp $
+// $Id: cdromd.h,v 1.1.2.1 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #define BX_CDROMD_BMAP_X 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/copy.h wxclean/gui/bitmaps/copy.h
--- clean-1.4.pre2/gui/bitmaps/copy.h	Mon Mar 11 10:04:58 2002
+++ wxclean/gui/bitmaps/copy.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: copy.h,v 1.1 2002/03/11 15:04:58 bdenney Exp $
+// $Id: copy.h,v 1.1.2.1 2002/03/17 08:50:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 #define BX_COPY_BMAP_X 32
 #define BX_COPY_BMAP_Y 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/floppya.h wxclean/gui/bitmaps/floppya.h
--- clean-1.4.pre2/gui/bitmaps/floppya.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/bitmaps/floppya.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: floppya.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: floppya.h,v 1.1.10.1 2002/03/17 08:50:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #define BX_FLOPPYA_BMAP_X 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/floppyb.h wxclean/gui/bitmaps/floppyb.h
--- clean-1.4.pre2/gui/bitmaps/floppyb.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/bitmaps/floppyb.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: floppyb.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: floppyb.h,v 1.1.10.1 2002/03/17 08:50:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #define BX_FLOPPYB_BMAP_X 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/mouse.h wxclean/gui/bitmaps/mouse.h
--- clean-1.4.pre2/gui/bitmaps/mouse.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/bitmaps/mouse.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: mouse.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: mouse.h,v 1.1.10.1 2002/03/17 08:50:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #define BX_MOUSE_BMAP_X 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/paste.h wxclean/gui/bitmaps/paste.h
--- clean-1.4.pre2/gui/bitmaps/paste.h	Mon Mar 11 10:04:58 2002
+++ wxclean/gui/bitmaps/paste.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: paste.h,v 1.1 2002/03/11 15:04:58 bdenney Exp $
+// $Id: paste.h,v 1.1.2.1 2002/03/17 08:50:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 #define BX_PASTE_BMAP_X 32
 #define BX_PASTE_BMAP_Y 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/power.h wxclean/gui/bitmaps/power.h
--- clean-1.4.pre2/gui/bitmaps/power.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/bitmaps/power.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: power.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: power.h,v 1.1.10.1 2002/03/17 08:50:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #define BX_POWER_BMAP_X 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/reset.h wxclean/gui/bitmaps/reset.h
--- clean-1.4.pre2/gui/bitmaps/reset.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/bitmaps/reset.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: reset.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: reset.h,v 1.1.10.1 2002/03/17 08:50:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #define BX_RESET_BMAP_X 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/bitmaps/snapshot.h wxclean/gui/bitmaps/snapshot.h
--- clean-1.4.pre2/gui/bitmaps/snapshot.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/bitmaps/snapshot.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: snapshot.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: snapshot.h,v 1.1.10.1 2002/03/17 08:50:20 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #define BX_SNAPSHOT_BMAP_X 32
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/carbon.cc wxclean/gui/carbon.cc
--- clean-1.4.pre2/gui/carbon.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/carbon.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: carbon.cc,v 1.7 2002/03/09 02:40:25 bdenney Exp $
+// $Id: carbon.cc,v 1.9.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/control.cc wxclean/gui/control.cc
--- clean-1.4.pre2/gui/control.cc	Mon Mar 11 10:32:42 2002
+++ wxclean/gui/control.cc	Sun Mar 17 04:12:50 2002
@@ -1,10 +1,10 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: control.cc,v 1.43 2002/03/10 10:19:32 vruppert Exp $
+// $Id: control.cc,v 1.30.2.3 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /*
  * gui/control.cc
- * $Id: control.cc,v 1.43 2002/03/10 10:19:32 vruppert Exp $
+ * $Id: control.cc,v 1.30.2.3 2002/03/17 08:57:02 bdenney Exp $
  *
  * This is code for a text-mode control panel.  Note that this file
  * does NOT include bochs.h.  Instead, it does all of its contact with
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/control.h wxclean/gui/control.h
--- clean-1.4.pre2/gui/control.h	Sat Oct  6 18:31:32 2001
+++ wxclean/gui/control.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: control.h,v 1.6 2001/10/06 22:31:31 bdenney Exp $
+// $Id: control.h,v 1.4.2.2 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 enum {
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/gui.cc wxclean/gui/gui.cc
--- clean-1.4.pre2/gui/gui.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/gui.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: gui.cc,v 1.34 2002/03/11 16:35:41 bdenney Exp $
+// $Id: gui.cc,v 1.18.2.5 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -200,16 +200,44 @@
   void
 bx_gui_c::floppyA_handler(void)
 {
+#if USE_WX
+  // instead of just toggling the status, call wxWindows to bring up 
+  // a dialog asking what disk image you want to switch to.
+  int ret = SIM->vga_gui_button_pressed (BXP_FLOPPYA_PATH);
+  // eject and then insert the disk.  If the new path is invalid,
+  // the status will return 0.
+  unsigned new_status = bx_devices.floppy->set_media_status(0, 0);
+  printf ("eject disk, new_status is %d\n", new_status);
+  new_status = bx_devices.floppy->set_media_status(0, 1);
+  printf ("insert disk, new_status is %d\n", new_status);
+  fflush (stdout);
+  BX_GUI_THIS floppyA_status = new_status;
+#else
   BX_GUI_THIS floppyA_status = !BX_GUI_THIS floppyA_status;
   bx_devices.floppy->set_media_status(0, BX_GUI_THIS floppyA_status);
+#endif
   BX_GUI_THIS update_floppy_status_buttons ();
 }
 
   void
 bx_gui_c::floppyB_handler(void)
 {
+#if USE_WX
+  // instead of just toggling the status, call wxWindows to bring up 
+  // a dialog asking what disk image you want to switch to.
+  int ret = SIM->vga_gui_button_pressed (BXP_FLOPPYB_PATH);
+  // eject and then insert the disk.  If the new path is invalid,
+  // the status will return 0.
+  unsigned new_status = bx_devices.floppy->set_media_status(1, 0);
+  printf ("eject disk, new_status is %d\n", new_status);
+  new_status = bx_devices.floppy->set_media_status(1, 1);
+  printf ("insert disk, new_status is %d\n", new_status);
+  fflush (stdout);
+  BX_GUI_THIS floppyB_status = new_status;
+#else
   BX_GUI_THIS floppyB_status = !BX_GUI_THIS floppyB_status;
   bx_devices.floppy->set_media_status(1, BX_GUI_THIS floppyB_status);
+#endif
   BX_GUI_THIS update_floppy_status_buttons ();
 }
 
@@ -239,7 +267,7 @@
   BX_PANIC (("POWER button turned off."));
   // shouldn't reach this point, but if you do, QUIT!!!
   fprintf (stderr, "Bochs is exiting because you pressed the power button.\n");
-  ::exit (1);
+  BX_EXIT (1);
 }
 
 Bit32s
@@ -366,7 +394,7 @@
   void
 bx_gui_c::config_handler(void)
 {
-#if BX_USE_CONTROL_PANEL
+#if BX_USE_CONTROL_PANEL && !USE_WX
   bx_control_panel (BX_CPANEL_RUNTIME);
 #else
   BX_ERROR(( "# CONFIG callback (unimplemented)." ));
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/gui.h wxclean/gui/gui.h
--- clean-1.4.pre2/gui/gui.h	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/gui.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: gui.h,v 1.23 2002/03/11 15:04:58 bdenney Exp $
+// $Id: gui.h,v 1.7.2.1 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/icon_bochs.h wxclean/gui/icon_bochs.h
--- clean-1.4.pre2/gui/icon_bochs.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/icon_bochs.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: icon_bochs.h,v 1.3 2001/10/03 13:10:37 bdenney Exp $
+// $Id: icon_bochs.h,v 1.2.8.1 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/keymap.cc wxclean/gui/keymap.cc
--- clean-1.4.pre2/gui/keymap.cc	Mon Mar 11 12:02:28 2002
+++ wxclean/gui/keymap.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: keymap.cc,v 1.5 2002/03/11 16:35:41 bdenney Exp $
+// $Id: keymap.cc,v 1.5.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  Christophe Bothamy
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/keymap.h wxclean/gui/keymap.h
--- clean-1.4.pre2/gui/keymap.h	Mon Mar 11 10:32:42 2002
+++ wxclean/gui/keymap.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: keymap.h,v 1.3 2002/03/11 15:04:58 bdenney Exp $
+// $Id: keymap.h,v 1.3.2.1 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  Christophe Bothamy
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/keymaps/x11-pc-de.map wxclean/gui/keymaps/x11-pc-de.map
--- clean-1.4.pre2/gui/keymaps/x11-pc-de.map	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/keymaps/x11-pc-de.map	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 # Bochs Keymap file
-# $Id: x11-pc-de.map,v 1.2 2002/03/11 15:04:58 bdenney Exp $
+# $Id: x11-pc-de.map,v 1.4.2.1 2002/03/17 08:50:20 bdenney Exp $
 # Target: PC(x86) keyboard, US keymap
 # Author: Volker Ruppert
 #
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/keymaps/x11-pc-es.map wxclean/gui/keymaps/x11-pc-es.map
--- clean-1.4.pre2/gui/keymaps/x11-pc-es.map	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/keymaps/x11-pc-es.map	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 # Bochs Keymap file
-# $Id: x11-pc-es.map,v 1.2 2002/03/11 15:04:58 bdenney Exp $
+# $Id: x11-pc-es.map,v 1.3.2.1 2002/03/17 08:50:20 bdenney Exp $
 # Target: PC(x86) keyboard, US keymap
 # Author: Vicente Hernando Ara 
 #
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/keymaps/x11-pc-fr.map wxclean/gui/keymaps/x11-pc-fr.map
--- clean-1.4.pre2/gui/keymaps/x11-pc-fr.map	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/keymaps/x11-pc-fr.map	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 # Bochs Keymap file
-# $Id: x11-pc-fr.map,v 1.2 2002/03/11 15:04:58 bdenney Exp $
+# $Id: x11-pc-fr.map,v 1.3.2.1 2002/03/17 08:50:20 bdenney Exp $
 # Target: PC(x86) keyboard, US keymap
 # Author: Christophe Bothamy, Bryce Denney
 #
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/keymaps/x11-pc-us.map wxclean/gui/keymaps/x11-pc-us.map
--- clean-1.4.pre2/gui/keymaps/x11-pc-us.map	Mon Mar 11 10:32:44 2002
+++ wxclean/gui/keymaps/x11-pc-us.map	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 # Bochs Keymap file
-# $Id: x11-pc-us.map,v 1.2 2002/03/11 15:04:58 bdenney Exp $
+# $Id: x11-pc-us.map,v 1.2.2.1 2002/03/17 08:50:20 bdenney Exp $
 # Target: PC(x86) keyboard, US keymap
 # Author: Christophe Bothamy, Bryce Denney
 #
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/macintosh.cc wxclean/gui/macintosh.cc
--- clean-1.4.pre2/gui/macintosh.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/macintosh.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: macintosh.cc,v 1.10 2001/12/13 18:36:29 vruppert Exp $
+// $Id: macintosh.cc,v 1.7.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/nogui.cc wxclean/gui/nogui.cc
--- clean-1.4.pre2/gui/nogui.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/nogui.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: nogui.cc,v 1.13 2001/12/13 18:36:29 vruppert Exp $
+// $Id: nogui.cc,v 1.10.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/rfb.cc wxclean/gui/rfb.cc
--- clean-1.4.pre2/gui/rfb.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/rfb.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: rfb.cc,v 1.14 2001/12/13 18:36:29 vruppert Exp $
+// $Id: rfb.cc,v 1.10.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2000  Psyon.Org!
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/rfb.h wxclean/gui/rfb.h
--- clean-1.4.pre2/gui/rfb.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/rfb.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: rfb.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: rfb.h,v 1.1.4.1 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 // rfb.h
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/rfbproto.h wxclean/gui/rfbproto.h
--- clean-1.4.pre2/gui/rfbproto.h	Wed Oct  3 09:10:38 2001
+++ wxclean/gui/rfbproto.h	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: rfbproto.h,v 1.2 2001/10/03 13:10:37 bdenney Exp $
+// $Id: rfbproto.h,v 1.1.4.1 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /*
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/sdl.cc wxclean/gui/sdl.cc
--- clean-1.4.pre2/gui/sdl.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/sdl.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: sdl.cc,v 1.8 2002/03/06 20:39:23 bdenney Exp $
+// $Id: sdl.cc,v 1.12.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/siminterface.cc wxclean/gui/siminterface.cc
--- clean-1.4.pre2/gui/siminterface.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/gui/siminterface.cc	Sun Mar 17 04:12:50 2002
@@ -1,14 +1,14 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: siminterface.cc,v 1.39 2002/01/30 10:30:52 cbothamy Exp $
+// $Id: siminterface.cc,v 1.31.2.12 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /*
  * gui/siminterface.cc
- * $Id: siminterface.cc,v 1.39 2002/01/30 10:30:52 cbothamy Exp $
+ * $Id: siminterface.cc,v 1.31.2.12 2002/03/17 08:57:02 bdenney Exp $
  *
  * Defines the actual link between bx_simulator_interface_c methods
  * and the simulator.  This file includes bochs.h because it needs
- * access to bx_options and other simulator objecst and methods.
+ * access to bx_options and other simulator objects and methods.
  *
  */
 
@@ -18,10 +18,23 @@
 logfunctions *siminterface_log = NULL;
 #define LOG_THIS siminterface_log->
 
+// bx_simulator_interface just defines the interface that the Bochs simulator
+// and the gui will use to talk to each other.  None of the methods of
+// bx_simulator_interface are implemented; they are all virtual.  The
+// bx_real_sim_c class is a child of bx_simulator_interface_c, and it
+// implements all the methods.  The idea is that a gui needs to know only
+// definition of bx_simulator_interface to talk to Bochs.  The gui should
+// not need to include bochs.h.  
+//
+// I made this separation to ensure that all guis use the siminterface to do
+// access bochs internals, instead of accessing things like
+// bx_keyboard.s.internal_buffer[4] (or whatever) directly. -Bryce
+// 
+
 class bx_real_sim_c : public bx_simulator_interface_c {
   sim_interface_callback_t callback;
+  void *callback_ptr;
 #define BX_NOTIFY_MAX_ARGS 10
-  int notify_return_val;
   int notify_int_args[BX_NOTIFY_MAX_ARGS];
   char *notify_string_args[BX_NOTIFY_MAX_ARGS];
 #define NOTIFY_TYPE_INT
@@ -35,6 +48,10 @@
   virtual ~bx_real_sim_c ();
   virtual int get_init_done () { return init_done; }
   virtual int set_init_done (int n) { init_done = n; return 0;}
+  virtual void get_param_id_range (int *min, int *max) {
+    *min = BXP_NULL;
+    *max = BXP_THIS_IS_THE_LAST-1;
+  }
   virtual int register_param (bx_id id, bx_param_c *it);
   virtual bx_param_c *get_param (bx_id id);
   virtual bx_param_num_c *get_param_num (bx_id id);
@@ -46,7 +63,7 @@
   virtual char *get_action_name (int action);
   virtual const char *get_log_level_name (int level);
   virtual int get_max_log_level ();
-  virtual void quit_sim (int clean);
+  virtual void quit_sim (int code);
   virtual int get_default_rc (char *path, int len);
   virtual int read_rc (char *path);
   virtual int write_rc (char *path, int overwrite);
@@ -55,13 +72,17 @@
   virtual int get_floppy_options (int drive, bx_floppy_options *out);
   virtual int get_cdrom_options (int drive, bx_cdrom_options *out);
   virtual char *get_floppy_type_name (int type);
-  virtual void set_notify_callback (sim_interface_callback_t func);
-  virtual int notify_return (int retcode);
-  virtual int LOCAL_notify (int code);
+  virtual void set_notify_callback (sim_interface_callback_t func, void *arg);
+  virtual BxEvent* LOCAL_notify (BxEvent *event);
   virtual int LOCAL_log_msg (const char *prefix, int level, char *msg);
   virtual int log_msg_2 (char *prefix, int *level, char *msg, int len);
+  virtual int vga_gui_button_pressed (bx_id which);
+  virtual int notify_get_int_arg (int which);
+  virtual char *notify_get_string_arg (int which);
   virtual int get_enabled () { return enabled; }
   virtual void set_enabled (int enabled) { this->enabled = enabled; }
+  // called at a regular interval, currently by the keyboard handler.
+  virtual void periodic ();
 };
 
 bx_param_c *
@@ -70,8 +91,8 @@
   BX_ASSERT (id >= BXP_NULL && id < BXP_THIS_IS_THE_LAST);
   int index = (int)id - BXP_NULL;
   bx_param_c *retval = param_registry[index];
-  if (!retval)
-    BX_PANIC (("get_param can't find id %u", id));
+  if (!retval) 
+    BX_INFO (("get_param can't find id %u", id));
   return retval;
 }
 
@@ -102,13 +123,14 @@
   return NULL;
 }
 
-void init_siminterface ()
+void siminterface_init ()
 {
   siminterface_log = new logfunctions ();
   siminterface_log->put ("CTRL");
   siminterface_log->settype(CTRLLOG);
   if (SIM == NULL) 
     SIM = new bx_real_sim_c();
+  bx_init_before_control_panel ();
 }
 
 bx_simulator_interface_c::bx_simulator_interface_c ()
@@ -118,16 +140,24 @@
 bx_real_sim_c::bx_real_sim_c ()
 {
   callback = NULL;
-  notify_return_val = -1;
-  for (int i=0; i<BX_NOTIFY_MAX_ARGS; i++) {
+  callback_ptr = NULL;
+  
+  enabled = 1;
+  int i;
+  for (i=0; i<BX_NOTIFY_MAX_ARGS; i++) {
     notify_int_args[i] = -1;
     notify_string_args[i] = NULL;
   }
   init_done = 0;
   registry_alloc_size = BXP_THIS_IS_THE_LAST - BXP_NULL;
   param_registry = new bx_param_c*  [registry_alloc_size];
+  for (i=0; i<registry_alloc_size; i++)
+    param_registry[i] = NULL;
 }
 
+// called by constructor of bx_param_c, so that every parameter that is
+// initialized gets registered.  This builds a list of all parameters
+// which can be used to look them up by number (get_param).
 bx_real_sim_c::~bx_real_sim_c ()
 {
     if ( param_registry != NULL )
@@ -140,8 +170,12 @@
 int
 bx_real_sim_c::register_param (bx_id id, bx_param_c *it)
 {
+  if (id == BXP_NULL) return 0;
   BX_ASSERT (id >= BXP_NULL && id < BXP_THIS_IS_THE_LAST);
   int index = (int)id - BXP_NULL;
+  if (this->param_registry[index] != NULL) {
+    BX_INFO (("register_param is overwriting parameter id %d", id));
+  }
   this->param_registry[index] = it;
   return 0;
 }
@@ -192,10 +226,24 @@
 }
 
 void 
-bx_real_sim_c::quit_sim (int clean) {
-  if (!clean)
+bx_real_sim_c::quit_sim (int code) {
+#if 0
+  if (!code)
     BX_PANIC (("Quit simulation command"));
-  ::exit (0);
+  // tell bochs to shut down (includes vga screen)
+  bx_atexit ();
+  // tell the control panel to shut down
+  BxEvent *event = new BxEvent ();
+  event->type = BX_ASYNC_EVT_SHUTDOWN_GUI;
+  LOCAL_notify (event);
+  // set something that will cause the cpu loop to exit.
+  // or use setjmp/longjmp, or something.
+  //FIXME!
+#endif
+  BX_INFO (("quit_sim called"));
+  BX_CPU_THIS_PTR async_event = 1;
+  BX_CPU_THIS_PTR kill_bochs_request = 1;
+  // the cpu loop will exit very soon after this condition is set.
 }
 
 int
@@ -272,30 +320,20 @@
 }
 
 void 
-bx_real_sim_c::set_notify_callback (sim_interface_callback_t func)
+bx_real_sim_c::set_notify_callback (sim_interface_callback_t func, void *arg)
 {
   callback = func;
+  callback_ptr = arg;
 }
 
-int 
-bx_real_sim_c::notify_return (int retcode)
-{
-  notify_return_val = retcode;
-  return 0;
-}
-
-int
-bx_real_sim_c::LOCAL_notify (int code)
+BxEvent *
+bx_real_sim_c::LOCAL_notify (BxEvent *event)
 {
   if (callback == NULL) {
     BX_ERROR (("notify called, but no callback function is registered"));
-    return -1;
+    return NULL;
   } else {
-    notify_return_val = -999;
-    (*callback)(code);
-    if (notify_return_val == -999)
-      BX_ERROR (("notify callback returned without setting the return value"));
-    return notify_return_val;
+    return (*callback)(callback_ptr, event);
   }
 }
 
@@ -303,16 +341,18 @@
 int 
 bx_real_sim_c::LOCAL_log_msg (const char *prefix, int level, char *msg)
 {
+  BxEvent *be = new BxEvent ();
+  be->type = BX_ASYNC_EVT_LOG_MSG;
+  be->u.logmsg.prefix = (char *)prefix;
+  be->u.logmsg.level = level;
+  be->u.logmsg.msg = msg;
   //fprintf (stderr, "calling notify.\n");
-  notify_string_args[0] = strdup(prefix);
-  notify_int_args[1] = level;
-  notify_string_args[2] = msg;
-  int val = LOCAL_notify (NOTIFY_CODE_LOGMSG);
+  BxEvent *response = LOCAL_notify (be);
   //fprintf (stderr, "notify returned %d\n", val);
-  return val;
+  return (response == NULL) ? -1 : 0;
 }
 
-// called by control.cc
+// called by control panel (control.cc) to retrieve args.  FIXME: YUCK!
 int
 bx_real_sim_c::log_msg_2 (char *prefix, int *level, char *msg, int len)
 {
@@ -607,4 +647,54 @@
 bx_list_c::set_parent (bx_param_c *parent)
 {
   this->parent = parent;
+}
+
+// called by code in gui.cc when the user clicks on a headerbar button.
+// Create a synchronous ASK_PARAM event, send it to the GUI and wait for
+// the response.
+int 
+bx_real_sim_c::vga_gui_button_pressed (bx_id param)
+{
+  // create appropriate event
+  BxEvent *event = new BxEvent ();
+  event->type = BX_SYNC_EVT_ASK_PARAM;
+  event->u.param.id = param;
+  BxEvent *response = LOCAL_notify (event);
+  return response->retcode;
+}
+
+int 
+bx_real_sim_c::notify_get_int_arg (int which)
+{
+  return notify_int_args[which];
+}
+
+char *
+bx_real_sim_c::notify_get_string_arg (int which)
+{
+  return notify_string_args[which];
+}
+
+void
+bx_real_sim_c::periodic ()
+{
+  // give the GUI a chance to do periodic things on the bochs thread. in 
+  // particular, notice if the thread has been asked to die.
+  BxEvent *tick = new BxEvent ();
+  tick->type = BX_SYNC_EVT_TICK;
+  BxEvent *response = LOCAL_notify (tick);
+  int retcode = response->retcode;
+  BX_ASSERT (response == tick);
+  delete tick;
+  if (retcode < 0) {
+    BX_INFO (("Bochs thread has been asked to quit."));
+    quit_sim (0);
+  }
+#if 0
+  // watch for memory leaks.  Allocate a small block of memory, print the
+  // pointer that is returned, then free.
+  BxEvent *memcheck = new BxEvent ();
+  BX_INFO(("memory allocation at %p", memcheck));
+  delete memcheck;
+#endif
 }
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/siminterface.h wxclean/gui/siminterface.h
--- clean-1.4.pre2/gui/siminterface.h	Tue Mar  5 10:52:26 2002
+++ wxclean/gui/siminterface.h	Sun Mar 17 04:12:50 2002
@@ -1,10 +1,10 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: siminterface.h,v 1.33 2002/03/03 06:10:04 bdenney Exp $
+// $Id: siminterface.h,v 1.22.2.8 2002/03/17 08:50:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /*
  * gui/siminterface.h
- * $Id: siminterface.h,v 1.33 2002/03/03 06:10:04 bdenney Exp $
+ * $Id: siminterface.h,v 1.22.2.8 2002/03/17 08:50:19 bdenney Exp $
  *
  * Interface to the simulator, currently only used by control.cc.
  * The base class bx_simulator_interface_c, contains only virtual functions
@@ -18,7 +18,7 @@
  *
  */
 
-#define BX_UI_TEXT 1
+#define BX_UI_TEXT 0
 
 //////////////////////////////////////////////////////
 
@@ -119,7 +119,6 @@
 
 typedef enum {
   BXT_OBJECT = 201,
-  BXT_NODE,
   BXT_PARAM,
   BXT_PARAM_NUM,
   BXT_PARAM_BOOL,
@@ -128,6 +127,56 @@
   BXT_LIST
 } bx_objtype;
 
+///////////////////////////////////////////////////////////////////
+// event structure for communication between simulator and gui
+///////////////////////////////////////////////////////////////////
+
+typedef enum {
+  BX_ASYNC_EVT_KEY_PRESS = 2000,  // vga gui -> simulator
+  BX_ASYNC_EVT_KEY_RELEASE,       // vga gui -> simulator
+  BX_ASYNC_EVT_MOUSE,             // vga gui -> simulator
+  BX_SYNC_EVT_GET_PARAM,          // cpanel -> simulator -> cpanel
+  BX_ASYNC_EVT_SET_PARAM,         // cpanel -> simulator
+  BX_ASYNC_EVT_LOG_MSG,           // simulator -> cpanel
+  BX_ASYNC_EVT_VALUE_CHANGED,     // simulator -> cpanel
+  BX_SYNC_EVT_ASK_PARAM,          // simulator -> cpanel -> simulator
+  BX_SYNC_EVT_TICK,               // simulator -> cpanel, wait for response.
+  BX_ASYNC_EVT_SHUTDOWN_GUI,      // simulator -> cpanel
+} BxEventType;
+
+typedef union {
+  Bit32s s32;
+  char *charptr;
+} AnyParamVal;
+
+typedef struct {
+  BxEventType type;
+  Bit32s retcode;   // for success or failure codes
+  union {
+    struct {
+      // type is BX_EVT_KEY_PRESS or BX_EVT_KEY_RELEASE
+      Bit16u scancode;
+    } key;
+    struct {
+      // type is BX_EVT_MOUSE
+      Bit16u x, y;
+      Bit8u buttons;
+    } mouse;
+    struct {
+      // type is BX_EVT_GET_PARAM, BX_EVT_SET_PARAM, BX_EVT_ASK
+      bx_id id;         // id number of parameter
+      AnyParamVal val;
+    } param;
+    struct {
+      // type is BX_EVT_LOG_MSG
+      Bit8u level;
+      char *prefix;
+      char *msg;
+    } logmsg;
+  } u;
+} BxEvent;
+
+
 ////////////////////////////////////////////////////////////////////
 class bx_object_c {
 private:
@@ -187,6 +236,9 @@
   Bit32s get ();
   void set (Bit32s val);
   void set_base (int base) { this->base = base; }
+  int get_base () { return base; }
+  Bit32s get_min () { return min; }
+  Bit32s get_max () { return max; }
 #if BX_UI_TEXT
   virtual void text_print (FILE *fp);
   virtual int text_ask (FILE *fpin, FILE *fpout);
@@ -214,6 +266,7 @@
       char **choices,
       Bit32s initial_val,
       Bit32s value_base = 0);
+  char *get_choice (int n) { return choices[n]; }
 #if BX_UI_TEXT
   virtual void text_print (FILE *fp);
   virtual int text_ask (FILE *fpin, FILE *fpout);
@@ -346,12 +399,14 @@
 
 
 ////////////////////////////////////////////////////////////////////
+extern int bx_main (int argc, char *argv[]);
 
 class bx_simulator_interface_c {
 public:
   bx_simulator_interface_c ();
   virtual int get_init_done () { return -1; }
   virtual int set_init_done (int n) {return -1;}
+  virtual void get_param_id_range (int *min, int *max) {}
   virtual int register_param (bx_id id, bx_param_c *it) {return -1;}
   virtual bx_param_c *get_param (bx_id id) {return NULL;}
   virtual bx_param_num_c *get_param_num (bx_id id) {return NULL;}
@@ -363,7 +418,15 @@
   virtual char *get_action_name (int action) {return 0;}
   virtual const char *get_log_level_name (int level) {return 0;}
   virtual int get_max_log_level () {return -1;}
-  virtual void quit_sim (int clean) {}
+
+  // exiting is somewhat complicated!  The preferred way to exit bochs is
+  // to call BX_EXIT(exitcode).  That is defined to call 
+  // SIM->quit_sim(exitcode).  The quit_sim function first calls
+  // the cleanup functions in bochs so that it can destroy windows
+  // and free up memory, then sends a notify message to the control 
+  // panel telling it that bochs has stopped.
+  virtual void quit_sim (int code) {}
+
   virtual int get_default_rc (char *path, int len) {return -1;}
   virtual int read_rc (char *path) {return -1;}
   virtual int write_rc (char *rc, int overwrite) {return -1;}
@@ -372,19 +435,38 @@
   virtual int get_floppy_options (int drive, bx_floppy_options *out) {return -1;}
   virtual int get_cdrom_options (int drive, bx_cdrom_options *out) {return -1;}
   virtual char *get_floppy_type_name (int type) {return NULL;}
-  typedef int (*sim_interface_callback_t)(int code);
-  virtual void set_notify_callback (sim_interface_callback_t func) {}
-  virtual int notify_return (int retcode) {return -1;}
+
+  // The control panel calls set_notify_callback to register an event 
+  // handler.  This handler is for events which are generated by Bochs
+  // or the Bochs controller vga screen.  For example, if the simulator
+  // hits a panic and wants a dialog box to appear, it would use the
+  // sim_interface_callback to ask the control panel to display a dialog.
+  // At present, the standard floppy disk buttons, power button, etc are under
+  // control of Bochs, NOT the control panel.  Bochs uses the callback to tell
+  // the control panel that one of these buttons has been pressed.
+  typedef BxEvent* (*sim_interface_callback_t)(void *theclass, BxEvent *event);
+  virtual void set_notify_callback (sim_interface_callback_t func, void *arg) {}
+
   // methods marked LOCAL should only be called by the simulator, not
   // from the control panel.
-#define NOTIFY_CODE_LOGMSG  0x101
-  virtual int LOCAL_notify (int code) {return -1;}
+  // called by bochs to inform the gui that something has happened
+  virtual BxEvent* LOCAL_notify (BxEvent *event) {return NULL;}
+
+  // this "notify arg" passing is very ugly and Bryce needs to clean it up!
   virtual int LOCAL_log_msg (const char *prefix, int level, char *msg) {return -1;}
   virtual int log_msg_2 (char *prefix, int *level, char *msg, int len) {return -1;}
+  // called by gui.cc event handler when a button is pressed.
+  virtual int vga_gui_button_pressed (bx_id param) {return -1;}
+  virtual int notify_get_int_arg (int which) {return -1;}
+  virtual char *notify_get_string_arg (int which) {return NULL;}
+
   virtual int get_enabled () {return -1;}
   virtual void set_enabled (int enabled) {}
+  // called at a regular interval, currently by the keyboard handler.
+  virtual void periodic () {}
 };
 
 extern bx_simulator_interface_c *SIM;
 
-extern void init_siminterface ();
+extern void siminterface_init ();
+extern int bx_continue_after_control_panel (int argc, char *argv[]);
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/term.cc wxclean/gui/term.cc
--- clean-1.4.pre2/gui/term.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/term.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: term.cc,v 1.11 2001/12/13 18:36:29 vruppert Exp $
+// $Id: term.cc,v 1.8.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2000  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/win32.cc wxclean/gui/win32.cc
--- clean-1.4.pre2/gui/win32.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/win32.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: win32.cc,v 1.25 2002/03/11 16:35:41 bdenney Exp $
+// $Id: win32.cc,v 1.12.2.2 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/wx.cc wxclean/gui/wx.cc
--- clean-1.4.pre2/gui/wx.cc	Wed Dec 31 19:00:00 1969
+++ wxclean/gui/wx.cc	Thu Mar 14 10:13:46 2002
@@ -0,0 +1,591 @@
+/////////////////////////////////////////////////////////////////
+//
+// gui/wx.cc
+// $Id: wx.cc,v 1.1.2.14 2002/03/14 15:13:45 bdenney Exp $
+//
+// GUI Control Panel for Bochs, using wxWindows toolkit.
+//
+/////////////////////////////////////////////////////////////////
+
+// For compilers that support precompilation, includes "wx/wx.h".
+#include "wx/wxprec.h"
+#include <wx/scrolwin.h>
+
+#ifdef __BORLANDC__
+#pragma hdrstop
+#endif
+
+#ifndef WX_PRECOMP
+#include "wx/wx.h"
+#endif
+
+
+
+#include "config.h"
+extern "C" {
+// siminterface needs stdio.h
+#include <stdio.h>
+}
+#include "osdep.h"
+#include "control.h"
+#include "siminterface.h"
+
+#include "gui/wx.h"
+
+// I wanted to make this a static member of ParamEditor, but it gave me
+// link errors so I just put it outside for now.
+wxHashTable paramEditorsById;
+
+// event table for ParamEditor and subclasses
+BEGIN_EVENT_TABLE(ParamEditor, wxPanel)
+  //EVT_CHECKBOX (-1, ParamEditor::OnEvent)
+  //EVT_CHOICE (-1, ParamEditor::OnEvent)
+  //EVT_TEXT(-1, ParamEditor::OnEvent)
+  //EVT_TEXT_ENTER(-1, ParamEditor::OnEvent)
+END_EVENT_TABLE()
+
+// event table for wxFrame
+BEGIN_EVENT_TABLE(MyFrame, wxFrame)
+  EVT_MENU(ID_Quit,  MyFrame::OnQuit)
+  EVT_MENU(ID_StartBochs, MyFrame::HandleEvent)
+  EVT_MENU(ID_ApplyAction, MyFrame::HandleEvent)
+  EVT_MENU(ID_RevertAction, MyFrame::HandleEvent)
+  EVT_MENU(ID_ReadConfig, MyFrame::HandleEvent)
+  EVT_MENU(ID_WriteConfig, MyFrame::HandleEvent)
+  EVT_MENU(ID_WriteConfigAs, MyFrame::HandleEvent)
+END_EVENT_TABLE()
+
+  // event table for MyPanel
+BEGIN_EVENT_TABLE(MyPanel, wxScrolledWindow)
+  EVT_BUTTON (ID_StartBochs, MyPanel::HandleEvent)
+  EVT_BUTTON (ID_ApplyAction, MyPanel::HandleEvent)
+  EVT_BUTTON (ID_RevertAction, MyPanel::HandleEvent)
+  // do not call event handlers for the ParamEditors
+  //EVT_CHECKBOX (ID_Check1, MyPanel::HandleEvent)
+  //EVT_CHOICE (ID_Choice1, MyPanel::HandleEvent)
+  //EVT_COMBOBOX (ID_Combo1, MyPanel::HandleEvent)
+  //EVT_TEXT (ID_Combo1, MyPanel::HandleEvent)
+END_EVENT_TABLE()
+
+
+
+
+// event table for BochsEventHandler and subclasses
+BEGIN_EVENT_TABLE(BochsEventHandler, wxEvtHandler)
+  EVT_MENU (-1, BochsEventHandler::OnEvent)
+END_EVENT_TABLE()
+
+
+MyFrame::MyFrame(const wxString& title, const wxPoint& pos, const wxSize& size)
+: wxFrame((wxFrame *)NULL, -1, title, pos, size)
+{
+  bochsThread = NULL;
+  wxMenu *menuFile = new wxMenu;
+
+  menuFile->Append( ID_StartBochs, "&Start Bochs..." );
+  menuFile->AppendSeparator();
+  menuFile->Append( ID_ReadConfig, "Read Configuration File" );
+  menuFile->Append( ID_WriteConfig, "Write Configuration" );
+  menuFile->Append( ID_WriteConfigAs, "Write Configuration As..." );
+  menuFile->AppendSeparator();
+  menuFile->Append( ID_Quit, "E&xit" );
+
+  wxMenuBar *menuBar = new wxMenuBar;
+  menuBar->Append( menuFile, "&File" );
+
+  SetMenuBar( menuBar );
+
+  CreateStatusBar();
+  SetStatusText( "Bochs Controls" );
+  int width=500, height=3000;
+  panel = new MyPanel ( this, this, -1, wxPoint(0,0), wxSize(width,height) );
+  panel->SetScrollbars( 10, 10, width/10, height/10 );
+}
+
+void
+MyFrame::HandleEvent (wxCommandEvent& event)
+{
+  panel->HandleEvent (event);
+}
+
+void
+MyFrame::StartBochsThread ()
+{
+  if (bochsThread == NULL)
+  {
+    printf ("Starting bochs thread\n");
+    bochsThread = new BochsThread ();
+    bochsThread->Create ();
+    bochsThread->Run ();
+  } else {
+    wxMessageBox (
+    "Can't start Bochs simulator, because it is already running",
+    "Already Running", wxOK | wxICON_ERROR);
+  }
+}
+
+
+int 
+MyFrame::ReadConfiguration (int ask_name)
+{
+  char oldrc_cstr[CPANEL_PATH_LEN];
+  int found_default = 1;
+  if (SIM->get_default_rc (oldrc_cstr, CPANEL_PATH_LEN) < 0) {
+    found_default = 0;
+    oldrc_cstr[0] = 0;
+  }
+  wxString oldrc (oldrc_cstr), newrc = oldrc;
+  if (!found_default) {
+    if (!ask_name) return -1;
+    newrc = ::wxFileSelector ("Load which configuration file?", 
+	"", oldrc, "", "", wxOPEN);
+  }
+  if (newrc.IsEmpty () || (newrc == "none")) return 0;
+  if (SIM->read_rc ((char *)newrc.c_str ()) < 0) {
+    wxMessageBox ("Error loading configuration file");
+    return -1;
+  }
+  panel->forAllEditors (ID_RevertAction, paramEditorsById);
+  return 0;
+}
+
+int 
+MyFrame::WriteConfiguration (int ask_name)
+{
+  char oldrc_cstr[CPANEL_PATH_LEN];
+  int found_default = 1;
+  if (SIM->get_default_rc (oldrc_cstr, CPANEL_PATH_LEN) < 0) {
+    found_default = 0;
+    oldrc_cstr[0] = 0;
+  }
+  wxString oldrc (oldrc_cstr), newrc = oldrc;
+  if (ask_name || !found_default) {
+    newrc = ::wxFileSelector ("Save Configuration As", 
+	"", oldrc, "", "", wxSAVE | wxOVERWRITE_PROMPT);
+  }
+  if (newrc.IsEmpty () || (newrc == "none")) return 0;
+  if (SIM->write_rc ((char *)newrc.c_str (), 1) < 0) {
+    wxMessageBox ("Error while saving configuration file");
+    return -1;
+  }
+  return 0;
+}
+
+// static function version that can be referred to by function pointer
+int 
+MyFrame::ProcessBochsEvent (void *class_ptr, int id)
+{
+  printf ("MyFrame::ProcessBochsEvent\n");
+  MyFrame *f = (MyFrame *)class_ptr;
+  f->ProcessBochsEvent2 (id);
+  return 0;
+}
+
+int 
+MyFrame::ProcessBochsEvent2 (int code)
+{
+  printf ("MyFrame::ProcessBochsEvent2\n");
+  switch (code)
+  {
+  case NOTIFY_CODE_LOGMSG:
+    if (0) {
+      // dumb static choices for now, I'll fix it once I get it to work
+      //
+      // this code works if the gui thread calls it, but it's doing bad
+      // things when it gets called from the bochs thread.
+      // I know it's legal for a non-GUI thread to enter a mutex, update
+      // an object like "m_frame->WriteText(msg)" and then leave the mutex.
+      // But this code puts up a modal dialog and waits for user input.
+      // If you comment out the mutex code, you get:
+      // GLib-WARNING **: g_main_run(): called recursively from within a source's check() or prepare() member or from a second thread, iteration not possible
+      // And if you uncomment the mutex, it displays the dialog correctly
+      // but then clicking on it does nothing...deadlock.
+      // Maybe this must be resolved by posting a message between threads
+      // instead.
+
+      wxMutexGuiEnter();
+      static wxString choices[] = { "Die", "Continue", "Continue and Disable" };
+      char prefix[512], msg[512];
+      int level;
+      assert (SIM->log_msg_2 (prefix, &level, msg, sizeof(msg)) >= 0);
+      wxString string;
+      string.Printf ("%s", msg);
+      int choice = ::wxGetSingleChoiceIndex (
+	  string,
+	  wxString (SIM->get_log_level_name (level)), 3, choices);
+      wxMutexGuiLeave();
+      printf ("you chose %d\n", choice);
+    } else {
+  //////////// temporary! still implement this with stdin/stdout ///////////
+      int level;
+      char prefix[512], msg[512];
+      assert (SIM->log_msg_2 (prefix, &level, msg, sizeof(msg)) >= 0);
+      fprintf (stderr, "========================================================================\n");
+      fprintf (stderr, "Event type: %s\n", SIM->get_log_level_name (level));
+      fprintf (stderr, "Device: %s\n", prefix);
+      fprintf (stderr, "Message: %s\n\n", msg);
+      fprintf (stderr, "A %s has occurred.  Do you want to:\n", SIM->get_log_level_name (level));
+      fprintf (stderr, "  cont       - continue execution\n");
+      fprintf (stderr, "  alwayscont - continue execution, and don't ask again.\n");
+      fprintf (stderr, "               This affects only %s events from device %s\n", SIM->get_log_level_name (level), prefix);
+      fprintf (stderr, "  die        - stop execution now\n");
+      int choice;
+      extern int ask_menu (char *prompt, int n_choices, char *choice[], int the_default, int *out);
+      char *log_action_ask_choices[] = { "cont", "alwayscont", "die" };
+      int log_action_n_choices = 3;
+      if (ask_menu ("Choose cont, alwayscont, or die. [%s] ", 3,  
+	    log_action_ask_choices, 2, &choice) < 0) 
+	return SIM->notify_return(-1);
+      // return 0 for continue, 1 for alwayscontinue, 2 for die.
+      SIM->notify_return(choice);
+    }
+    break;
+  default:
+    fprintf (stderr, "Control panel: notify callback called with unknown code %04x\n", code);
+  }
+}
+
+
+void MyFrame::OnQuit(wxCommandEvent& WXUNUSED(event))
+{
+  Close( TRUE );
+  if (bochsThread != NULL)
+    bochsThread->Delete ();
+}
+
+BochsEventHandler *bochsEventHandler;
+
+BochsEventHandler::BochsEventHandler ()
+{
+  printf ("BochsEventHandler::BochsEventHandler\n");
+}
+
+void
+BochsEventHandler::OnEvent (wxCommandEvent& evt)
+{
+  printf ("BochsEventHandler::OnEvent called with event id=%d\n", evt.GetId ());
+}
+int wxid_count = ID_LAST_STATIC_ASSIGNED_ID;
+
+IMPLEMENT_APP(BochsApp)
+
+bool BochsApp::OnInit()
+{
+  // do bochs initialization first
+  siminterface_init ();
+  MyFrame *frame = new MyFrame( "Bochs Control Panel", wxPoint(50,50), wxSize(450,340) );
+  SIM->set_notify_callback (frame->ProcessBochsEvent, frame);
+  bochsEventHandler = new BochsEventHandler ();
+  frame->Show( TRUE );
+  SetTopWindow( frame );
+  return TRUE;
+}
+
+
+void MyPanel::HandleEvent (wxCommandEvent& evt)
+{
+  int id = evt.GetId ();
+  printf ("Handle event with event id %d\n", id);
+  switch (id)
+  {
+    case ID_StartBochs:
+      frame->StartBochsThread ();
+      break;
+    case ID_ApplyAction:
+    case ID_RevertAction:
+      forAllEditors (id, paramEditorsById);
+      break;
+    case ID_ReadConfig:
+      frame->ReadConfiguration (1);
+      break;
+    case ID_WriteConfig:
+      frame->WriteConfiguration (0);
+      break;
+    case ID_WriteConfigAs:
+      frame->WriteConfiguration (1);
+      break;
+    default:
+      printf ("HandleEvent called with id=%d\n", id);
+  }
+}
+
+void 
+MyPanel::forAllEditors (int evt_id, wxHashTable& hash)
+{
+  printf ("MyPanel::forAllEditors");
+  // iterate over editors in the editors hashtable
+  hash.BeginFind ();
+  wxNode *node;
+  while (node = hash.Next ()) 
+  {
+    ParamEditor *editor = (ParamEditor *)node->Data ();
+    editor->Action (evt_id);
+  }
+}
+
+void *
+BochsThread::Entry (void)
+{
+  int argc=1;
+  char *argv[] = {"bochs"};
+  bx_continue_after_control_panel (argc, argv);
+  return NULL;
+}
+
+MyPanel::MyPanel (MyFrame *frame, wxWindow *parent, wxWindowID id, const wxPoint &pos, const wxSize &size )
+  : wxScrolledWindow( parent, id, pos, size, wxSUNKEN_BORDER | wxTAB_TRAVERSAL, "Bochs Controls" )
+{
+  this->frame = frame;
+  // the parent constructor makes this panel a child of frame, with 
+  // proper size.
+  (void) new wxButton (this, ID_StartBochs, "Start Bochs", wxPoint (10, 10));
+  (void) new wxButton (this, ID_ApplyAction, "Apply", wxPoint (110, 10));
+  (void) new wxButton (this, ID_RevertAction, "Revert", wxPoint (210, 10));
+  //wxCheckBox *check1 = new wxCheckBox (this, ID_Check1, "Checkbox", wxPoint (10, 50));
+  //wxString choices[] = { "apple", "orange", "banana" };
+  //wxChoice *choice1 = new wxChoice (this, ID_Choice1, wxPoint (10, 80), wxSize (80, 30), 3, choices);
+  //wxComboBox *combo1 = new wxComboBox (this, ID_Combo1, "Default Combo String", wxPoint (10, 130), wxSize (180, 80), 3, choices);
+  //text1 = new wxStaticText (this, ID_Text1, "no text yet", wxPoint (0, 160));
+  frame->ReadConfiguration (0);
+  buildParamList (10, 40);
+  // grab all the settings from siminterface into the GUI
+  forAllEditors (ID_RevertAction, paramEditorsById);
+}
+
+MyPanel::~MyPanel()
+{
+}
+
+void MyPanel::buildParamList (int x, int y)
+{
+  // get a list of parameters
+  int min, max;
+  SIM->get_param_id_range (&min, &max);
+  for (int i=min; i<=max; i++) {
+    bx_param_c *param = SIM->get_param ((bx_id) i);
+    if (param != NULL) {
+      printf ("param %d is called %s\n", i, param->get_name ());
+      new wxStaticText (this, i, param->get_name (), wxPoint (x, y));
+      int wxid = wxid_count++;
+      ParamEditor *editor = ParamEditor::createEditor (param, this, wxid, x+120, y);
+      y+=30;
+    }
+  }
+}
+
+/////////////////////////////////////////////////////////////////////////
+// Parameter editor classes
+/////////////////////////////////////////////////////////////////////////
+
+ParamEditor::ParamEditor (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y)
+  : wxPanel(parent, id, wxPoint(x, y), wxSize (300, 30))
+{
+  printf ("ParamEditor::ParamEditor\n");
+  this->param = param;
+  //wxString text = wxString (param->get_name ());
+  //new wxStaticText (parent, id, text, wxPoint (x, y));
+}
+
+ParamEditor *
+ParamEditor::createEditor (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y)
+{
+  printf ("ParamEditor::createEditor\n");
+  Bit8u type = param->get_type ();
+  ParamEditor *it = NULL;
+  switch (type) {
+    case BXT_PARAM_BOOL:
+      it = new ParamEditorBool (param, parent, id, x, y);
+      break;
+    case BXT_PARAM_NUM:
+      it = new ParamEditorNum (param, parent, id, x, y);
+      break;
+    case BXT_PARAM_STRING:
+      it = new ParamEditorString (param, parent, id, x, y);
+      break;
+    case BXT_PARAM_ENUM:
+      it = new ParamEditorEnum (param, parent, id, x, y);
+      break;
+    case BXT_LIST:
+      it = new ParamEditorList (param, parent, id, x, y);
+      break;
+    default:
+      printf ("ParamEditor::createEditor with unknown type %d\n", type);
+      it = NULL;
+  }
+  paramEditorsById.Put (id, it);
+  return it;
+}
+
+ParamEditorBool::ParamEditorBool (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y)
+  : ParamEditor (param, parent, id, x, y)
+{
+  component = new wxCheckBox (this, id, "", wxPoint (0, 0));
+}
+
+void 
+ParamEditorBool::Action (int evt_id)
+{
+  printf ("ParamEditorBool::Action\n");
+  bx_param_bool_c *param = (bx_param_bool_c *) get_param ();
+  switch (evt_id) {
+    case ID_ApplyAction:
+      param->set (component->GetValue ());
+      break;
+    case ID_RevertAction:
+      component->SetValue (param->get ());
+      break;
+    default:
+      wxASSERT (0);
+  }
+}
+
+ParamEditorNum::ParamEditorNum (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y)
+  : ParamEditor (param, parent, id, x, y)
+{
+  // background color helps to visualize the borders of the panel
+  //SetBackgroundColour (wxColour ("red"));
+  bx_param_num_c *num = (bx_param_num_c *)param;
+  wxString text;
+  text.Printf ("%d", num->get ());
+  component = new wxTextCtrl (this, id, text, wxPoint (-1, -1), wxSize (-1, -1), wxTE_PROCESS_ENTER|wxTE_PROCESS_TAB);
+}
+
+void 
+ParamEditorNum::Action (int evt_id)
+{
+  printf ("ParamEditorNum::Action\n");
+  bx_param_num_c *param = (bx_param_num_c *) get_param ();
+  int base = param->get_base ();
+  wxASSERT (base==10 || base==16);
+  switch (evt_id) {
+    case ID_ApplyAction:
+      {
+	const char *string = component->GetValue ().c_str ();
+	int n, status;
+	if (base==10) status = wxSscanf (string, "%d", &n);
+	else status = wxSscanf (string, "%x", &n);
+	if (status != 1) {
+	  printf ("Invalid number in %s, value = '%s'\n", param->get_name (), string);
+	  return;
+	}
+	param->set (n);
+      }
+      break;
+    case ID_RevertAction:
+      {
+	int n = param->get ();
+	wxString string;
+	if (base == 10) string.Printf ("%d", n);
+	else string.Printf ("%x", n);
+        component->SetValue (string);
+      }
+      break;
+    default:
+      wxASSERT (0);
+  }
+}
+
+ParamEditorString::ParamEditorString (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y)
+  : ParamEditor (param, parent, id, x, y)
+{
+  //SetBackgroundColour (wxColour ("red"));
+  bx_param_string_c *string = (bx_param_string_c *)param;
+  wxString text = wxString (string->getptr ());
+  component = new wxTextCtrl (this, id, text, wxPoint (-1, -1), wxSize (-1, -1), wxTE_PROCESS_ENTER);
+}
+
+void 
+ParamEditorString::Action (int evt_id)
+{
+  bx_param_string_c *param = (bx_param_string_c *) get_param ();
+  const char *string;
+  switch (evt_id) {
+    case ID_ApplyAction:
+      string = component->GetValue ().c_str ();
+      param->set ((char *)string);
+      break;
+    case ID_RevertAction:
+      component->SetValue (wxString (param->getptr ()));
+      break;
+    default:
+      wxASSERT (0);
+  }
+}
+
+
+ParamEditorEnum::ParamEditorEnum (bx_param_c *genericparam, wxWindow *parent, wxWindowID id, int x, int y)
+  : ParamEditor (genericparam, parent, id, x, y)
+{
+  //SetBackgroundColour (wxColour ("red"));
+  
+  // build the array of choices
+  bx_param_enum_c *param = (bx_param_enum_c *) genericparam;
+  n_choices = param->get_max () - param->get_min () + 1;
+  choices = new wxString[n_choices];
+  for (int i=0; i<n_choices; i++)
+    choices[i] = param->get_choice (i);
+  component = new wxChoice (this, id, wxPoint (-1, -1), wxSize (-1, -1), n_choices, choices);
+}
+
+void 
+ParamEditorEnum::Action (int evt_id)
+{
+  printf ("ParamEditorEnum::Action\n");
+  bx_param_enum_c *param = (bx_param_enum_c *) get_param ();
+  int min = param->get_min ();
+  switch (evt_id) {
+    case ID_ApplyAction:
+      param->set (min + component->GetSelection ());
+      break;
+    case ID_RevertAction:
+      component->SetSelection (param->get () - min);
+      break;
+    default:
+      wxASSERT (0);
+  }
+}
+
+
+
+ParamEditorList::ParamEditorList (bx_param_c *genericparam, wxWindow *parent, wxWindowID id, int x, int y)
+  : ParamEditor (genericparam, parent, id, x, y)
+{
+  //SetBackgroundColour (wxColour ("red"));
+  bx_list_c *param = (bx_list_c *) genericparam;
+  component = new wxStaticText (this, id, "list param not implemented", wxPoint (-1, -1));
+}
+
+void 
+ParamEditorList::Action (int evt_id)
+{
+  printf ("ParamEditorList::Action\n");
+}
+
+bx_param_c *
+ParamEditor::get_param ()
+{
+  printf ("You called get_param on ParamEditor %p\n", this);
+  printf ("My param value is %p\n", this->param);
+  return this->param;
+}
+
+void
+ParamEditor::OnEvent (wxCommandEvent& evt)
+{
+  // if you want to run some action on the object that sent this event,
+  // see the code below.
+#if 0
+  int id = evt.GetId ();
+  wxObject *object = evt.GetEventObject ();
+  printf ("ParamEditor::OnEvent, id=%d, object=%p\n", id, object);
+  ParamEditor *genericeditor = (ParamEditor *) paramEditorsById.Get (id);
+  if (genericeditor == NULL) {
+    printf ("I couldn't find the parameter editor for id=%d\n", id);
+    return;
+  }
+  bx_param_c *genericparam = genericeditor->get_param ();
+  wxASSERT (genericparam != NULL);
+  printf ("This event will be sent to %s\n", genericparam->get_name ());
+  genericeditor->Action (evt);
+#endif
+}
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/wx.h wxclean/gui/wx.h
--- clean-1.4.pre2/gui/wx.h	Wed Dec 31 19:00:00 1969
+++ wxclean/gui/wx.h	Thu Jun 28 00:08:56 2001
@@ -0,0 +1,130 @@
+/////////////////////////////////////////////////////////////////
+//
+// gui/wx.h
+// $Id: wx.h,v 1.1.2.3 2001/06/28 04:08:56 bdenney Exp $
+//
+// GUI Control Panel for Bochs, using wxWindows toolkit.
+//
+/////////////////////////////////////////////////////////////////
+
+enum
+{
+  ID_Quit = 1,
+  ID_StartBochs,
+  ID_ApplyAction,
+  ID_RevertAction,
+  ID_ReadConfig,
+  ID_WriteConfig,
+  ID_WriteConfigAs,
+  ID_Check1,
+  ID_Choice1,
+  ID_Combo1,
+  ID_Text1,
+  ID_LAST_STATIC_ASSIGNED_ID
+};
+
+class BochsApp: public wxApp
+{
+  virtual bool OnInit();
+};
+
+class BochsThread: public wxThread 
+{
+public:
+  virtual ExitCode Entry ();
+};
+
+class MyPanel;
+
+class MyFrame: public wxFrame
+{
+private:
+  DECLARE_EVENT_TABLE()
+  MyPanel *panel;
+public:
+  MyFrame(const wxString& title, const wxPoint& pos, const wxSize& size);
+
+  void OnQuit(wxCommandEvent& event);
+  void OnAbout(wxCommandEvent& event);
+  BochsThread *bochsThread;
+  void StartBochsThread ();
+  void HandleEvent(wxCommandEvent& event);
+  int ReadConfiguration (int ask_name);
+  int WriteConfiguration (int ask_name);
+  static int ProcessBochsEvent (void *class_ptr, int id);
+  int ProcessBochsEvent2 (int id);
+};
+
+class MyPanel: public wxScrolledWindow
+{
+private:
+  MyFrame *frame;
+  wxStaticText *text1;
+  void buildParamList (int x, int y);
+public:
+  MyPanel () {};
+  MyPanel (MyFrame *frame, wxWindow *parent, wxWindowID, const wxPoint &pos, const wxSize &size );
+  ~MyPanel();
+  void HandleEvent(wxCommandEvent& event);
+  void forAllEditors (int evt_id, wxHashTable &);
+
+  DECLARE_EVENT_TABLE()
+};
+
+class BochsEventHandler: public wxEvtHandler {
+public:
+  BochsEventHandler ();
+  void OnEvent (wxCommandEvent& event);
+private:
+  DECLARE_EVENT_TABLE()
+};
+
+class ParamEditor: public wxPanel {
+  bx_param_c *param;
+  DECLARE_EVENT_TABLE()
+  void OnEvent (wxCommandEvent& event);
+public:
+  ParamEditor (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y);
+  static ParamEditor *createEditor (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y);
+  bx_param_c *get_param ();
+  virtual void Action (int evt_id) = 0;
+};
+
+
+class ParamEditorBool : public ParamEditor {
+  wxCheckBox *component;
+public:
+  ParamEditorBool (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y);
+  virtual void Action (int evt_id);
+};
+
+class ParamEditorNum : public ParamEditor {
+  wxTextCtrl *component;
+public:
+  ParamEditorNum (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y);
+  virtual void Action (int evt_id);
+};
+
+class ParamEditorString : public ParamEditor {
+  wxTextCtrl *component;
+public:
+  ParamEditorString (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y);
+  virtual void Action (int evt_id);
+};
+
+class ParamEditorEnum : public ParamEditor {
+  wxChoice *component;
+  int n_choices;
+  wxString *choices;
+public:
+  ParamEditorEnum (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y);
+  virtual void Action (int evt_id);
+};
+
+class ParamEditorList : public ParamEditor {
+  wxControl *component;
+public:
+  ParamEditorList (bx_param_c *param, wxWindow *parent, wxWindowID id, int x, int y);
+  virtual void Action (int evt_id);
+};
+
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/gui/x.cc wxclean/gui/x.cc
--- clean-1.4.pre2/gui/x.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/gui/x.cc	Sun Mar 17 04:12:50 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: x.cc,v 1.34 2002/03/11 15:04:58 bdenney Exp $
+// $Id: x.cc,v 1.13.2.2 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -1276,6 +1276,7 @@
   void
 bx_gui_c::exit(void)
 {
+  XCloseDisplay (bx_x_display);
   BX_INFO(("Exit."));
 }
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/hacks.h wxclean/hacks.h
--- clean-1.4.pre2/hacks.h	Wed Dec 31 19:00:00 1969
+++ wxclean/hacks.h	Sat Mar 16 15:09:48 2002
@@ -0,0 +1,58 @@
+// temporary!
+
+enum {
+  GUI_BUTTON_FLOPPYA = 1000,
+  GUI_BUTTON_FLOPPYB
+};
+
+// defined in wxmain.cc for now
+int gui_button_pressed (int which);
+
+///////////////////////////////////////////////////////////////////
+// event structure for communication between simulator and gui
+///////////////////////////////////////////////////////////////////
+
+typedef enum {
+  BX_ASYNC_EVT_KEY_PRESS = 2000,  // vga gui -> simulator
+  BX_ASYNC_EVT_KEY_RELEASE,       // vga gui -> simulator
+  BX_ASYNC_EVT_MOUSE,             // vga gui -> simulator
+  BX_SYNC_EVT_GET_PARAM,          // cpanel -> simulator -> cpanel
+  BX_ASYNC_EVT_SET_PARAM,         // cpanel -> simulator
+  BX_ASYNC_EVT_LOG_MSG,           // simulator -> cpanel
+  BX_ASYNC_EVT_VALUE_CHANGED,     // simulator -> cpanel
+  BX_SYNC_EVT_ASK_PARAM,          // simulator -> cpanel -> simulator
+  BX_SYNC_TICK,                   // simulator -> cpanel, wait for response.
+} BxEventType;
+
+typedef union {
+  Bit32s s32;
+  char *charptr;
+} AnyParamVal;
+
+typedef struct {
+  BxEventType type;
+  union {
+    struct {
+      // type is BX_EVT_KEY_PRESS or BX_EVT_KEY_RELEASE
+      Bit16u scancode;
+    } key;
+    struct {
+      // type is BX_EVT_MOUSE
+      Bit16u x, y;
+      Bit8u buttons;
+    } mouse;
+    struct {
+      // type is BX_EVT_GET_PARAM, BX_EVT_SET_PARAM, BX_EVT_ASK
+      bx_id id;         // id number of parameter
+      AnyParamVal val;
+	  Bit32s success;
+    } param;
+    struct {
+      // type is BX_EVT_LOG_MSG
+      Bit8u level;
+      char *prefix;
+      char *msg;
+    } logmsg;
+  } u;
+} BxEvent;
+
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/install-x11-fonts.in wxclean/install-x11-fonts.in
--- clean-1.4.pre2/install-x11-fonts.in	Sat Dec  8 10:18:28 2001
+++ wxclean/install-x11-fonts.in	Sun Mar 17 04:12:48 2002
@@ -1,7 +1,7 @@
 #!/bin/sh
 #
 # install-x11-fonts
-# $Id: install-x11-fonts.in,v 1.6 2001/12/08 15:18:28 bdenney Exp $
+# $Id: install-x11-fonts.in,v 1.6.4.1 2002/03/17 08:51:19 bdenney Exp $
 #
 # This is designed help people to get the Bochs fonts installed on their 
 # system.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/instrument/example0/instrument.cc wxclean/instrument/example0/instrument.cc
--- clean-1.4.pre2/instrument/example0/instrument.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/instrument/example0/instrument.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: instrument.cc,v 1.4 2001/10/03 13:10:37 bdenney Exp $
+// $Id: instrument.cc,v 1.2.8.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/instrument/example0/instrument.h wxclean/instrument/example0/instrument.h
--- clean-1.4.pre2/instrument/example0/instrument.h	Wed Oct  3 09:10:38 2001
+++ wxclean/instrument/example0/instrument.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: instrument.h,v 1.4 2001/10/03 13:10:38 bdenney Exp $
+// $Id: instrument.h,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/instrument/example1/instrument.cc wxclean/instrument/example1/instrument.cc
--- clean-1.4.pre2/instrument/example1/instrument.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/instrument/example1/instrument.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: instrument.cc,v 1.2 2001/10/03 13:10:38 bdenney Exp $
+// $Id: instrument.cc,v 1.2.4.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/instrument/example1/instrument.h wxclean/instrument/example1/instrument.h
--- clean-1.4.pre2/instrument/example1/instrument.h	Wed Oct  3 09:10:38 2001
+++ wxclean/instrument/example1/instrument.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: instrument.h,v 1.2 2001/10/03 13:10:38 bdenney Exp $
+// $Id: instrument.h,v 1.2.4.1 2002/03/17 08:51:21 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/instrument/stubs/instrument.cc wxclean/instrument/stubs/instrument.cc
--- clean-1.4.pre2/instrument/stubs/instrument.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/instrument/stubs/instrument.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: instrument.cc,v 1.4 2001/10/03 13:10:38 bdenney Exp $
+// $Id: instrument.cc,v 1.2.8.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/instrument/stubs/instrument.h wxclean/instrument/stubs/instrument.h
--- clean-1.4.pre2/instrument/stubs/instrument.h	Wed Oct  3 09:10:38 2001
+++ wxclean/instrument/stubs/instrument.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: instrument.h,v 1.5 2001/10/03 13:10:38 bdenney Exp $
+// $Id: instrument.h,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/aspi-win32.h wxclean/iodev/aspi-win32.h
--- clean-1.4.pre2/iodev/aspi-win32.h	Mon Jun 25 08:52:38 2001
+++ wxclean/iodev/aspi-win32.h	Sun Mar 17 04:12:52 2002
@@ -1,6 +1,6 @@
 //
 // iodev/aspi-win32.h
-// $Id: aspi-win32.h,v 1.2 2001/06/25 12:52:37 bdenney Exp $
+// $Id: aspi-win32.h,v 1.2.4.1 2002/03/17 08:50:39 bdenney Exp $
 //
 // This file was copied from cdrecord 1.9 under libscg/scg/aspi-win32.h.
 // The only modification is related to use of the PACKED keyword.  
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/cdrom.cc wxclean/iodev/cdrom.cc
--- clean-1.4.pre2/iodev/cdrom.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/iodev/cdrom.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: cdrom.cc,v 1.29 2002/03/02 11:31:18 vruppert Exp $
+// $Id: cdrom.cc,v 1.13.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -203,7 +203,7 @@
 
 void
 cdrom_interface::init(void) {
-  BX_DEBUG(("Init $Id: cdrom.cc,v 1.29 2002/03/02 11:31:18 vruppert Exp $"));
+  BX_DEBUG(("Init $Id: cdrom.cc,v 1.13.2.1 2002/03/17 08:57:02 bdenney Exp $"));
   BX_INFO(("file = '%s'",path));
 }
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/cdrom.h wxclean/iodev/cdrom.h
--- clean-1.4.pre2/iodev/cdrom.h	Tue Mar  5 10:52:26 2002
+++ wxclean/iodev/cdrom.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: cdrom.h,v 1.7 2002/02/01 16:46:27 vruppert Exp $
+// $Id: cdrom.h,v 1.4.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/cdrom_amigaos.cc wxclean/iodev/cdrom_amigaos.cc
--- clean-1.4.pre2/iodev/cdrom_amigaos.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/cdrom_amigaos.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: cdrom_amigaos.cc,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: cdrom_amigaos.cc,v 1.3.4.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2000  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/cmos.cc wxclean/iodev/cmos.cc
--- clean-1.4.pre2/iodev/cmos.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/iodev/cmos.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: cmos.cc,v 1.16 2002/01/29 17:20:11 vruppert Exp $
+// $Id: cmos.cc,v 1.10.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -62,7 +62,7 @@
 bx_cmos_c::init(bx_devices_c *d)
 {
 	unsigned i;
-	BX_DEBUG(("Init $Id: cmos.cc,v 1.16 2002/01/29 17:20:11 vruppert Exp $"));
+	BX_DEBUG(("Init $Id: cmos.cc,v 1.10.2.1 2002/03/17 08:57:02 bdenney Exp $"));
 
 	// CMOS RAM & RTC
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/cmos.h wxclean/iodev/cmos.h
--- clean-1.4.pre2/iodev/cmos.h	Tue Mar  5 10:52:26 2002
+++ wxclean/iodev/cmos.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: cmos.h,v 1.5 2002/01/26 10:00:08 vruppert Exp $
+// $Id: cmos.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/crc32.cc wxclean/iodev/crc32.cc
--- clean-1.4.pre2/iodev/crc32.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/crc32.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: crc32.cc,v 1.4 2001/10/03 13:10:38 bdenney Exp $
+// $Id: crc32.cc,v 1.2.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /* CRC-32 calculator
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/crc32.h wxclean/iodev/crc32.h
--- clean-1.4.pre2/iodev/crc32.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/crc32.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: crc32.h,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: crc32.h,v 1.2.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /* CRC-32 calculator
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/devices.cc wxclean/iodev/devices.cc
--- clean-1.4.pre2/iodev/devices.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/iodev/devices.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: devices.cc,v 1.20 2002/01/29 17:20:11 vruppert Exp $
+// $Id: devices.cc,v 1.9.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -105,7 +105,7 @@
   void
 bx_devices_c::init(BX_MEM_C *newmem)
 {
-  BX_DEBUG(("Init $Id: devices.cc,v 1.20 2002/01/29 17:20:11 vruppert Exp $"));
+  BX_DEBUG(("Init $Id: devices.cc,v 1.9.2.1 2002/03/17 08:57:02 bdenney Exp $"));
   mem = newmem;
   // Start with all IO port address registered to unmapped handler
   // MUST be called first
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/dma.cc wxclean/iodev/dma.cc
--- clean-1.4.pre2/iodev/dma.cc	Tue Mar  5 10:52:26 2002
+++ wxclean/iodev/dma.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: dma.cc,v 1.17 2002/01/18 16:33:47 vruppert Exp $
+// $Id: dma.cc,v 1.7.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -59,7 +59,7 @@
 bx_dma_c::init(bx_devices_c *d)
 {
   unsigned c;
-  BX_DEBUG(("Init $Id: dma.cc,v 1.17 2002/01/18 16:33:47 vruppert Exp $"));
+  BX_DEBUG(("Init $Id: dma.cc,v 1.7.2.1 2002/03/17 08:57:02 bdenney Exp $"));
 
   BX_DMA_THIS devices = d;
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/dma.h wxclean/iodev/dma.h
--- clean-1.4.pre2/iodev/dma.h	Tue Mar  5 10:52:26 2002
+++ wxclean/iodev/dma.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: dma.h,v 1.6 2002/01/18 16:33:47 vruppert Exp $
+// $Id: dma.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth.cc wxclean/iodev/eth.cc
--- clean-1.4.pre2/iodev/eth.cc	Sun Mar 10 00:21:30 2002
+++ wxclean/iodev/eth.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth.cc,v 1.11 2002/03/09 04:18:08 bdenney Exp $
+// $Id: eth.cc,v 1.6.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth.h wxclean/iodev/eth.h
--- clean-1.4.pre2/iodev/eth.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/eth.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth.h,v 1.9 2001/10/03 13:10:38 bdenney Exp $
+// $Id: eth.h,v 1.5.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth_arpback.cc wxclean/iodev/eth_arpback.cc
--- clean-1.4.pre2/iodev/eth_arpback.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/eth_arpback.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth_arpback.cc,v 1.6 2001/10/03 13:10:38 bdenney Exp $
+// $Id: eth_arpback.cc,v 1.4.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth_fbsd.cc wxclean/iodev/eth_fbsd.cc
--- clean-1.4.pre2/iodev/eth_fbsd.cc	Tue Nov  6 12:14:34 2001
+++ wxclean/iodev/eth_fbsd.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth_fbsd.cc,v 1.19 2001/11/06 17:14:34 fries Exp $
+// $Id: eth_fbsd.cc,v 1.12.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth_linux.cc wxclean/iodev/eth_linux.cc
--- clean-1.4.pre2/iodev/eth_linux.cc	Wed Mar  6 12:05:58 2002
+++ wxclean/iodev/eth_linux.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth_linux.cc,v 1.6 2002/03/06 15:56:27 bdenney Exp $
+// $Id: eth_linux.cc,v 1.6.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth_null.cc wxclean/iodev/eth_null.cc
--- clean-1.4.pre2/iodev/eth_null.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/eth_null.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth_null.cc,v 1.6 2001/10/03 13:10:38 bdenney Exp $
+// $Id: eth_null.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth_packetmaker.cc wxclean/iodev/eth_packetmaker.cc
--- clean-1.4.pre2/iodev/eth_packetmaker.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/eth_packetmaker.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth_packetmaker.cc,v 1.5 2001/10/03 13:10:38 bdenney Exp $
+// $Id: eth_packetmaker.cc,v 1.3.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #include "bochs.h"
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth_packetmaker.h wxclean/iodev/eth_packetmaker.h
--- clean-1.4.pre2/iodev/eth_packetmaker.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/eth_packetmaker.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth_packetmaker.h,v 1.5 2001/10/03 13:10:38 bdenney Exp $
+// $Id: eth_packetmaker.h,v 1.3.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth_tap.cc wxclean/iodev/eth_tap.cc
--- clean-1.4.pre2/iodev/eth_tap.cc	Mon Mar 11 10:32:44 2002
+++ wxclean/iodev/eth_tap.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth_tap.cc,v 1.5 2002/03/11 13:59:38 bdenney Exp $
+// $Id: eth_tap.cc,v 1.5.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/eth_win32.cc wxclean/iodev/eth_win32.cc
--- clean-1.4.pre2/iodev/eth_win32.cc	Fri Mar  8 23:08:56 2002
+++ wxclean/iodev/eth_win32.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: eth_win32.cc,v 1.9 2002/03/08 18:46:54 bdenney Exp $
+// $Id: eth_win32.cc,v 1.9.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/floppy.cc wxclean/iodev/floppy.cc
--- clean-1.4.pre2/iodev/floppy.cc	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/floppy.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: floppy.cc,v 1.35 2002/02/27 18:16:30 vruppert Exp $
+// $Id: floppy.cc,v 1.13.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -87,7 +87,7 @@
   void
 bx_floppy_ctrl_c::init(bx_devices_c *d, bx_cmos_c *cmos)
 {
-	BX_DEBUG(("Init $Id: floppy.cc,v 1.35 2002/02/27 18:16:30 vruppert Exp $"));
+	BX_DEBUG(("Init $Id: floppy.cc,v 1.13.2.1 2002/03/17 08:57:02 bdenney Exp $"));
   BX_FD_THIS devices = d;
 
   BX_FD_THIS devices->register_irq(6, "Floppy Drive");
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/floppy.h wxclean/iodev/floppy.h
--- clean-1.4.pre2/iodev/floppy.h	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/floppy.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: floppy.h,v 1.9 2002/02/06 18:51:48 vruppert Exp $
+// $Id: floppy.h,v 1.5.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/guest2host.cc wxclean/iodev/guest2host.cc
--- clean-1.4.pre2/iodev/guest2host.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/guest2host.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: guest2host.cc,v 1.9 2001/10/03 13:10:38 bdenney Exp $
+// $Id: guest2host.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -52,7 +52,7 @@
   void
 bx_g2h_c::init(bx_devices_c *d)
 {
-  BX_DEBUG(("Init $Id: guest2host.cc,v 1.9 2001/10/03 13:10:38 bdenney Exp $"));
+  BX_DEBUG(("Init $Id: guest2host.cc,v 1.5.2.1 2002/03/17 08:57:02 bdenney Exp $"));
   // Reserve a dword port for this interface
   for (Bit32u addr=BX_G2H_PORT; addr<=(BX_G2H_PORT+3); addr++) {
     d->register_io_read_handler(&bx_g2h,
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/guest2host.h wxclean/iodev/guest2host.h
--- clean-1.4.pre2/iodev/guest2host.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/guest2host.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: guest2host.h,v 1.4 2001/10/03 13:10:38 bdenney Exp $
+// $Id: guest2host.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/harddrv.cc wxclean/iodev/harddrv.cc
--- clean-1.4.pre2/iodev/harddrv.cc	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/harddrv.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: harddrv.cc,v 1.50 2002/02/12 16:03:00 cbothamy Exp $
+// $Id: harddrv.cc,v 1.22.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -128,7 +128,7 @@
 bx_hard_drive_c::init(bx_devices_c *d, bx_cmos_c *cmos)
 {
   BX_HD_THIS devices = d;
-	BX_DEBUG(("Init $Id: harddrv.cc,v 1.50 2002/02/12 16:03:00 cbothamy Exp $"));
+	BX_DEBUG(("Init $Id: harddrv.cc,v 1.22.2.1 2002/03/17 08:57:02 bdenney Exp $"));
 
   /* HARD DRIVE 0 */
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/harddrv.h wxclean/iodev/harddrv.h
--- clean-1.4.pre2/iodev/harddrv.h	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/harddrv.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: harddrv.h,v 1.9 2002/02/03 20:49:44 vruppert Exp $
+// $Id: harddrv.h,v 1.4.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/ioapic.cc wxclean/iodev/ioapic.cc
--- clean-1.4.pre2/iodev/ioapic.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/ioapic.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: ioapic.cc,v 1.6 2001/10/03 13:10:38 bdenney Exp $
+// $Id: ioapic.cc,v 1.4.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #include <stdio.h>
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/ioapic.h wxclean/iodev/ioapic.h
--- clean-1.4.pre2/iodev/ioapic.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/ioapic.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: ioapic.h,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: ioapic.h,v 1.2.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 extern class bx_ioapic_c bx_ioapic;
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/iodebug.cc wxclean/iodev/iodebug.cc
--- clean-1.4.pre2/iodev/iodebug.cc	Wed Oct  3 15:54:30 2001
+++ wxclean/iodev/iodebug.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: iodebug.cc,v 1.9 2001/10/03 19:54:29 instinc Exp $
+// $Id: iodebug.cc,v 1.9.4.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #include "bochs.h"
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/iodebug.h wxclean/iodev/iodebug.h
--- clean-1.4.pre2/iodev/iodebug.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/iodebug.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: iodebug.h,v 1.4 2001/10/03 13:10:38 bdenney Exp $
+// $Id: iodebug.h,v 1.4.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #ifndef _BX_IODEBUG_H
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/iodev.h wxclean/iodev/iodev.h
--- clean-1.4.pre2/iodev/iodev.h	Tue Jan 15 17:16:02 2002
+++ wxclean/iodev/iodev.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: iodev.h,v 1.11 2001/12/18 13:12:45 vruppert Exp $
+// $Id: iodev.h,v 1.6.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/keyboard.cc wxclean/iodev/keyboard.cc
--- clean-1.4.pre2/iodev/keyboard.cc	Mon Mar 11 12:02:28 2002
+++ wxclean/iodev/keyboard.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: keyboard.cc,v 1.48 2002/03/11 16:25:52 bdenney Exp $
+// $Id: keyboard.cc,v 1.22.2.3 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -70,7 +70,7 @@
   memset( &s, 0, sizeof(s) );
   BX_KEY_THIS put("KBD");
   BX_KEY_THIS settype(KBDLOG);
-  BX_DEBUG(("Init $Id: keyboard.cc,v 1.48 2002/03/11 16:25:52 bdenney Exp $"));
+  BX_DEBUG(("Init $Id: keyboard.cc,v 1.22.2.3 2002/03/17 08:57:02 bdenney Exp $"));
 }
 
 bx_keyb_c::~bx_keyb_c(void)
@@ -110,7 +110,7 @@
   void
 bx_keyb_c::init(bx_devices_c *d, bx_cmos_c *cmos)
 {
-  BX_DEBUG(("Init $Id: keyboard.cc,v 1.48 2002/03/11 16:25:52 bdenney Exp $"));
+  BX_DEBUG(("Init $Id: keyboard.cc,v 1.22.2.3 2002/03/17 08:57:02 bdenney Exp $"));
   Bit32u   i;
 
   BX_KEY_THIS devices = d;
@@ -1078,6 +1078,8 @@
   if ( ++multiple==10)
   {
     multiple=0;
+	SIM->periodic ();
+	if (BX_CPU_THIS_PTR kill_bochs_request) return 0;
     bx_gui.handle_events();
   }
   retval = BX_KEY_THIS s.kbd_controller.irq1_requested | (BX_KEY_THIS s.kbd_controller.irq12_requested << 1);
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/keyboard.h wxclean/iodev/keyboard.h
--- clean-1.4.pre2/iodev/keyboard.h	Mon Mar 11 10:32:44 2002
+++ wxclean/iodev/keyboard.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: keyboard.h,v 1.12 2002/03/11 15:04:58 bdenney Exp $
+// $Id: keyboard.h,v 1.6.2.2 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/ne2k.cc wxclean/iodev/ne2k.cc
--- clean-1.4.pre2/iodev/ne2k.cc	Fri Mar  8 23:08:56 2002
+++ wxclean/iodev/ne2k.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: ne2k.cc,v 1.32 2002/03/09 01:05:41 bdenney Exp $
+// $Id: ne2k.cc,v 1.14.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -41,7 +41,7 @@
 {
 	put("NE2K");
 	settype(NE2KLOG);
-	BX_DEBUG(("Init $Id: ne2k.cc,v 1.32 2002/03/09 01:05:41 bdenney Exp $"));
+	BX_DEBUG(("Init $Id: ne2k.cc,v 1.14.2.1 2002/03/17 08:57:02 bdenney Exp $"));
 	// nothing for now
 }
 
@@ -1235,7 +1235,7 @@
 void
 bx_ne2k_c::init(bx_devices_c *d)
 {
-  BX_DEBUG(("Init $Id: ne2k.cc,v 1.32 2002/03/09 01:05:41 bdenney Exp $"));
+  BX_DEBUG(("Init $Id: ne2k.cc,v 1.14.2.1 2002/03/17 08:57:02 bdenney Exp $"));
   BX_NE2K_THIS devices = d;
 
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/ne2k.h wxclean/iodev/ne2k.h
--- clean-1.4.pre2/iodev/ne2k.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/ne2k.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: ne2k.h,v 1.6 2001/10/03 13:10:38 bdenney Exp $
+// $Id: ne2k.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/parallel.cc wxclean/iodev/parallel.cc
--- clean-1.4.pre2/iodev/parallel.cc	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/parallel.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: parallel.cc,v 1.17 2002/01/29 17:20:11 vruppert Exp $
+// $Id: parallel.cc,v 1.4.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
@@ -58,7 +58,7 @@
   void
 bx_parallel_c::init(bx_devices_c *d)
 {
-  BX_DEBUG(("Init $Id: parallel.cc,v 1.17 2002/01/29 17:20:11 vruppert Exp $"));
+  BX_DEBUG(("Init $Id: parallel.cc,v 1.4.2.1 2002/03/17 08:57:02 bdenney Exp $"));
   BX_PAR_THIS devices = d;
 
   /* PARALLEL PORT 1 */
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/parallel.h wxclean/iodev/parallel.h
--- clean-1.4.pre2/iodev/parallel.h	Tue Jan 15 17:16:02 2002
+++ wxclean/iodev/parallel.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: parallel.h,v 1.7 2001/12/18 21:58:59 vruppert Exp $
+// $Id: parallel.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pci.cc wxclean/iodev/pci.cc
--- clean-1.4.pre2/iodev/pci.cc	Tue Nov 13 20:39:22 2001
+++ wxclean/iodev/pci.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pci.cc,v 1.13 2001/11/14 01:39:22 bdenney Exp $
+// $Id: pci.cc,v 1.8.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pci.h wxclean/iodev/pci.h
--- clean-1.4.pre2/iodev/pci.h	Tue Nov 13 20:39:22 2001
+++ wxclean/iodev/pci.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pci.h,v 1.5 2001/11/14 01:39:22 bdenney Exp $
+// $Id: pci.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pic.cc wxclean/iodev/pic.cc
--- clean-1.4.pre2/iodev/pic.cc	Wed Mar  6 18:03:06 2002
+++ wxclean/iodev/pic.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pic.cc,v 1.23 2002/03/06 21:52:16 bdenney Exp $
+// $Id: pic.cc,v 1.9.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pic.h wxclean/iodev/pic.h
--- clean-1.4.pre2/iodev/pic.h	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/pic.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pic.h,v 1.6 2002/02/11 08:50:28 vruppert Exp $
+// $Id: pic.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pit.cc wxclean/iodev/pit.cc
--- clean-1.4.pre2/iodev/pit.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/pit.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pit.cc,v 1.10 2001/10/03 13:10:38 bdenney Exp $
+// $Id: pit.cc,v 1.6.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pit.h wxclean/iodev/pit.h
--- clean-1.4.pre2/iodev/pit.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/pit.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pit.h,v 1.7 2001/10/03 13:10:38 bdenney Exp $
+// $Id: pit.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pit82c54.cc wxclean/iodev/pit82c54.cc
--- clean-1.4.pre2/iodev/pit82c54.cc	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/pit82c54.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pit82c54.cc,v 1.19 2002/02/21 21:16:06 yakovlev Exp $
+// $Id: pit82c54.cc,v 1.7.2.1 2002/03/17 08:57:02 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /*
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pit82c54.h wxclean/iodev/pit82c54.h
--- clean-1.4.pre2/iodev/pit82c54.h	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/pit82c54.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pit82c54.h,v 1.10 2002/02/21 19:22:42 yakovlev Exp $
+// $Id: pit82c54.h,v 1.3.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /*
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pit_wrap.cc wxclean/iodev/pit_wrap.cc
--- clean-1.4.pre2/iodev/pit_wrap.cc	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/pit_wrap.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pit_wrap.cc,v 1.17 2002/02/08 22:27:51 yakovlev Exp $
+// $Id: pit_wrap.cc,v 1.2.2.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/pit_wrap.h wxclean/iodev/pit_wrap.h
--- clean-1.4.pre2/iodev/pit_wrap.h	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/pit_wrap.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pit_wrap.h,v 1.8 2002/02/07 21:22:55 yakovlev Exp $
+// $Id: pit_wrap.h,v 1.1.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/sb16.cc wxclean/iodev/sb16.cc
--- clean-1.4.pre2/iodev/sb16.cc	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/sb16.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: sb16.cc,v 1.18 2002/01/29 17:20:12 vruppert Exp $
+// $Id: sb16.cc,v 1.10.2.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/sb16.h wxclean/iodev/sb16.h
--- clean-1.4.pre2/iodev/sb16.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/sb16.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: sb16.h,v 1.6 2001/10/03 13:10:38 bdenney Exp $
+// $Id: sb16.h,v 1.5.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/scancodes.cc wxclean/iodev/scancodes.cc
--- clean-1.4.pre2/iodev/scancodes.cc	Wed Mar  6 12:05:58 2002
+++ wxclean/iodev/scancodes.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: scancodes.cc,v 1.3 2002/03/06 14:04:42 cbothamy Exp $
+// $Id: scancodes.cc,v 1.3.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  Christophe Bothamy
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/scancodes.h wxclean/iodev/scancodes.h
--- clean-1.4.pre2/iodev/scancodes.h	Wed Mar  6 12:05:58 2002
+++ wxclean/iodev/scancodes.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: scancodes.h,v 1.2 2002/03/06 09:19:36 cbothamy Exp $
+// $Id: scancodes.h,v 1.2.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  Christophe Bothamy
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/scsi_commands.h wxclean/iodev/scsi_commands.h
--- clean-1.4.pre2/iodev/scsi_commands.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/scsi_commands.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: scsi_commands.h,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: scsi_commands.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 /* scsi/commands.h
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/scsidefs.h wxclean/iodev/scsidefs.h
--- clean-1.4.pre2/iodev/scsidefs.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/scsidefs.h	Sun Mar 17 04:12:52 2002
@@ -1,10 +1,10 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: scsidefs.h,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: scsidefs.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //
 // iodev/scsidefs.h
-// $Id: scsidefs.h,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: scsidefs.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 //
 // This file was copied from ... ?
 //
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/scsipt.h wxclean/iodev/scsipt.h
--- clean-1.4.pre2/iodev/scsipt.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/scsipt.h	Sun Mar 17 04:12:52 2002
@@ -1,10 +1,10 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: scsipt.h,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: scsipt.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //
 // iodev/scsipt.h
-// $Id: scsipt.h,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: scsipt.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 //
 // This file was copied from ... ?
 //
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/serial.cc wxclean/iodev/serial.cc
--- clean-1.4.pre2/iodev/serial.cc	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/serial.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: serial.cc,v 1.19 2002/03/05 15:40:23 grossman Exp $
+// $Id: serial.cc,v 1.10.2.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/serial.h wxclean/iodev/serial.h
--- clean-1.4.pre2/iodev/serial.h	Tue Mar  5 10:52:28 2002
+++ wxclean/iodev/serial.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: serial.h,v 1.6 2002/01/20 16:35:32 vruppert Exp $
+// $Id: serial.h,v 1.4.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/serial_raw.cc wxclean/iodev/serial_raw.cc
--- clean-1.4.pre2/iodev/serial_raw.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/serial_raw.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: serial_raw.cc,v 1.4 2001/10/03 13:10:38 bdenney Exp $
+// $Id: serial_raw.cc,v 1.2.2.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/serial_raw.h wxclean/iodev/serial_raw.h
--- clean-1.4.pre2/iodev/serial_raw.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/serial_raw.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: serial_raw.h,v 1.2 2001/10/03 13:10:38 bdenney Exp $
+// $Id: serial_raw.h,v 1.1.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #include <linux/serial.h>
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/slowdown_timer.cc wxclean/iodev/slowdown_timer.cc
--- clean-1.4.pre2/iodev/slowdown_timer.cc	Wed Mar  6 12:05:58 2002
+++ wxclean/iodev/slowdown_timer.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: slowdown_timer.cc,v 1.9 2002/03/06 01:19:50 instinc Exp $
+// $Id: slowdown_timer.cc,v 1.9.2.1 2002/03/17 09:05:55 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 #include "bochs.h"
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/slowdown_timer.h wxclean/iodev/slowdown_timer.h
--- clean-1.4.pre2/iodev/slowdown_timer.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/slowdown_timer.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: slowdown_timer.h,v 1.5 2001/10/03 13:10:38 bdenney Exp $
+// $Id: slowdown_timer.h,v 1.5.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/soundlnx.cc wxclean/iodev/soundlnx.cc
--- clean-1.4.pre2/iodev/soundlnx.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/soundlnx.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: soundlnx.cc,v 1.4 2001/10/03 13:10:38 bdenney Exp $
+// $Id: soundlnx.cc,v 1.3.4.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/soundlnx.h wxclean/iodev/soundlnx.h
--- clean-1.4.pre2/iodev/soundlnx.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/soundlnx.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: soundlnx.h,v 1.4 2001/10/03 13:10:38 bdenney Exp $
+// $Id: soundlnx.h,v 1.3.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/soundwin.cc wxclean/iodev/soundwin.cc
--- clean-1.4.pre2/iodev/soundwin.cc	Wed Mar  6 12:05:58 2002
+++ wxclean/iodev/soundwin.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: soundwin.cc,v 1.8 2002/03/05 17:22:59 bdenney Exp $
+// $Id: soundwin.cc,v 1.6.2.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/soundwin.h wxclean/iodev/soundwin.h
--- clean-1.4.pre2/iodev/soundwin.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/soundwin.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: soundwin.h,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: soundwin.h,v 1.2.8.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/unmapped.cc wxclean/iodev/unmapped.cc
--- clean-1.4.pre2/iodev/unmapped.cc	Tue Jan 15 17:16:02 2002
+++ wxclean/iodev/unmapped.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: unmapped.cc,v 1.14 2001/12/21 19:33:18 bdenney Exp $
+// $Id: unmapped.cc,v 1.8.2.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/unmapped.h wxclean/iodev/unmapped.h
--- clean-1.4.pre2/iodev/unmapped.h	Wed Oct  3 09:10:38 2001
+++ wxclean/iodev/unmapped.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: unmapped.h,v 1.5 2001/10/03 13:10:38 bdenney Exp $
+// $Id: unmapped.h,v 1.3.4.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/vga.cc wxclean/iodev/vga.cc
--- clean-1.4.pre2/iodev/vga.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/iodev/vga.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: vga.cc,v 1.25 2002/03/10 20:59:11 japj Exp $
+// $Id: vga.cc,v 1.15.2.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/iodev/vga.h wxclean/iodev/vga.h
--- clean-1.4.pre2/iodev/vga.h	Sun Mar 17 04:16:28 2002
+++ wxclean/iodev/vga.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: vga.h,v 1.8 2002/03/10 04:51:24 bdenney Exp $
+// $Id: vga.h,v 1.4.2.1 2002/03/17 08:50:39 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2002  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/load32bitOShack.cc wxclean/load32bitOShack.cc
--- clean-1.4.pre2/load32bitOShack.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/load32bitOShack.cc	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: load32bitOShack.cc,v 1.7 2001/10/03 13:10:37 bdenney Exp $
+// $Id: load32bitOShack.cc,v 1.6.2.2 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -268,12 +268,12 @@
            );
   if (fd < 0) {
     BX_INFO(( "load_kernel_image: couldn't open image file '%s'.", path ));
-    exit(1);
+    BX_EXIT(1);
     }
   ret = fstat(fd, &stat_buf);
   if (ret) {
     BX_INFO(( "load_kernel_image: couldn't stat image file '%s'.", path ));
-    exit(1);
+    BX_EXIT(1);
     }
 
   size = stat_buf.st_size;
@@ -282,7 +282,7 @@
   BX_MEM_C *mem = BX_MEM(0);
   if ( (paddr + size) > mem->len ) {
     BX_INFO(( "load_kernel_image: address range > physical memsize!" ));
-    exit(1);
+    BX_EXIT(1);
     }
 
   offset = 0;
@@ -290,7 +290,7 @@
     ret = read(fd, (bx_ptr_t) &mem->vector[paddr + offset], size);
     if (ret <= 0) {
       BX_INFO(( "load_kernel_image: read failed on image" ));
-      exit(1);
+      BX_EXIT(1);
       }
     size -= ret;
     offset += ret;
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/logio.cc wxclean/logio.cc
--- clean-1.4.pre2/logio.cc	Tue Jan 15 17:15:56 2002
+++ wxclean/logio.cc	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: logio.cc,v 1.16 2002/01/07 16:10:11 bdenney Exp $
+// $Id: logio.cc,v 1.3.2.2 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -424,7 +424,7 @@
   fgets (buf, 8, stdin);
 #endif
 #if !BX_DEBUGGER
-  exit(1);
+  BX_EXIT(1);
 #else
   static Boolean dbg_exit_called = 0;
   if (dbg_exit_called == 0) {
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/main.cc wxclean/main.cc
--- clean-1.4.pre2/main.cc	Sun Mar 17 04:16:28 2002
+++ wxclean/main.cc	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: main.cc,v 1.89 2002/03/06 23:31:02 cbothamy Exp $
+// $Id: main.cc,v 1.58.2.8 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -895,10 +895,9 @@
 }
 #endif
 
-int
-main(int argc, char *argv[])
+void
+bx_init_before_control_panel ()
 {
-  int arg = 1;
   // To deal with initialization order problems inherent in C++, use the macros
   // SAFE_GET_IOFUNC and SAFE_GET_GENLOG to retrieve "io" and "genlog" in all
   // constructors or functions called by constructors.  The macros test for
@@ -910,7 +909,7 @@
 
   bx_print_header ();
   bx_init_bx_dbg ();
-
+  bx_init_options ();
 #if BX_WITH_CARBON
     /* "-psn" is passed if we are launched by double-clicking */
    if ( argc >= 2 && strncmp (argv[1], "-psn", 4) == 0 ) {
@@ -932,26 +931,17 @@
   getwd (cwd);
   BX_INFO (("Now my working directory is %s", cwd));
 #endif
+  // NOTE: there's no longer any implementation of -nocp or -nocontrolpanel
+  // in this wxwindows situation.
+}
 
-  init_siminterface ();
-  bx_control_panel (BX_CPANEL_INIT);
-  bx_init_options ();
-
-  // detect -nocontrolpanel or -nocp argument before anything else
-  if (argc > 1 && 
-       ((!strcmp ("-nocontrolpanel", argv[1]))
-        || (!strcmp ("-nocp", argv[1])))) {
-    // skip the control panel
-    arg++;
-    SIM->set_enabled (0);
-    enable_control_panel = 0;
-  }
-#if !BX_USE_CONTROL_PANEL
-  enable_control_panel = 0;
-#endif
-
-  if (!enable_control_panel) {
-    // if we don't intend to run the control panel, parse the .bochsrc now.
+int
+bx_continue_after_control_panel (int argc, char *argv[])
+{
+  int arg = 1;
+  int read_rc_already = 0;
+  if (!read_rc_already) {
+    /* parse configuration file and command line arguments */
     char *bochsrc = bx_find_bochsrc ();
     if (bochsrc)
       bx_read_configuration (bochsrc);
@@ -973,7 +963,7 @@
       fprintf (stderr, "   cd /usr/local/bochs/dlxlinux\n");
       fprintf (stderr, "   bochs\n");
 #endif
-      exit(1);
+      BX_EXIT(1);
     }
   }
 
@@ -992,7 +982,10 @@
     }
     // Display the pre-simulation control panel.
     SIM->set_enabled (1);
+#if !USE_WX
+// if wxwindows interface in use, don't use the text mode interface.
     bx_control_panel (BX_CPANEL_START_MENU);
+#endif
   }
 
 #if BX_DEBUGGER
@@ -1020,7 +1013,8 @@
     // only one processor, run as fast as possible by not messing with
     // quantums and loops.
     BX_CPU(0)->cpu_loop(1);
-    BX_PANIC (("cpu_loop should never return in a single-processor simulation"));
+	// for one processor, the only reason for cpu_loop to return is
+	// that kill_bochs_request was set by the GUI interface.
   } else {
     // SMP simulation: do a few instructions on each processor, then switch
     // to another.  Increasing quantum speeds up overall performance, but
@@ -1031,12 +1025,15 @@
       // do some instructions in each processor
       BX_CPU(processor)->cpu_loop(quantum);
       processor = (processor+1) % BX_SMP_PROCESSORS;
+	  if (BX_CPU(0)->kill_bochs_request) 
+	    break;
       if (processor == 0) 
-	BX_TICKN(quantum);
+	    BX_TICKN(quantum);
     }
   }
 #endif
-
+  BX_INFO (("cpu loop quit, shutting down simulator"));
+  bx_atexit ();
   return(0);
 }
 
@@ -1179,28 +1176,32 @@
 }
 
 
-  void
+int
 bx_atexit(void)
 {
   static Boolean been_here = 0;
-
+  printf ("bx_atexit: been_here = %d\n", been_here);
+  if (been_here) return 1;   // protect from reentry
+  been_here = 1;
 
 #if BX_PROVIDE_DEVICE_MODELS==1
-  if (been_here == 0) {
-    bx_pc_system.exit();
-    }
+  printf ("shutting down device models\n");
+  bx_pc_system.exit();
 #endif
 
 #if BX_DEBUGGER == 0
+  printf ("shutting down processors\n");
   for (int cpu=0; cpu<BX_SMP_PROCESSORS; cpu++)
     if (BX_CPU(cpu)) BX_CPU(cpu)->atexit();
 #endif
 
 #if BX_PCI_SUPPORT
+    printf ("shutting down PCI\n");
     if (bx_options.Oi440FXSupport->get ()) {
       bx_devices.pci->print_i440fx_state();
       }
 #endif
+	return 0;
 }
 
 #if (BX_PROVIDE_CPU_MEMORY==1) && (BX_EMULATE_HGA_DUMPS>0)
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/memory/memory.cc wxclean/memory/memory.cc
--- clean-1.4.pre2/memory/memory.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/memory/memory.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: memory.cc,v 1.9 2001/10/03 13:10:38 bdenney Exp $
+// $Id: memory.cc,v 1.7.2.1 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/memory/memory.h wxclean/memory/memory.h
--- clean-1.4.pre2/memory/memory.h	Wed Oct  3 09:10:38 2001
+++ wxclean/memory/memory.h	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: memory.h,v 1.6 2001/10/03 13:10:38 bdenney Exp $
+// $Id: memory.h,v 1.5.2.1 2002/03/17 08:51:21 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/memory/misc_mem.cc wxclean/memory/misc_mem.cc
--- clean-1.4.pre2/memory/misc_mem.cc	Tue Nov 13 20:39:22 2001
+++ wxclean/memory/misc_mem.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: misc_mem.cc,v 1.17 2001/11/14 01:39:22 bdenney Exp $
+// $Id: misc_mem.cc,v 1.11.2.2 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -90,7 +90,7 @@
   void
 BX_MEM_C::init_memory(int memsize)
 {
-	BX_DEBUG(("Init $Id: misc_mem.cc,v 1.17 2001/11/14 01:39:22 bdenney Exp $"));
+	BX_DEBUG(("Init $Id: misc_mem.cc,v 1.11.2.2 2002/03/17 08:57:03 bdenney Exp $"));
   // you can pass 0 if memory has been allocated already through
   // the constructor, or the desired size of memory if it hasn't
 
@@ -137,19 +137,19 @@
            );
   if (fd < 0) {
     BX_INFO(( "ROM: couldn't open ROM image file '%s'.", path));
-    exit(1);
+    BX_EXIT(1);
     }
   ret = fstat(fd, &stat_buf);
   if (ret) {
     BX_INFO(( "ROM: couldn't stat ROM image file '%s'.", path));
-    exit(1);
+    BX_EXIT(1);
     }
 
   size = stat_buf.st_size;
 
   if ( (romaddress + size) > BX_MEM_THIS len ) {
     BX_INFO(( "ROM: ROM address range > physical memsize!"));
-    exit(1);
+    BX_EXIT(1);
     }
 
   offset = 0;
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/misc/bximage.c wxclean/misc/bximage.c
--- clean-1.4.pre2/misc/bximage.c	Sat Dec  8 12:46:02 2001
+++ wxclean/misc/bximage.c	Sun Mar 17 04:12:52 2002
@@ -1,6 +1,6 @@
 /* 
  * misc/bximage.c
- * $Id: bximage.c,v 1.6 2001/12/08 17:46:02 bdenney Exp $
+ * $Id: bximage.c,v 1.5.4.1 2002/03/17 08:51:21 bdenney Exp $
  *
  * Create empty hard disk or floppy disk images for bochs.
  *
@@ -14,7 +14,7 @@
 #include "config.h"
 
 char *EOF_ERR = "ERROR: End of input";
-char *rcsid = "$Id: bximage.c,v 1.6 2001/12/08 17:46:02 bdenney Exp $";
+char *rcsid = "$Id: bximage.c,v 1.5.4.1 2002/03/17 08:51:21 bdenney Exp $";
 char *divider = "========================================================================";
 
 /* menu data for choosing floppy/hard disk */
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/misc/hello.cc wxclean/misc/hello.cc
--- clean-1.4.pre2/misc/hello.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/misc/hello.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /*
- * $Id: hello.cc,v 1.2 2001/10/03 13:10:38 bdenney Exp $
+ * $Id: hello.cc,v 1.1.10.1 2002/03/17 08:57:03 bdenney Exp $
  */
 
 #include <stdio.h>
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/misc/make_cmos_image.cc wxclean/misc/make_cmos_image.cc
--- clean-1.4.pre2/misc/make_cmos_image.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/misc/make_cmos_image.cc	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: make_cmos_image.cc,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: make_cmos_image.cc,v 1.2.8.2 2002/03/17 08:57:03 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
@@ -79,7 +79,7 @@
 
   if (argc != 2) {
     fprintf(stderr, "usage: %s pathname\n", argv[0]);
-    exit(1);
+    BX_EXIT(1);
     }
 
   fd = open(argv[1], O_WRONLY | O_CREAT
@@ -90,13 +90,13 @@
            );
   if (fd < 0) {
     perror("trying to open cmos image file to write.\n");
-    exit(1);
+    BX_EXIT(1);
     }
 
   ret = write(fd, cmos, sizeof(cmos));
   if (ret != sizeof(cmos)) {
     perror("write() did not write all CMOS data.\n");
-    exit(1);
+    BX_EXIT(1);
     }
   printf("CMOS data successfuly written to file '%s'.\n", argv[1]);
 }
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/misc/niclist.c wxclean/misc/niclist.c
--- clean-1.4.pre2/misc/niclist.c	Tue Mar  5 10:52:28 2002
+++ wxclean/misc/niclist.c	Sun Mar 17 04:12:52 2002
@@ -2,7 +2,7 @@
 //
 // misc/niclist.c
 // by Don Becker <x-odus@iname.com>
-// $Id: niclist.c,v 1.6 2002/02/03 06:22:21 bdenney Exp $
+// $Id: niclist.c,v 1.6.2.1 2002/03/17 08:51:21 bdenney Exp $
 //
 // This program is for win32 only.  It lists the network interface cards
 // that you can use in the "ethdev" field of the ne2k line in your bochsrc.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/misc/sb16/sb16ctrl.c wxclean/misc/sb16/sb16ctrl.c
--- clean-1.4.pre2/misc/sb16/sb16ctrl.c	Wed Oct  3 09:10:38 2001
+++ wxclean/misc/sb16/sb16ctrl.c	Sun Mar 17 04:12:52 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: sb16ctrl.c,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: sb16ctrl.c,v 1.2.8.1 2002/03/17 08:51:21 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/misc/test-access-check.cc wxclean/misc/test-access-check.cc
--- clean-1.4.pre2/misc/test-access-check.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/misc/test-access-check.cc	Sun Mar 17 04:12:52 2002
@@ -1,7 +1,7 @@
 /////////////////////////////////////////////////////////////////////////
 //
 // test-access-check.cc
-// $Id: test-access-check.cc,v 1.3 2001/10/03 13:10:38 bdenney Exp $
+// $Id: test-access-check.cc,v 1.3.4.1 2002/03/17 09:05:55 bdenney Exp $
 // by Bryce Denney
 //
 // This whole program is intended to test just a few lines in
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/osdep.cc wxclean/osdep.cc
--- clean-1.4.pre2/osdep.cc	Wed Oct  3 09:10:38 2001
+++ wxclean/osdep.cc	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: osdep.cc,v 1.6 2001/10/03 13:10:37 bdenney Exp $
+// $Id: osdep.cc,v 1.4.4.2 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/osdep.h wxclean/osdep.h
--- clean-1.4.pre2/osdep.h	Fri Mar  8 23:08:56 2002
+++ wxclean/osdep.h	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: osdep.h,v 1.11 2002/03/08 04:45:00 bdenney Exp $
+// $Id: osdep.h,v 1.5.2.1 2002/03/17 08:51:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/pc_system.cc wxclean/pc_system.cc
--- clean-1.4.pre2/pc_system.cc	Tue Jan 15 17:15:56 2002
+++ wxclean/pc_system.cc	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pc_system.cc,v 1.17 2001/12/26 14:56:15 vruppert Exp $
+// $Id: pc_system.cc,v 1.8.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/pc_system.h wxclean/pc_system.h
--- clean-1.4.pre2/pc_system.h	Tue Jan 15 17:15:56 2002
+++ wxclean/pc_system.h	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: pc_system.h,v 1.10 2001/12/26 14:56:15 vruppert Exp $
+// $Id: pc_system.h,v 1.5.4.1 2002/03/17 08:51:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/state_file.cc wxclean/state_file.cc
--- clean-1.4.pre2/state_file.cc	Tue Jan 15 17:15:56 2002
+++ wxclean/state_file.cc	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: state_file.cc,v 1.9 2001/12/21 19:33:18 bdenney Exp $
+// $Id: state_file.cc,v 1.6.2.1 2002/03/17 08:57:01 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/state_file.h wxclean/state_file.h
--- clean-1.4.pre2/state_file.h	Wed Oct  3 09:10:38 2001
+++ wxclean/state_file.h	Sun Mar 17 04:12:48 2002
@@ -1,5 +1,5 @@
 /////////////////////////////////////////////////////////////////////////
-// $Id: state_file.h,v 1.4 2001/10/03 13:10:37 bdenney Exp $
+// $Id: state_file.h,v 1.3.4.1 2002/03/17 08:51:19 bdenney Exp $
 /////////////////////////////////////////////////////////////////////////
 //
 //  Copyright (C) 2001  MandrakeSoft S.A.
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/test-x11-fonts wxclean/test-x11-fonts
--- clean-1.4.pre2/test-x11-fonts	Sun Sep 30 10:53:58 2001
+++ wxclean/test-x11-fonts	Sun Mar 17 04:12:48 2002
@@ -1,7 +1,7 @@
 #!/bin/sh
 #
 # test-x11-fonts
-# $Id: test-x11-fonts,v 1.1 2001/09/30 14:53:57 bdenney Exp $
+# $Id: test-x11-fonts,v 1.1.4.1 2002/03/17 08:51:19 bdenney Exp $
 #
 # This script tries to run xterm using the vga font that bochs requires.  If
 # xterm can't find the vga font, then certainly bochs will not be able to
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/wxbochs.rc wxclean/wxbochs.rc
--- clean-1.4.pre2/wxbochs.rc	Wed Dec 31 19:00:00 1969
+++ wxclean/wxbochs.rc	Sun Mar 17 03:27:40 2002
@@ -0,0 +1 @@
+#include "wx/msw/wx.rc"
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/wxmain.cc wxclean/wxmain.cc
--- clean-1.4.pre2/wxmain.cc	Wed Dec 31 19:00:00 1969
+++ wxclean/wxmain.cc	Sun Mar 17 02:43:30 2002
@@ -0,0 +1,522 @@
+//
+// wxmain.cc
+// Main program for wxWindows.  This does not replace main.cc by any means.
+// It just provides the program entry point, and calls functions in main.cc
+// when it's appropriate.
+//
+// Note that this file does NOT include bochs.h.  In an attempt to keep the
+// interface between Bochs and its gui clean and well defined, all 
+// communication is done through the siminterface object.
+//
+// Types of events between threads:
+// - async events from gui to Bochs. example: start, pause, resume, keypress
+// - async events from Bochs to gui. example: log message
+// - synchronous events from Bochs to gui. Bochs will block forever until the
+//   gui responds to it.
+//
+// Sync events are what I need first.  Bochs calls siminterface function
+// which creates an event and calls wx_bochs2gui_sync_event (event).  This
+// function clears the synchronous event mailbox, posts the event onto 
+// the GUI event queue, then blocks forever until the GUI places the response
+// event in the mailbox.  Then it clears the mailbox and returns the response
+// event.
+
+// For compilers that support precompilation, includes "wx/wx.h".
+#include "wx/wxprec.h"
+#ifdef __BORLANDC__
+#pragma hdrstop
+#endif
+#ifndef WX_PRECOMP
+#include "wx/wx.h"
+#endif
+
+#include "config.h"
+extern "C" {
+// siminterface needs stdio.h
+#include <stdio.h>
+}
+#include "osdep.h"
+#include "gui/control.h"
+#include "gui/siminterface.h"
+
+class MyApp: public wxApp
+{
+virtual bool OnInit();
+};
+
+class MyFrame;
+
+class BochsThread: public wxThread
+{
+  // when Bochs sends a synchronous event to the GUI thread, the response
+  // is stored here.
+  MyFrame *frame;
+
+  // support response to a synchronous event.
+  // FIXME: this would be cleaner and more reusable if I made a thread-safe
+  // mailbox class.
+  BxEvent *bochs2gui_mailbox;
+  wxCriticalSection bochs2gui_mailbox_lock;
+
+public:
+  BochsThread (MyFrame *_frame) { frame = _frame; }
+  virtual ExitCode Entry ();
+  void OnExit ();
+  // called by the siminterface code, with the pointer to the Bochs thread
+  // in the thisptr arg.
+  static BxEvent *SiminterfaceCallback (void *thisptr, BxEvent *event);
+  BxEvent *SiminterfaceCallback2 (BxEvent *event);
+  // methods to coordinate synchronous response mailbox
+  void ClearSyncResponse ();
+  void SendSyncResponse (BxEvent *);
+  BxEvent *GetSyncResponse ();
+private:
+};
+
+class MyFrame: public wxFrame
+{
+public:
+MyFrame(const wxString& title, const wxPoint& pos, const wxSize&
+size);
+void OnQuit(wxCommandEvent& event);
+void OnAbout(wxCommandEvent& event);
+void OnStartBochs(wxCommandEvent& event);
+void OnPauseResumeBochs(wxCommandEvent& event);
+void OnKillBochs(wxCommandEvent& event);
+void OnBochs2GuiEvent(wxCommandEvent& event);
+int HandleAskParam (BxEvent *event);
+int StartBochsThread ();
+
+// called from the Bochs thread's OnExit() method.
+void OnBochsThreadExit ();
+
+private:
+wxCriticalSection bochs_thread_lock;
+BochsThread *bochs_thread; // get the lock before accessing bochs_thread
+int HandleVgaGuiButton (bx_id param);
+int start_bochs_times;
+wxMenu *menuConfiguration;
+wxMenu *menuEdit;
+wxMenu *menuSimulate;
+wxMenu *menuDebug;
+wxMenu *menuLog;
+wxMenu *menuHelp;
+
+DECLARE_EVENT_TABLE()
+};
+
+enum
+{
+ID_Quit = 1,
+ID_Config_New,
+ID_Config_Read,
+ID_Config_Save,
+ID_Edit_Disks,
+ID_Edit_Boot,
+ID_Edit_Vga,
+ID_Edit_Memory,
+ID_Edit_Sound,
+ID_Edit_Network,
+ID_Edit_Keyboard,
+ID_Edit_Other,
+ID_Simulate_Start,
+ID_Simulate_PauseResume,
+ID_Simulate_Stop,
+ID_Simulate_Speed,
+ID_Debug_ShowCpu,
+ID_Debug_ShowMemory,
+ID_Log_View,
+ID_Log_Prefs,
+ID_Log_PrefsDevice,
+ID_Help_About,
+ID_Bochs2Gui_Event,
+};
+
+BEGIN_EVENT_TABLE(MyFrame, wxFrame)
+EVT_MENU(ID_Quit, MyFrame::OnQuit)
+EVT_MENU(ID_Help_About, MyFrame::OnAbout)
+EVT_MENU(ID_Simulate_Start, MyFrame::OnStartBochs)
+EVT_MENU(ID_Simulate_PauseResume, MyFrame::OnPauseResumeBochs)
+EVT_MENU(ID_Simulate_Stop, MyFrame::OnKillBochs)
+EVT_MENU(ID_Bochs2Gui_Event, MyFrame::OnBochs2GuiEvent)
+END_EVENT_TABLE()
+
+IMPLEMENT_APP(MyApp)
+
+bool MyApp::OnInit()
+{
+  siminterface_init ();
+  MyFrame *frame = new MyFrame( "Bochs Control Panel", wxPoint(50,50),
+  wxSize(450,340) );
+  frame->Show( TRUE );
+  SetTopWindow( frame );
+  return TRUE;
+}
+
+MyFrame::MyFrame(const wxString& title, const wxPoint& pos, const
+wxSize& size)
+: wxFrame((wxFrame *)NULL, -1, title, pos, size)
+{
+  // init variables
+  bochs_thread = NULL;
+  start_bochs_times = 0;
+
+  // set up the gui
+  menuConfiguration = new wxMenu;
+  menuConfiguration->Append( ID_Config_New, "&New Configuration" );
+  menuConfiguration->Append( ID_Config_Read, "&Read Configuration" );
+  menuConfiguration->Append( ID_Config_Save, "&Save Configuration" );
+  menuConfiguration->AppendSeparator ();
+  menuConfiguration->Append (ID_Quit, "&Quit");
+
+  menuEdit = new wxMenu;
+  menuEdit->Append( ID_Edit_Disks, "&Disks..." );
+  menuEdit->Append( ID_Edit_Boot, "&Boot..." );
+  menuEdit->Append( ID_Edit_Vga, "&VGA..." );
+  menuEdit->Append( ID_Edit_Memory, "&Memory..." );
+  menuEdit->Append( ID_Edit_Sound, "&Sound..." );
+  menuEdit->Append( ID_Edit_Network, "&Network..." );
+  menuEdit->Append( ID_Edit_Keyboard, "&Keyboard..." );
+  menuEdit->Append( ID_Edit_Other, "&Other..." );
+
+  menuSimulate = new wxMenu;
+  menuSimulate->Append( ID_Simulate_Start, "&Start...");
+  menuSimulate->Append( ID_Simulate_PauseResume, "&Pause...");
+  menuSimulate->Append( ID_Simulate_Stop, "S&top...");
+  menuSimulate->AppendSeparator ();
+  menuSimulate->Append( ID_Simulate_Speed, "S&peed...");
+  menuSimulate->Enable (ID_Simulate_PauseResume, FALSE);
+  menuSimulate->Enable (ID_Simulate_Stop, FALSE);
+
+  menuDebug = new wxMenu;
+  menuDebug->Append (ID_Debug_ShowCpu, "Show &CPU");
+  menuDebug->Append (ID_Debug_ShowMemory, "Show &memory");
+
+  menuLog = new wxMenu;
+  menuLog->Append (ID_Log_View, "&View");
+  menuLog->Append (ID_Log_Prefs, "&Preferences...");
+  menuLog->Append (ID_Log_PrefsDevice, "By &Device...");
+
+  menuHelp = new wxMenu;
+  menuHelp->Append( ID_Help_About, "&About..." );
+
+  wxMenuBar *menuBar = new wxMenuBar;
+  menuBar->Append( menuConfiguration, "&File" );
+  menuBar->Append( menuEdit, "&Edit" );
+  menuBar->Append( menuSimulate, "&Simulate" );
+  menuBar->Append( menuDebug, "&Debug" );
+  menuBar->Append( menuLog, "&Log" );
+  menuBar->Append( menuHelp, "&Help" );
+  SetMenuBar( menuBar );
+  CreateStatusBar();
+  SetStatusText( "Welcome to wxWindows!" );
+}
+
+void MyFrame::OnQuit(wxCommandEvent& event)
+{
+  Close( TRUE );
+  OnKillBochs (event);
+#if 0
+  if (SIM)
+	SIM->quit_sim(0);  // give bochs a chance to shut down
+#endif
+}
+
+void MyFrame::OnAbout(wxCommandEvent& WXUNUSED(event))
+{
+wxMessageBox( "wxWindows Control Panel for Bochs. (Very Experimental)",
+"Bochs Control Panel", wxOK | wxICON_INFORMATION );
+}
+
+void MyFrame::OnStartBochs(wxCommandEvent& WXUNUSED(event))
+{
+  wxCriticalSectionLocker lock(bochs_thread_lock);
+  if (bochs_thread != NULL) {
+	wxMessageBox (
+	  "Can't start Bochs simulator, because it is already running",
+	  "Already Running", wxOK | wxICON_ERROR);
+	return;
+  }
+  wxLogStatus ("Starting a Bochs simulation\n");
+  start_bochs_times++;
+  if (start_bochs_times>1) {
+	wxMessageBox (
+	"You have already started up Bochs once this session. Due to memory leaks, you may get unstable behavior.",
+	"2nd time warning", wxOK | wxICON_WARNING);
+  }
+  bochs_thread = new BochsThread (this);
+  bochs_thread->Create ();
+  bochs_thread->Run ();                                                        
+  wxLogDebug ("Bochs thread has started.\n");
+  // set up callback for events from Bochs
+  SIM->set_notify_callback (&BochsThread::SiminterfaceCallback, bochs_thread);
+  // fix up menu choices
+  menuSimulate->Enable (ID_Simulate_Start, FALSE);
+  menuSimulate->Enable (ID_Simulate_PauseResume, TRUE);
+  menuSimulate->Enable (ID_Simulate_Stop, TRUE);
+  menuSimulate->SetLabel (ID_Simulate_PauseResume, "&Pause");
+}
+
+void MyFrame::OnPauseResumeBochs(wxCommandEvent& WXUNUSED(event))
+{
+  wxCriticalSectionLocker lock(bochs_thread_lock);
+  if (bochs_thread) {
+    if (bochs_thread->IsPaused ()) {
+	  SetStatusText ("Resuming the Bochs simulation");
+	  bochs_thread->Resume ();
+	  menuSimulate->SetLabel (ID_Simulate_PauseResume, "&Pause");
+	} else {
+	  SetStatusText ("Pausing the Bochs simulation");
+	  bochs_thread->Pause ();
+	  menuSimulate->SetLabel (ID_Simulate_PauseResume, "&Resume");
+	}
+  }
+}
+
+void MyFrame::OnKillBochs(wxCommandEvent& WXUNUSED(event))
+{
+  // DON'T use a critical section here.  Delete implicitly calls
+  // OnBochsThreadExit, which also tries to lock bochs_thread_lock.
+  // If we grab the lock at this level, deadlock results.
+  if (bochs_thread) {
+	SetStatusText ("Killing the Bochs simulation");
+	bochs_thread->Delete ();
+	menuSimulate->Enable (ID_Simulate_Start, TRUE);
+	menuSimulate->Enable (ID_Simulate_PauseResume, FALSE);
+	menuSimulate->Enable (ID_Simulate_Stop, FALSE);
+	menuSimulate->SetLabel (ID_Simulate_PauseResume, "&Pause");
+  }
+}
+
+void
+MyFrame::OnBochsThreadExit () {
+  wxCriticalSectionLocker lock (bochs_thread_lock);
+  bochs_thread = NULL; 
+}
+
+// This is called when the simulator needs to ask the user to choose
+// a value or setting.  For example, when the user indicates that he wants
+// to change the floppy disk image for drive A, an ask-param event is created
+// with the parameter id set to BXP_FLOPPYA_PATH.  The simulator blocks until
+// the gui has displayed a dialog and received a selection from the user.
+// In the current implemention, the GUI will look up the parameter's 
+// data structure using SIM->get_param() and then call the set method on the
+// parameter to change the param.  The return value only needs to return
+// success or failure (failure = cancelled, or not implemented).
+// Returns 1 if the user chose a value and the param was modified.
+// Returns 0 if the user cancelled.
+// Returns -1 if the gui doesn't know how to ask for that param.
+int 
+MyFrame::HandleAskParam (BxEvent *event)
+{
+  wxASSERT (event->type == BX_SYNC_EVT_ASK_PARAM);
+  switch (event->u.param.id) {
+  case BXP_FLOPPYA_PATH:
+  case BXP_FLOPPYB_PATH:
+	return HandleVgaGuiButton (event->u.param.id);
+  default:
+	wxLogError ("HandleAskParam: parameter %d, not implemented\n", event->u.param.id);
+  }
+  return -1;  // could not display
+}
+
+void 
+MyFrame::OnBochs2GuiEvent (wxCommandEvent& event)
+{
+  wxLogDebug ("received a bochs event in the GUI thread\n");
+  BxEvent *be = (BxEvent *) event.GetEventObject ();
+  wxLogDebug ("event type = %d\n", (int) be->type);
+  // all cases should return.  sync event handlers MUST send back a 
+  // response.
+  switch (be->type) {
+  case BX_SYNC_EVT_ASK_PARAM:
+    be->retcode = HandleAskParam (be);
+    // sync must return something; just return a copy of the event.
+    bochs_thread->SendSyncResponse(be);
+	return;
+  case BX_ASYNC_EVT_SHUTDOWN_GUI:
+	wxLogDebug ("control panel is exiting\n");
+    Close (TRUE);
+	wxExit ();
+	return;
+  case BX_ASYNC_EVT_LOG_MSG:
+    wxLogDebug ("log msg: level=%d, prefix='%s', msg='%s'\n",
+	  be->u.logmsg.level,
+	  be->u.logmsg.prefix,
+	  be->u.logmsg.msg);
+    return;
+  default:
+    wxLogDebug ("OnBochs2GuiEvent: event type %d ignored\n", (int)be->type);
+	// assume it's a synchronous event and send back a response, to avoid
+	// potential deadlock.
+    bochs_thread->SendSyncResponse(be);
+	return;
+  }
+  // it is critical to send a response back eventually since the Bochs thread
+  // is blocking.
+  wxASSERT_MSG (0, "switch stmt should have returned");
+}
+
+/////////////// bochs thread
+
+void *
+BochsThread::Entry (void)
+{     
+  int argc=1;
+  char *argv[] = {"bochs"};
+  wxLogDebug ("in BochsThread, starting at bx_continue_after_control_panel\n");
+  // run all the rest of the Bochs simulator code.  This function will
+  // run forever, unless a "kill_bochs_request" is issued.  The procedure
+  // is as follows:
+  //   - user selects "Kill Bochs" or GUI decides to kill bochs
+  //   - GUI calls bochs_thread->Delete ()
+  //   - Bochs continues to run until the next time it reaches SIM->periodic().
+  //   - SIM->periodic() sends a synchronous tick event to the GUI, which
+  //     finally calls TestDestroy() and realizes it needs to stop.  It
+  //     sets the sync event return code to -1.  SIM->periodic() sets the
+  //     kill_bochs_request flag in cpu #0.
+  //   - cpu loop notices kill_bochs_request and returns to main.cc:
+  //     bx_continue_after_control_panel(), which notices the
+  //     kill_bochs_request and returns back to this Entry() function.
+  //   - Entry() exits and the thread stops. Whew.
+  bx_continue_after_control_panel (argc, argv);
+  wxLogDebug ("in BochsThread, bx_continue_after_control_panel exited\n");
+  return NULL;
+}
+
+void
+BochsThread::OnExit ()
+{
+  // notify the MyFrame that the bochs thread has died.  I can't adjust
+  // the bochs_thread directly because it's private.
+  frame->OnBochsThreadExit ();
+  // don't use this BochsThread's callback function anymore.
+  SIM->set_notify_callback (NULL, NULL);
+}
+
+// return 1 if the user selected a value.
+// return 0 if the question was displayed and the user cancelled.
+// return -1 if we don't know how to display the question.
+int
+MyFrame::HandleVgaGuiButton (bx_id param)
+{
+  wxLogDebug ("HandleVgaGuiButton: button %d was pressed\n", (int)param);
+  switch (param)
+  {
+	case BXP_FLOPPYA_PATH:
+	case BXP_FLOPPYB_PATH:
+	{
+	  Raise();  // bring the control panel to front so dialog shows
+	  wxFileDialog dialog(this, "Choose new floppy disk image file", "", "", "*.img", 0);
+	  int ret = dialog.ShowModal();
+	  if (ret == wxID_OK)
+	  {
+	    char *newpath = (char *)dialog.GetPath().c_str ();
+	    if (newpath && strlen(newpath)>0) {
+	      // change floppy path to this value.
+	      bx_param_string_c *Opath = SIM->get_param_string (param);
+	      assert (Opath != NULL);
+	      wxLogDebug ("Setting floppy %c path to '%s'\n", 
+		    param == BXP_FLOPPYA_PATH ? 'A' : 'B',
+		    newpath);
+	      Opath->set (newpath);
+	      return 1;
+	    }
+	  }
+	  return 0;
+	}
+	default:
+	  wxLogDebug ("HandleVgaGuiButton: button %d not recognized\n", param);
+	  return -1;
+  }
+}
+
+// This function is declared static so that I can get a usable function
+// pointer for it.  The function pointer is passed to SIM->set_notify_callback
+// so that the siminterface can call this function when it needs to contact
+// the gui.  It will always be called with a pointer to the BochsThread
+// as the first argument.
+BxEvent *
+BochsThread::SiminterfaceCallback (void *thisptr, BxEvent *event)
+{
+  BochsThread *me = (BochsThread *)thisptr;
+  // call the normal non-static method now that we know the this pointer.
+  return me->SiminterfaceCallback2 (event);
+}
+
+// callback function for Bochs-generated events.  This is called from
+// the Bochs thread, not the GUI thread.  So any GUI actions must be
+// done after getting the gui mutex.
+BxEvent *
+BochsThread::SiminterfaceCallback2 (BxEvent *event)
+{
+  //wxLogDebug ("SiminterfaceCallback with event type=%d\n", (int)event->type);
+  event->retcode = 0;  // default return code
+  int async = 1;
+  switch (event->type)
+  {
+  case BX_SYNC_EVT_ASK_PARAM:
+  case BX_SYNC_EVT_TICK:
+    ClearSyncResponse ();  // must be before postevent.
+    async = 0;
+	break;
+  }
+
+  // tick event must be handled right here in the bochs thread.
+  if (event->type == BX_SYNC_EVT_TICK) {
+	if (TestDestroy ()) {
+	  // tell simulator to quit
+	  event->retcode = -1;
+	}
+	return event;
+  }
+
+  //encapsulate the bxevent in a wxwindows event
+  wxCommandEvent wxevent (wxEVT_COMMAND_MENU_SELECTED, ID_Bochs2Gui_Event);
+  wxevent.SetEventObject ((wxEvent *)event);
+  wxLogDebug ("Sending an event to the window\n");
+  wxPostEvent (frame, wxevent);
+  // if it is an asynchronous event, return immediately
+  if (async) return NULL;
+  wxLogDebug ("SiminterfaceCallback2: synchronous event; waiting for response\n");
+  // now wait forever for the GUI to post a response.
+  BxEvent *response = NULL;
+  while (response == NULL) {
+	response = GetSyncResponse ();
+	if (!response) {
+	  wxLogDebug ("no sync response yet, waiting\n");
+	  this->Sleep(500);
+	}
+  }
+  wxASSERT (response != NULL);
+  return response;
+}
+
+void 
+BochsThread::ClearSyncResponse ()
+{
+  wxCriticalSectionLocker lock(bochs2gui_mailbox_lock);
+  if (bochs2gui_mailbox != NULL) {
+    wxLogDebug ("WARNING: ClearSyncResponse is throwing away an event that was previously in the mailbox\n");
+  }
+  bochs2gui_mailbox = NULL;
+}
+
+void 
+BochsThread::SendSyncResponse (BxEvent *event)
+{
+  wxCriticalSectionLocker lock(bochs2gui_mailbox_lock);
+  if (bochs2gui_mailbox != NULL) {
+    wxLogDebug ("WARNING: SendSyncResponse is throwing away an event that was previously in the mailbox\n");
+  }
+  bochs2gui_mailbox = event;
+}
+
+BxEvent *
+BochsThread::GetSyncResponse ()
+{
+  wxCriticalSectionLocker lock(bochs2gui_mailbox_lock);
+  BxEvent *event = bochs2gui_mailbox;
+  bochs2gui_mailbox = NULL;
+  return event;
+}
diff -urN -x *CVS* -x *patches* clean-1.4.pre2/wxthreadtest.cc wxclean/wxthreadtest.cc
--- clean-1.4.pre2/wxthreadtest.cc	Wed Dec 31 19:00:00 1969
+++ wxclean/wxthreadtest.cc	Sat Mar 16 09:19:36 2002
@@ -0,0 +1,481 @@
+//
+// wxthreadtest.cc
+// Bryce Denney
+//
+// Compile with:
+//   c++ -g `wx-config --cxxflags --libs` threadtest.cc -o threadtest
+//
+// I have been using this file to learn how to use wxwindows threads safely
+// and test out new ideas in a controlled environment.  The most important
+// realization I made while writing this code is that when a detachable thread
+// is dying, you should use its OnExit method to make the thread remove itself
+// from the list of valid threads.  And manage the list of valid threads with a
+// critical section.  Now it doesn't crash anymore!
+//
+// There is one example where the non-gui threads that I start pass a
+// user-defined event into the GUI event queue.  This represents the
+// Bochs thread sending an asynchronous message to the GUI.  To support
+// synchronous messages from Bochs to the gui, I would need to send an async
+// message and then wait until a response arrives.
+//
+// The event queue of the Bochs thread is something we must create.  It will
+// look like a linked list of bochs events.  The gui thread appends things to
+// the end of the queue and Bochs takes things from the front of the queue.  In
+// the case of a synchronous message from Bochs to the gui, Bochs must wait
+// around for the response.  It cannot respond to async messages while waiting;
+// it must simply block until the synchronous response arrives.  To support
+// this, I will set aside a "mailbox" for synchronous responses.  When Bochs
+// sends the synch request, it is sure to clear the synchronous response
+// mailbox.  When the GUI is ready to respond, it places a pointer to the
+// response event into the mailbox.  The Bochs thread finds the response and
+// continues.  Async events can continue to build up in the meantime, and they
+// will be kept in order relative to each other.
+//
+// I'm not sure if this will be needed, but it may be useful to have a
+// high priority queue for things like starting and stopping simulation.
+// If there are 200 mouse events in the async queue and you press a stop
+// button, this would allow bochs to stop and either clear the async queue
+// or save them for later.
+//
+// I will use wxList for the event queue.
+//
+// Well, it's a little tricky.  I want Bochs to continue to compile without
+// wxwindows, and I hope to keep the text mode interface supported.  Will it
+// compromise portability to use a wxwindows container class for the wxwindows
+// event queue?  All the wxwindows code will be in siminterface.cc inside an
+// #if BX_USE_WX.  For text mode interface, we must provide equivalent event
+// passing, but that interface is a whole lot simpler because it doesn't
+// produce async events.  I'm sure I can get it to work.  The fact that all
+// events are passing through a few specific functions makes the porting much
+// more practical.  That was the point after all.
+//
+
+// For compilers that support precompilation, includes "wx/wx.h".
+#include "wx/wxprec.h"
+#ifdef __BORLANDC__
+#pragma hdrstop
+#endif
+#ifndef WX_PRECOMP
+#include "wx/wx.h"
+#endif
+
+class MyApp: public wxApp
+{
+virtual bool OnInit();
+};
+
+class BochsThread: public wxThread
+{
+public:
+  virtual ExitCode Entry ();
+  void call_exit () { Exit (); }
+};
+
+class thread2 : public wxThread
+{
+  int id;
+  int my_alive;
+public:
+  virtual ExitCode Entry ();
+  void OnExit ();
+};
+
+
+class MyFrame: public wxFrame
+{
+public:
+MyFrame(const wxString& title, const wxPoint& pos, const wxSize&
+size);
+void OnQuit(wxCommandEvent& event);
+void OnAbout(wxCommandEvent& event);
+//void OnStartBochs(wxCommandEvent& event);
+void OnTestTask(wxCommandEvent& event);
+void OnPause(wxCommandEvent& event);
+void OnResume(wxCommandEvent& event);
+void OnDelete(wxCommandEvent& event);
+void OnDeleteAll(wxCommandEvent& event);
+void OnUserEvent(wxCommandEvent& event);
+//int StartBochsThread ();
+//int HandleVgaGuiButton (int which);
+private:
+BochsThread *bochs_thread;
+wxStaticText *text1, *text2;
+
+DECLARE_EVENT_TABLE()
+static int SiminterfaceCallback (void *thisptr, int code);
+int SiminterfaceCallback2 (int code);
+
+int event_count;
+
+public:
+wxCriticalSection thread_list_lock;
+// test_thread and next_test_thread are protected by the thread_list_lock
+// critical section.
+#define MAX_TEST_THREADS 128
+thread2 *test_thread[MAX_TEST_THREADS];
+int next_test_thread;
+
+};
+
+enum
+{
+ID_Quit = 1,
+ID_About,
+ID_TestTask,
+ID_Pause,
+ID_Resume,
+ID_Delete,
+ID_DeleteAll,
+ID_UserEvent,
+};
+
+BEGIN_EVENT_TABLE(MyFrame, wxFrame)
+  EVT_MENU(ID_Quit, MyFrame::OnQuit)
+  EVT_MENU(ID_About, MyFrame::OnAbout)
+  EVT_MENU(ID_TestTask, MyFrame::OnTestTask)
+  EVT_MENU(ID_Pause, MyFrame::OnPause)
+  EVT_MENU(ID_Resume, MyFrame::OnResume)
+  EVT_MENU(ID_Delete, MyFrame::OnDelete)
+  EVT_MENU(ID_DeleteAll, MyFrame::OnDeleteAll)
+  // I just made this up.  I'll try to get the other threads to send
+  // user events to the MyFrame and hopefully they will call up
+  // the OnUserEvent() method.  We'll see.
+  EVT_MENU(ID_UserEvent, MyFrame::OnUserEvent)
+END_EVENT_TABLE()
+
+IMPLEMENT_APP(MyApp)
+
+static MyFrame *theFrame = NULL;
+
+bool MyApp::OnInit()
+{
+    //siminterface_init ();
+theFrame = new MyFrame( "Bochs Control Panel", wxPoint(50,50),
+wxSize(450,340) );
+theFrame->Show( TRUE );
+SetTopWindow( theFrame );
+return TRUE;
+}
+
+MyFrame::MyFrame(const wxString& title, const wxPoint& pos, const
+wxSize& size)
+: wxFrame((wxFrame *)NULL, -1, title, pos, size)
+{
+  // init variables
+  bochs_thread = NULL;
+  next_test_thread = 0;
+  // don't bother with crit section
+  for (int i=0; i<MAX_TEST_THREADS; i++) 
+	test_thread[i] = NULL;
+  event_count = 0;
+
+  // set up the gui
+  wxMenu *menuFile = new wxMenu;
+  menuFile->Append( ID_TestTask, "&Start a thread" );
+  menuFile->Append( ID_Pause, "&Pause thread" );
+  menuFile->Append( ID_Resume, "&Resume thread" );
+  menuFile->Append( ID_Delete, "&Delete thread" );
+  menuFile->Append( ID_DeleteAll, "&Delete all threads" );
+  menuFile->Append( ID_About, "&About..." );
+  menuFile->AppendSeparator();
+  menuFile->Append( ID_Quit, "E&xit" );
+  wxMenuBar *menuBar = new wxMenuBar;
+  menuBar->Append( menuFile, "&File" );
+  SetMenuBar( menuBar );
+  CreateStatusBar();
+  SetStatusText( "Welcome to wxWindows!" );
+  // try to create some static text labels
+  text1 = new wxStaticText (this, -1, "Text#1");
+  text2 = new wxStaticText (this, -1, "Text#2");
+  text2->SetBackgroundColour (wxColour (255, 0, 0));
+  text2->Clear ();
+  wxGridSizer *sz = new wxGridSizer (1, 2);
+  sz->Add (text1, 0, wxALIGN_CENTER);
+  sz->Add (text2, 0, wxALIGN_CENTER );
+  SetAutoLayout (TRUE);  // required or sizer does nothing
+  SetSizer (sz);
+}
+
+void MyFrame::OnQuit(wxCommandEvent& WXUNUSED(event))
+{
+  Close( TRUE );
+}
+
+void MyFrame::OnAbout(wxCommandEvent& WXUNUSED(event))
+{
+wxMessageBox( "wxWindows Control Panel for Bochs. (Very Experimental)",
+"Bochs Control Panel", wxOK | wxICON_INFORMATION );
+}
+
+#if 0
+void MyFrame::OnStartBochs(wxCommandEvent& WXUNUSED(event))
+{
+  //StartBochsThread ();
+}
+#endif
+
+/////////////// bochs thread
+
+#if 0
+void *
+BochsThread::Entry (void)
+{     
+  int argc=1;
+  char *argv[] = {"bochs"};
+  printf ("in BochsThread, starting at bx_continue_after_control_panel\n");
+  bx_continue_after_control_panel (argc, argv);
+  printf ("in BochsThread, bx_continue_after_control_panel exited\n");
+  return NULL;
+}   
+
+int MyFrame::StartBochsThread ()
+{
+    if (bochs_thread != NULL) {
+    wxMessageBox (
+    "Can't start Bochs simulator, because it is already running",
+    "Already Running", wxOK | wxICON_ERROR);
+    return -1;
+    }
+    printf ("Starting bochs thread now\n");
+    bochs_thread = new BochsThread ();
+    bochs_thread->Create ();
+    bochs_thread->Run ();                                                        
+    printf ("Bochs thread has started.\n");
+    return 0;
+}
+
+int
+MyFrame::HandleVgaGuiButton (int which)
+{
+  printf ("HandleVgaGuiButton: button %d was pressed\n", which);
+  switch (which)
+  {
+    case GUI_BUTTON_FLOPPYA:
+    {
+      wxMutexGuiEnter ();
+      Raise();  // bring the control panel to front so dialog shows
+      wxFileDialog dialog(this, "Choose new floppy disk image file", "", "", "*.img", 0);
+      int ret = dialog.ShowModal();
+      wxMutexGuiLeave ();
+      if (ret == wxID_OK)
+      {
+        char *newpath = (char *)dialog.GetPath().c_str ();
+        if (newpath && strlen(newpath)>0) {
+          // change floppy A path to this value.
+          bx_param_string_c *Opath = SIM->get_param_string (BXP_FLOPPYA_PATH);
+          assert (Opath != NULL);
+          printf ("Setting floppy A path to '%s'\n", newpath);
+          Opath->set (newpath);
+          return 1;
+        }
+      }
+      return 0;
+    }
+    case GUI_BUTTON_FLOPPYB:
+    {
+      wxMutexGuiEnter ();
+      Raise();  // bring the control panel to front so dialog shows
+      wxFileDialog dialog(this, "Choose new floppy disk image file", "", "", "*.img", 0);
+      int ret = dialog.ShowModal ();
+      wxMutexGuiLeave ();
+      if (ret == wxID_OK)
+      {
+        char *newpath = (char *)dialog.GetPath().c_str ();
+        if (newpath && strlen(newpath)>0) {
+          // change floppy A path to this value.
+          bx_param_string_c *Opath = SIM->get_param_string (BXP_FLOPPYB_PATH);
+          assert (Opath != NULL);
+          printf ("Setting floppy B path to '%s'\n", newpath);
+          Opath->set (newpath);
+          return 1;
+        }
+      }
+      return 0;
+    }
+  }
+  return 0;
+}
+
+int
+MyFrame::SiminterfaceCallback (void *thisptr, int code)
+{
+  assert (thisptr == theFrame);
+  int ret = theFrame->SiminterfaceCallback2 (code);
+  SIM->notify_return (ret);
+  return 0;
+}
+
+int
+MyFrame::SiminterfaceCallback2 (int code)
+{
+  printf ("SiminterfaceCallback with code=%d\n", code);
+  switch (code)
+  {
+  case NOTIFY_CODE_LOGMSG:
+    printf ("logmsg callback");
+    break;
+  case NOTIFY_CODE_VGA_GUI_BUTTON:
+    {
+      printf ("vga button pressed");
+      int which = SIM->notify_get_int_arg (0);
+      return HandleVgaGuiButton (which);
+    }
+    break;
+  case NOTIFY_CODE_SHUTDOWN:
+    {
+      // assume bochs has already had its change to shut down.
+      // this will just shut down the gui.
+      printf ("control panel is exiting\n");
+      wxMutexGuiEnter ();
+      Destroy ();
+	  if (bochs_thread) {
+		// the callbacks are call from the simulator thread, so it is
+		// safe to call wxThread::Exit from right here.
+		bochs_thread->call_exit ();
+	  }
+      wxMutexGuiLeave ();
+    }
+  }
+  return 0;
+}
+#endif
+
+/////////////////////////////
+
+static int next_id = 0;
+void *
+thread2::Entry ()
+{
+  int i;
+  my_alive = 1;
+  id = next_id++;
+  wxASSERT_MSG (id < MAX_TEST_THREADS, "id < MAX_TEST_THREADS");
+  printf ("thread%d: starting test task\n", id);
+  for (i=0; i<3; i++) {
+	if (TestDestroy ()) {
+	  // if true, exit as soon as possible
+	  printf ("thread%d: I was deleted\n", id);
+	  break;
+	}
+	printf ("thread%d: count is %d\n", id, i);
+	// make a UserEvent and send it to the gui thread.
+	wxCommandEvent event (wxEVT_COMMAND_MENU_SELECTED, ID_UserEvent);
+	printf ("Posting event to MyFrame\n");
+	wxPostEvent (theFrame, event);
+	this->Sleep (1000);  // 1 second
+  }
+  my_alive = 0;
+  printf ("thread%d: goodbye\n", id);
+  return NULL;
+}
+
+void
+thread2::OnExit ()
+{
+  printf ("thread%d: OnExit\n", id);
+  // find myself in the thread list and change the pointer to a NULL
+  wxCriticalSectionLocker lock (theFrame->thread_list_lock);
+  for (int i=0; i<MAX_TEST_THREADS; i++)
+  {
+    if (theFrame->test_thread[i] == this)
+      theFrame->test_thread[i] = NULL;
+  }
+}
+
+void MyFrame::OnTestTask (wxCommandEvent& WXUNUSED(event))
+{
+  printf ("OnTestTask\n");
+  thread2 *thread = new thread2 ();
+  thread->Create ();
+  thread->Run ();
+  {
+    // add the thread to the list
+    wxCriticalSectionLocker lock (thread_list_lock);
+    int n = next_test_thread;
+    next_test_thread = (next_test_thread+1) % MAX_TEST_THREADS;
+    test_thread[n] = thread;
+  }
+}
+
+void MyFrame::OnResume (wxCommandEvent& WXUNUSED(event))
+{
+  printf ("OnResume()\n");
+  // find one that is paused and resume it
+  wxCriticalSectionLocker lock (thread_list_lock);
+  for (int i=MAX_TEST_THREADS-1; i>=0; i--) {
+	if (!test_thread[i]) continue;
+	if (test_thread[i]->IsAlive () && test_thread[i]->IsPaused ()) {
+	  thread2 *thread;
+	  printf ("resuming thread %d\n", i);
+	  test_thread[i]->Resume ();
+	  return;
+	}
+  }
+  printf ("no threads were paused\n");
+}
+
+void MyFrame::OnPause (wxCommandEvent& WXUNUSED(event))
+{
+  printf ("OnPause()\n");
+  // find a running thread thread and pause
+  wxCriticalSectionLocker lock (thread_list_lock);
+  for (int i=MAX_TEST_THREADS-1; i>=0; i--) {
+	if (!test_thread[i]) continue;
+	if (test_thread[i]->IsAlive () && !test_thread[i]->IsPaused ()) {
+	  printf ("pausing thread %d\n", i);
+	  test_thread[i]->Pause ();
+	  return;
+	}
+  }
+  printf ("no threads to pause\n");
+}
+
+void MyFrame::OnDelete (wxCommandEvent& WXUNUSED(event))
+{
+  printf ("OnDelete()\n");
+  // find a live thread and delete it
+  thread_list_lock.Enter ();
+  for (int i=MAX_TEST_THREADS-1; i>=0; i--) {
+    if (!test_thread[i]) continue;
+    if (test_thread[i]->IsAlive ()) {
+      printf ("deleting thread %d\n", i);
+      wxThread *thread = test_thread[i];
+      thread_list_lock.Leave ();
+      // is seems possible for a thread to finish, remove itself
+      // from the list, etc. between exiting the critical section
+      // and the delete.  Then thread would point to a nonexistent
+      // object.  OTOH, this method is copied right out of the sample
+      // thread code so it's probably reasonable safe.
+      thread->Delete ();
+      return;
+    }
+  }
+  thread_list_lock.Leave ();
+  printf ("no threads to delete\n");
+}
+
+void MyFrame::OnDeleteAll (wxCommandEvent& WXUNUSED(event))
+{
+  printf ("OnDeleteAll()\n");
+#if 0
+  // delete all test threads
+  for (int i=MAX_TEST_THREADS-1; i>=0; i--) {
+	if (!test_thread[i]) continue;
+	if (test_thread[i]->IsAlive ()) {
+	  printf ("deleting thread %d\n", i);
+	  test_thread[i]->Delete ();
+	}
+  }
+#endif
+  printf ("no threads to pause\n");
+}
+
+void MyFrame::OnUserEvent (wxCommandEvent& WXUNUSED(event))
+{
+  wxASSERT_MSG (wxThread::IsMain (), "UserEvent handler called by non-gui thread");
+  printf ("user event\n");
+  event_count++;
+  wxString newtext;
+  newtext.Printf ("Event count is now %d", event_count);
+  text1->SetLabel (newtext);
+}
