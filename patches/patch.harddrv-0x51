From bochs@sigint.cs.purdue.edu Fri Jun 22 00:00:49 2001
Date: Thu, 21 Jun 2001 21:58:41 -0500
From: bochs@sigint.cs.purdue.edu
To: bochs-developers@lists.sourceforge.net
Subject: [Bochs-developers] harddrv.cc patch for Linux compat

The Linux 2.4.5 CD-ROM driver sends a READ_DISC_INFO command which caused
an "unrecognized ATAPI command" panic.  Looks like READ_DISC_INFO is only
recognized by CD-R and CD-RW drives, so I ignore it for now.  (I don't
know if ASC_INV_FIELD_IN_CMD_PACKET is the right code, but it shouldn't
matter to Linux anyway.)


*** harddrv.cc.orig	Thu Jun 21 09:58:14 2001
--- harddrv.cc	Thu Jun 21 19:33:30 2001
***************
*** 1198,1203 ****
--- 1198,1210 ----
  					  init_send_atapi_command(atapi_command, ret_len, alloc_length);
  					  ready_to_send_atapi();
  				    }
+ 			      }
+ 			      break;
+ 
+ 			      case 0x51: { // read disc info
+                                 // no-op to keep the Linux CD-ROM driver happy
+ 			        atapi_cmd_error(SENSE_ILLEGAL_REQUEST, ASC_INV_FIELD_IN_CMD_PACKET);
+ 			        raise_interrupt();
  			      }
  			      break;
  

_______________________________________________
bochs-developers mailing list
bochs-developers@lists.sourceforge.net
http://lists.sourceforge.net/lists/listinfo/bochs-developers
