# Copyright (C) 2001  MandrakeSoft S.A.
#
#   MandrakeSoft S.A.
#   43, rue d'Aboukir
#   75002 Paris - France
#   http://www.linux-mandrake.com/
#   http://www.mandrakesoft.com/
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA

@SUFFIX_LINE@

srcdir = @srcdir@
VPATH = @srcdir@
top_builddir    = ..
top_srcdir      = @top_srcdir@

SHELL = /bin/sh

@SET_MAKE@

CC       = @CC@
CFLAGS   = @CFLAGS@ @GUI_CFLAGS@
CXX      = @CXX@
CXXFLAGS = @CXXFLAGS@ @GUI_CXXFLAGS@

#CFLAGS  = -Wall -Wstrict-prototypes -fomit-frame-pointer -fno-strict-aliasing -pipe -fno-strength-reduce -mpreferred-stack-boundary=2 -DCPU=686 -march=i686

LDFLAGS    = @LDFLAGS@
LIBS       = @LIBS@
X_LIBS     = @X_LIBS@
X_PRE_LIBS = @X_PRE_LIBS@
RANLIB     = @RANLIB@

#DEBUG	 = -DDEBUGGING
PARANOID = -DPARANOID

L_TARGET = libfpu.a


BX_INCDIRS = -I.. -I$(srcdir)/.. -I../@INSTRUMENT_DIR@ -I$(srcdir)/../@INSTRUMENT_DIR@ -I. -I$(srcdir)/. -I./stubs -I$(srcdir)/./stubs

FPU_FLAGS = -DUSE_WITH_CPU_SIM $(PARANOID) $(DEBUG)
FPU_GLUE_OBJ = wmFPUemu_glue.o fpu.o fpu_arith.o fpu_compare.o \
               fpu_const.o fpu_load_store.o fpu_misc.o fpu_trans.o \
               fprem.o softfloat.o softfloatx80.o softfloat-round-pack.o

# From 'C' language sources:
C_OBJS = errors.o fpu_tags.o fpu_trig.o \
	poly_atan.o poly_l2.o poly_2xm1.o poly_sin.o poly_tan.o \
	reg_add_sub.o reg_constant.o reg_convert.o \
	reg_mul.o reg_u_add.o \
        reg_u_div.o reg_u_mul.o reg_u_sub.o reg_norm.o reg_round.o \
	wm_shrx.o div_Xsig.o polynom_Xsig.o round_Xsig.o \
	shr_Xsig.o mul_Xsig.o

L_OBJS = $(C_OBJS)

OBJS = \
	@FPU_GLUE_OBJ@ \
	$(L_OBJS)


BX_INCLUDES = ../bochs.h ../config.h

all: libfpu.a

.@CPP_SUFFIX@.o:
	$(CXX) @DASH@c $(BX_INCDIRS) $(CXXFLAGS) $(FPU_FLAGS) @CXXFP@$< @OFP@$@

.c.o:
	$(CC) @DASH@c $(CFLAGS) $(FPU_FLAGS) $(BX_INCDIRS) $< @OFP@$@


libfpu.a: $(OBJS)
	@RMCOMMAND@ libfpu.a
	@MAKELIB@ $(OBJS)
	$(RANLIB) libfpu.a

$(OBJS): $(BX_INCLUDES)

clean:
	@RMCOMMAND@ *.o
	@RMCOMMAND@ *.a

dist-clean: clean
	@RMCOMMAND@ Makefile

###########################################
# dependencies generated by
#  gcc -MM -I. -I.. -I../instrument/stubs -Istubs *.c  *.cc | sed 's/\.cc/.@CPP_SUFFIX@/g'
###########################################
div_Xsig.o: div_Xsig.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h poly.h
errors.o: errors.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h exception.h status_w.h \
  control_w.h reg_constant.h
fpu_tags.o: fpu_tags.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h exception.h
fpu_trig.o: fpu_trig.c fpu_system.h ../config.h ../cpu/i387.h \
  ../fpu/tag_w.h exception.h fpu_emu.h linkage.h fpu_proto.h status_w.h \
  control_w.h reg_constant.h
mul_Xsig.o: mul_Xsig.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h poly.h
poly_2xm1.o: poly_2xm1.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h reg_constant.h \
  control_w.h poly.h
poly_atan.o: poly_atan.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h reg_constant.h \
  status_w.h control_w.h poly.h
poly_l2.o: poly_l2.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h reg_constant.h \
  control_w.h poly.h
poly_sin.o: poly_sin.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h reg_constant.h \
  control_w.h poly.h
poly_tan.o: poly_tan.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h reg_constant.h \
  control_w.h poly.h
polynom_Xsig.o: polynom_Xsig.c fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h poly.h
reg_add_sub.o: reg_add_sub.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h reg_constant.h \
  control_w.h
reg_constant.o: reg_constant.c fpu_system.h ../config.h ../cpu/i387.h \
  ../fpu/tag_w.h fpu_emu.h linkage.h fpu_proto.h status_w.h \
  reg_constant.h control_w.h
reg_convert.o: reg_convert.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h
reg_mul.o: reg_mul.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h exception.h reg_constant.h
reg_norm.o: reg_norm.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h
reg_round.o: reg_round.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h status_w.h exception.h \
  control_w.h
reg_u_add.o: reg_u_add.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h control_w.h
reg_u_div.o: reg_u_div.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h control_w.h
reg_u_mul.o: reg_u_mul.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h control_w.h
reg_u_sub.o: reg_u_sub.c exception.h fpu_emu.h linkage.h fpu_system.h \
  ../config.h ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h control_w.h
round_Xsig.o: round_Xsig.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h poly.h
shr_Xsig.o: shr_Xsig.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h poly.h
wm_shrx.o: wm_shrx.c fpu_emu.h linkage.h fpu_system.h ../config.h \
  ../cpu/i387.h ../fpu/tag_w.h fpu_proto.h
fpu.o: fpu.@CPP_SUFFIX@ ../bochs.h ../config.h ../osdep.h ../bx_debug/debug.h \
  ../bxversion.h ../gui/siminterface.h ../state_file.h ../cpu/cpu.h \
  ../cpu/lazy_flags.h ../cpu/hostasm.h ../cpu/apic.h ../fpu/softfloat.h \
  ../cpu/i387.h ../fpu/tag_w.h ../cpu/xmm.h ../disasm/disasm.h \
  ../memory/memory.h ../pc_system.h ../plugin.h ../extplugin.h \
  ../gui/gui.h ../gui/textconfig.h ../gui/keymap.h ../iodev/iodev.h \
  ../iodev/pci.h ../iodev/pci2isa.h ../iodev/pcivga.h ../iodev/vga.h \
  ../iodev/ioapic.h ../iodev/biosdev.h ../iodev/cmos.h ../iodev/dma.h \
  ../iodev/floppy.h ../iodev/harddrv.h ../iodev/cdrom.h \
  ../iodev/vmware3.h ../iodev/keyboard.h ../iodev/parallel.h \
  ../iodev/pic.h ../iodev/pit.h ../iodev/pit_wrap.h ../iodev/pit82c54.h \
  ../iodev/virt_timer.h ../iodev/serial.h ../iodev/unmapped.h \
  ../iodev/eth.h ../iodev/ne2k.h ../iodev/guest2host.h \
  ../iodev/slowdown_timer.h ../iodev/extfpuirq.h ../iodev/gameport.h \
  ../iodev/speaker.h ../instrument/stubs/instrument.h
fpu_arith.o: fpu_arith.@CPP_SUFFIX@ ../bochs.h ../config.h ../osdep.h \
  ../bx_debug/debug.h ../bxversion.h ../gui/siminterface.h \
  ../state_file.h ../cpu/cpu.h ../cpu/lazy_flags.h ../cpu/hostasm.h \
  ../cpu/apic.h ../fpu/softfloat.h ../cpu/i387.h ../fpu/tag_w.h \
  ../cpu/xmm.h ../disasm/disasm.h ../memory/memory.h ../pc_system.h \
  ../plugin.h ../extplugin.h ../gui/gui.h ../gui/textconfig.h \
  ../gui/keymap.h ../iodev/iodev.h ../iodev/pci.h ../iodev/pci2isa.h \
  ../iodev/pcivga.h ../iodev/vga.h ../iodev/ioapic.h ../iodev/biosdev.h \
  ../iodev/cmos.h ../iodev/dma.h ../iodev/floppy.h ../iodev/harddrv.h \
  ../iodev/cdrom.h ../iodev/vmware3.h ../iodev/keyboard.h \
  ../iodev/parallel.h ../iodev/pic.h ../iodev/pit.h ../iodev/pit_wrap.h \
  ../iodev/pit82c54.h ../iodev/virt_timer.h ../iodev/serial.h \
  ../iodev/unmapped.h ../iodev/eth.h ../iodev/ne2k.h \
  ../iodev/guest2host.h ../iodev/slowdown_timer.h ../iodev/extfpuirq.h \
  ../iodev/gameport.h ../iodev/speaker.h ../instrument/stubs/instrument.h \
  softfloat-specialize.h
fpu_compare.o: fpu_compare.@CPP_SUFFIX@ ../bochs.h ../config.h ../osdep.h \
  ../bx_debug/debug.h ../bxversion.h ../gui/siminterface.h \
  ../state_file.h ../cpu/cpu.h ../cpu/lazy_flags.h ../cpu/hostasm.h \
  ../cpu/apic.h ../fpu/softfloat.h ../cpu/i387.h ../fpu/tag_w.h \
  ../cpu/xmm.h ../disasm/disasm.h ../memory/memory.h ../pc_system.h \
  ../plugin.h ../extplugin.h ../gui/gui.h ../gui/textconfig.h \
  ../gui/keymap.h ../iodev/iodev.h ../iodev/pci.h ../iodev/pci2isa.h \
  ../iodev/pcivga.h ../iodev/vga.h ../iodev/ioapic.h ../iodev/biosdev.h \
  ../iodev/cmos.h ../iodev/dma.h ../iodev/floppy.h ../iodev/harddrv.h \
  ../iodev/cdrom.h ../iodev/vmware3.h ../iodev/keyboard.h \
  ../iodev/parallel.h ../iodev/pic.h ../iodev/pit.h ../iodev/pit_wrap.h \
  ../iodev/pit82c54.h ../iodev/virt_timer.h ../iodev/serial.h \
  ../iodev/unmapped.h ../iodev/eth.h ../iodev/ne2k.h \
  ../iodev/guest2host.h ../iodev/slowdown_timer.h ../iodev/extfpuirq.h \
  ../iodev/gameport.h ../iodev/speaker.h ../instrument/stubs/instrument.h \
  softfloat-specialize.h
fpu_const.o: fpu_const.@CPP_SUFFIX@ ../bochs.h ../config.h ../osdep.h \
  ../bx_debug/debug.h ../bxversion.h ../gui/siminterface.h \
  ../state_file.h ../cpu/cpu.h ../cpu/lazy_flags.h ../cpu/hostasm.h \
  ../cpu/apic.h ../fpu/softfloat.h ../cpu/i387.h ../fpu/tag_w.h \
  ../cpu/xmm.h ../disasm/disasm.h ../memory/memory.h ../pc_system.h \
  ../plugin.h ../extplugin.h ../gui/gui.h ../gui/textconfig.h \
  ../gui/keymap.h ../iodev/iodev.h ../iodev/pci.h ../iodev/pci2isa.h \
  ../iodev/pcivga.h ../iodev/vga.h ../iodev/ioapic.h ../iodev/biosdev.h \
  ../iodev/cmos.h ../iodev/dma.h ../iodev/floppy.h ../iodev/harddrv.h \
  ../iodev/cdrom.h ../iodev/vmware3.h ../iodev/keyboard.h \
  ../iodev/parallel.h ../iodev/pic.h ../iodev/pit.h ../iodev/pit_wrap.h \
  ../iodev/pit82c54.h ../iodev/virt_timer.h ../iodev/serial.h \
  ../iodev/unmapped.h ../iodev/eth.h ../iodev/ne2k.h \
  ../iodev/guest2host.h ../iodev/slowdown_timer.h ../iodev/extfpuirq.h \
  ../iodev/gameport.h ../iodev/speaker.h ../instrument/stubs/instrument.h \
  softfloat-specialize.h
fpu_load_store.o: fpu_load_store.@CPP_SUFFIX@ ../bochs.h ../config.h ../osdep.h \
  ../bx_debug/debug.h ../bxversion.h ../gui/siminterface.h \
  ../state_file.h ../cpu/cpu.h ../cpu/lazy_flags.h ../cpu/hostasm.h \
  ../cpu/apic.h ../fpu/softfloat.h ../cpu/i387.h ../fpu/tag_w.h \
  ../cpu/xmm.h ../disasm/disasm.h ../memory/memory.h ../pc_system.h \
  ../plugin.h ../extplugin.h ../gui/gui.h ../gui/textconfig.h \
  ../gui/keymap.h ../iodev/iodev.h ../iodev/pci.h ../iodev/pci2isa.h \
  ../iodev/pcivga.h ../iodev/vga.h ../iodev/ioapic.h ../iodev/biosdev.h \
  ../iodev/cmos.h ../iodev/dma.h ../iodev/floppy.h ../iodev/harddrv.h \
  ../iodev/cdrom.h ../iodev/vmware3.h ../iodev/keyboard.h \
  ../iodev/parallel.h ../iodev/pic.h ../iodev/pit.h ../iodev/pit_wrap.h \
  ../iodev/pit82c54.h ../iodev/virt_timer.h ../iodev/serial.h \
  ../iodev/unmapped.h ../iodev/eth.h ../iodev/ne2k.h \
  ../iodev/guest2host.h ../iodev/slowdown_timer.h ../iodev/extfpuirq.h \
  ../iodev/gameport.h ../iodev/speaker.h ../instrument/stubs/instrument.h \
  softfloatx80.h softfloat.h softfloat-specialize.h
fpu_misc.o: fpu_misc.@CPP_SUFFIX@ ../bochs.h ../config.h ../osdep.h \
  ../bx_debug/debug.h ../bxversion.h ../gui/siminterface.h \
  ../state_file.h ../cpu/cpu.h ../cpu/lazy_flags.h ../cpu/hostasm.h \
  ../cpu/apic.h ../fpu/softfloat.h ../cpu/i387.h ../fpu/tag_w.h \
  ../cpu/xmm.h ../disasm/disasm.h ../memory/memory.h ../pc_system.h \
  ../plugin.h ../extplugin.h ../gui/gui.h ../gui/textconfig.h \
  ../gui/keymap.h ../iodev/iodev.h ../iodev/pci.h ../iodev/pci2isa.h \
  ../iodev/pcivga.h ../iodev/vga.h ../iodev/ioapic.h ../iodev/biosdev.h \
  ../iodev/cmos.h ../iodev/dma.h ../iodev/floppy.h ../iodev/harddrv.h \
  ../iodev/cdrom.h ../iodev/vmware3.h ../iodev/keyboard.h \
  ../iodev/parallel.h ../iodev/pic.h ../iodev/pit.h ../iodev/pit_wrap.h \
  ../iodev/pit82c54.h ../iodev/virt_timer.h ../iodev/serial.h \
  ../iodev/unmapped.h ../iodev/eth.h ../iodev/ne2k.h \
  ../iodev/guest2host.h ../iodev/slowdown_timer.h ../iodev/extfpuirq.h \
  ../iodev/gameport.h ../iodev/speaker.h ../instrument/stubs/instrument.h \
  softfloatx80.h softfloat.h softfloat-specialize.h
fpu_trans.o: fpu_trans.@CPP_SUFFIX@ ../bochs.h ../config.h ../osdep.h \
  ../bx_debug/debug.h ../bxversion.h ../gui/siminterface.h \
  ../state_file.h ../cpu/cpu.h ../cpu/lazy_flags.h ../cpu/hostasm.h \
  ../cpu/apic.h ../fpu/softfloat.h ../cpu/i387.h ../fpu/tag_w.h \
  ../cpu/xmm.h ../disasm/disasm.h ../memory/memory.h ../pc_system.h \
  ../plugin.h ../extplugin.h ../gui/gui.h ../gui/textconfig.h \
  ../gui/keymap.h ../iodev/iodev.h ../iodev/pci.h ../iodev/pci2isa.h \
  ../iodev/pcivga.h ../iodev/vga.h ../iodev/ioapic.h ../iodev/biosdev.h \
  ../iodev/cmos.h ../iodev/dma.h ../iodev/floppy.h ../iodev/harddrv.h \
  ../iodev/cdrom.h ../iodev/vmware3.h ../iodev/keyboard.h \
  ../iodev/parallel.h ../iodev/pic.h ../iodev/pit.h ../iodev/pit_wrap.h \
  ../iodev/pit82c54.h ../iodev/virt_timer.h ../iodev/serial.h \
  ../iodev/unmapped.h ../iodev/eth.h ../iodev/ne2k.h \
  ../iodev/guest2host.h ../iodev/slowdown_timer.h ../iodev/extfpuirq.h \
  ../iodev/gameport.h ../iodev/speaker.h ../instrument/stubs/instrument.h
fprem.o: fprem.@CPP_SUFFIX@ softfloat.h ../config.h \
  softfloat-round-pack.h softfloat-macros.h softfloat-specialize.h
softfloat-round-pack.o: softfloat-round-pack.@CPP_SUFFIX@ softfloat.h ../config.h \
  softfloat-round-pack.h softfloat-macros.h softfloat-specialize.h
softfloat.o: softfloat.@CPP_SUFFIX@ softfloat.h ../config.h softfloat-round-pack.h \
  softfloat-macros.h softfloat-specialize.h
softfloatx80.o: softfloatx80.@CPP_SUFFIX@ softfloat.h ../config.h \
  softfloat-round-pack.h softfloat-macros.h softfloat-specialize.h
wmFPUemu_glue.o: wmFPUemu_glue.@CPP_SUFFIX@ ../bochs.h ../config.h ../osdep.h \
  ../bx_debug/debug.h ../bxversion.h ../gui/siminterface.h \
  ../state_file.h ../cpu/cpu.h ../cpu/lazy_flags.h ../cpu/hostasm.h \
  ../cpu/apic.h ../fpu/softfloat.h ../cpu/i387.h ../fpu/tag_w.h \
  ../cpu/xmm.h ../disasm/disasm.h ../memory/memory.h ../pc_system.h \
  ../plugin.h ../extplugin.h ../gui/gui.h ../gui/textconfig.h \
  ../gui/keymap.h ../iodev/iodev.h ../iodev/pci.h ../iodev/pci2isa.h \
  ../iodev/pcivga.h ../iodev/vga.h ../iodev/ioapic.h ../iodev/biosdev.h \
  ../iodev/cmos.h ../iodev/dma.h ../iodev/floppy.h ../iodev/harddrv.h \
  ../iodev/cdrom.h ../iodev/vmware3.h ../iodev/keyboard.h \
  ../iodev/parallel.h ../iodev/pic.h ../iodev/pit.h ../iodev/pit_wrap.h \
  ../iodev/pit82c54.h ../iodev/virt_timer.h ../iodev/serial.h \
  ../iodev/unmapped.h ../iodev/eth.h ../iodev/ne2k.h \
  ../iodev/guest2host.h ../iodev/slowdown_timer.h ../iodev/extfpuirq.h \
  ../iodev/gameport.h ../iodev/speaker.h ../instrument/stubs/instrument.h \
  fpu_emu.h linkage.h fpu_system.h fpu_proto.h
